<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>C++模板 - 编程日志</title><meta name=Description content="C++高级编程"><meta property="og:title" content="C++模板">
<meta property="og:description" content="C++高级编程"><meta property="og:type" content="article"><meta property="og:url" content="https://mengdemao.github.io/cxx_template/"><meta property="og:image" content="https://mengdemao.github.io/images/avatar.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-18T14:21:30+08:00"><meta property="article:modified_time" content="2023-12-23T17:10:11+08:00"><meta property="og:site_name" content="编程日志"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mengdemao.github.io/images/avatar.webp"><meta name=twitter:title content="C++模板"><meta name=twitter:description content="C++高级编程"><meta name=application-name content="DoIt"><meta name=apple-mobile-web-app-title content="DoIt"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mengdemao.github.io/cxx_template/><link rel=prev href=https://mengdemao.github.io/buildroot/><link rel=next href=https://mengdemao.github.io/compile/><link rel=stylesheet href=/css/main.d5cb6f29e0750a13b17688d628b04d50f9fbbd32e0629ccc0dcf796a299ae226.css integrity="sha256-1ctvKeB1ChOxdojWKLBNUPn7vTLgYpzMDc95aima4iY="><link rel=stylesheet href=/lib/normalize/normalize.min.055364f5be272caa092b0e6654c165828707f8ab971e2656383a6d6392bc345e.css integrity="sha256-BVNk9b4nLKoJKw5mVMFlgocH+KuXHiZWODptY5K8NF4="><link rel=stylesheet href=/css/color.b0a0f8c429ce52dfa2805b5f9e99ccdae1e8fbfd9adf4f3ddb409d8201fc0c5a.css integrity="sha256-sKD4xCnOUt+igFtfnpnM2uHo+/2a308920CdggH8DFo="><link rel=stylesheet href=/css/style.min.756198aff89672b591eca05beff565af360b75389a67da7c9d2ff34dce397c56.css integrity="sha256-dWGYr/iWcrWR7KBb7/VlrzYLdTiaZ9p8nS/zTc45fFY="><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.43202d5486e011f9684a17bd6846b5c16a2619002bfc783f7e32e20dfb6bf857.css integrity="sha256-QyAtVIbgEfloShe9aEa1wWomGQAr/Hg/fjLiDftr+Fc="><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.43202d5486e011f9684a17bd6846b5c16a2619002bfc783f7e32e20dfb6bf857.css integrity="sha256-QyAtVIbgEfloShe9aEa1wWomGQAr/Hg/fjLiDftr+Fc="></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><meta name=google-site-verification content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"C++模板","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https://mengdemao.github.io/cxx_template/"},"image":["https://mengdemao.github.io/images/Apple-Devices-Preview.png"],"genre":"posts","keywords":"C\u002b\u002b","wordcount":47189,"url":"https://mengdemao.github.io/cxx_template/","datePublished":"2022-06-18T14:21:30+08:00","dateModified":"2023-12-23T17:10:11+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https://mengdemao.github.io/images/avatar.webp","width":528,"height":560}},"author":{"@type":"Person","name":"mengdemao"},"description":"C++高级编程"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=编程日志><span class=header-title-pre><i class='far fa-edit fa-fw'></i></span><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/series/>系列 </a><a class=menu-item href=/authors/>作者 </a><a class=menu-item href=/showcase/>作品 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/mengdemao/github.io title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-select" title=切换主题><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=编程日志><span class=header-title-pre><i class='far fa-edit fa-fw'></i></span><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/series/ title>系列</a><a class=menu-item href=/authors/ title>作者</a><a class=menu-item href=/showcase/ title>作品</a><a class=menu-item href=/categories/documentation/ title>文档</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/mengdemao/github.io title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#相关知识>相关知识</a></li><li><a href=#模板基础>模板基础</a><ul><li><a href=#函数模版>函数模版</a><ul><li><a href=#实例>实例</a></li><li><a href=#注意事项>注意事项</a></li><li><a href=#普通函数和函数模版的区别>普通函数和函数模版的区别</a></li><li><a href=#普通函数和模版函数调用规则>普通函数和模版函数调用规则</a></li><li><a href=#变参模板>变参模板</a><ul><li><a href=#两阶段编译检查two-phase-translation>两阶段编译检查(Two-Phase Translation)</a></li></ul></li><li><a href=#类型推断中的类型转换>类型推断中的类型转换</a></li><li><a href=#多模板参数调用>多模板参数调用</a><ul><li><a href=#显式指定>显式指定</a></li><li><a href=#返回值指定>返回值指定</a></li><li><a href=#自动推导>自动推导</a></li><li><a href=#公共类型推导>公共类型推导</a></li></ul></li><li><a href=#默认模板参数>默认模板参数</a></li><li><a href=#函数模板重载>函数模板重载</a></li></ul></li><li><a href=#类模板>类模板</a></li><li><a href=#非类型模板参数>非类型模板参数</a><ul><li><a href=#函数模板非类型参数>函数模板非类型参数</a></li><li><a href=#非类型模板参数的限制>非类型模板参数的限制</a></li></ul></li><li><a href=#变参模板-1>变参模板</a><ul><li><a href=#变参模板实例>变参模板实例</a></li><li><a href=#变参个运算符sizeof>变参个运算符<strong>sizeof&mldr;</strong></a></li><li><a href=#折叠表达式>折叠表达式</a></li></ul></li></ul></li><li><a href=#函数模板httpsencppreferencecomwcpplanguagefunction_template><a href=https://en.cppreference.com/w/cpp/language/function_template>函数模板</a></a></li><li><a href=#两阶段编译two-phase-translation>两阶段编译（Two-Phase Translation）</a></li><li><a href=#模板实参推断template-argument-deductionhttpsencppreferencecomwcpplanguagetemplate_argument_deduction><a href=https://en.cppreference.com/w/cpp/language/template_argument_deduction>模板实参推断（Template Argument Deduction）</a></a></li><li><a href=#type-traitshttpsencppreferencecomwcppheadertype_traits><a href=https://en.cppreference.com/w/cpp/header/type_traits>type traits</a></a></li><li><a href=#重载>重载</a></li><li><a href=#用于原始数组与字符串字面值string-literal的模板>用于原始数组与字符串字面值（string literal）的模板</a></li><li><a href=#零初始化zero-initialization>零初始化（Zero Initialization）</a></li><li><a href=#类模板httpsencppreferencecomwcpplanguageclass_template><a href=https://en.cppreference.com/w/cpp/language/class_template>类模板</a></a></li><li><a href=#友元>友元</a></li><li><a href=#特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization><a href=https://en.cppreference.com/w/cpp/language/template_specialization>特化（Specialization）</a></a></li><li><a href=#偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization><a href=https://en.cppreference.com/w/cpp/language/partial_specialization>偏特化（Partial Specialization）</a></a></li><li><a href=#模板的模板参数template-template-parameter>模板的模板参数（Template Template Parameter）</a></li><li><a href=#非类型模板参数non-type-template-parameterhttpsencppreferencecomwcpplanguagetemplate_parametersnon-type_template_parameter><a href=https://en.cppreference.com/w/cpp/language/template_parameters#Non-type_template_parameter>非类型模板参数（Non-type Template Parameter）</a></a></li><li><a href=#限制>限制</a></li><li><a href=#变量模板variable-templatehttpsencppreferencecomwcpplanguagevariable_template><a href=https://en.cppreference.com/w/cpp/language/variable_template>变量模板（Variable Template）</a></a></li><li><a href=#变参模板variadic-template>变参模板（Variadic Template）</a></li><li><a href=#折叠表达式fold-expressionhttpsencppreferencecomwcpplanguagefold><a href=https://en.cppreference.com/w/cpp/language/fold>折叠表达式（Fold Expression）</a></a></li><li><a href=#变参模板的应用>变参模板的应用</a></li><li><a href=#移动语义move-semantics>移动语义（Move Semantics）</a></li><li><a href=#完美转发perfect-forwarding>完美转发（Perfect Forwarding）</a></li><li><a href=#构造函数模板>构造函数模板</a></li><li><a href=#adlargument-dependent-lookupkoenig-lookuphttpsencppreferencecomwcpplanguageadl><a href=https://en.cppreference.com/w/cpp/language/adl>ADL（Argument-Dependent Lookup，Koenig Lookup）</a></a></li><li><a href=#注入类名injected-class-namehttpsencppreferencecomwcpplanguageinjected-class-name><a href=https://en.cppreference.com/w/cpp/language/injected-class-name>注入类名（Injected Class Name）</a></a></li><li><a href=#非模板中的上下文相关性>非模板中的上下文相关性</a></li><li><a href=#dependent-namehttpsencppreferencecomwcpplanguagedependent_name><a href=https://en.cppreference.com/w/cpp/language/dependent_name>Dependent name</a></a><ul><li><a href=#当前实例化current-instantiation和未知特化unknown-specialization>当前实例化（current instantiation）和未知特化（unknown specialization）</a></li><li><a href=#typename-消歧义符>typename 消歧义符</a></li><li><a href=#template-消歧义符>template 消歧义符</a></li></ul></li><li><a href=#non-dependent-base>Non-dependent base</a></li><li><a href=#dependent-base>Dependent base</a></li><li><a href=#隐式实例化>隐式实例化</a></li><li><a href=#延迟实例化lazy-instantiation>延迟实例化（Lazy Instantiation）</a></li><li><a href=#两阶段查找two-phase-lookup>两阶段查找（Two-Phase Lookup）</a></li><li><a href=#poipoints-of-instantiation>POI（Points of Instantiation）</a></li><li><a href=#模板的链接linkage-of-template>模板的链接（Linkage of Template）</a></li><li><a href=#链接错误>链接错误</a></li><li><a href=#显式实例化explicit-instantiationhttpsencppreferencecomwcpplanguageclass_templateexplicit_instantiation><a href=https://en.cppreference.com/w/cpp/language/class_template#Explicit_instantiation>显式实例化（Explicit Instantiation）</a></a></li><li><a href=#deduced-context>Deduced Context</a></li><li><a href=#特殊的推断情况>特殊的推断情况</a></li><li><a href=#sfinaesubstitution-failure-is-not-an-errorhttpsencppreferencecomwcpplanguagesfinae><a href=https://en.cppreference.com/w/cpp/language/sfinae>SFINAE（Substitution Failure Is Not An Error）</a></a></li><li><a href=#deduction-guides>Deduction Guides</a></li><li><a href=#deduction-guides-的问题>Deduction Guides 的问题</a></li><li><a href=#函数模板重载httpsencppreferencecomwcpplanguagefunction_templatefunction_template_overloading><a href=https://en.cppreference.com/w/cpp/language/function_template#Function_template_overloading>函数模板重载</a></a></li><li><a href=#特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization-1><a href=https://en.cppreference.com/w/cpp/language/template_specialization>特化（Specialization）</a></a></li><li><a href=#偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization-1><a href=https://en.cppreference.com/w/cpp/language/partial_specialization>偏特化（Partial Specialization）</a></a></li><li><a href=#traits-的偏特化实现>Traits 的偏特化实现</a></li><li><a href=#元函数转发metafunction-forwarding>元函数转发（Metafunction Forwarding）</a></li><li><a href=#sfinae-based-traits>SFINAE-based traits</a></li><li><a href=#空基类优化ebcoempty-base-class-optimization>空基类优化（EBCO，Empty Base Class Optimization）</a></li><li><a href=#奇异递归模板模式crtpthe-curiously-recurring-template-pattern>奇异递归模板模式（CRTP，The Curiously Recurring Template Pattern）</a></li><li><a href=#mixins>Mixins</a></li><li><a href=#指定模板参数>指定模板参数</a></li><li><a href=#类型擦除type-erasure>类型擦除（Type Erasure）</a></li><li><a href=#元编程metaprogramming>元编程（Metaprogramming）</a></li><li><a href=#循环展开loop-unrolling>循环展开（Loop Unrolling）</a></li><li><a href=#unit-typehttpsenwikipediaorgwikiunit_type><a href=https://en.wikipedia.org/wiki/Unit_type>Unit Type</a></a></li><li><a href=#typelist>Typelist</a></li><li><a href=#stdtuplehttpsencppreferencecomwcpputilitytuple><a href=https://en.cppreference.com/w/cpp/utility/tuple>std::tuple</a></a></li><li><a href=#stdvarianthttpsencppreferencecomwcpputilityvariant><a href=https://en.cppreference.com/w/cpp/utility/variant>std::variant</a></a></li><li><a href=#表达式模板expression-template>表达式模板（Expression Template）</a></li><li><a href=#性能与约束>性能与约束</a></li><li><a href=#浅实例化shallow-instantiation>浅实例化（Shallow Instantiation）</a></li><li><a href=#静态断言static-assertion>静态断言（Static Assertion）</a></li><li><a href=#conceptshttpsencppreferencecomwcppconcepts><a href=https://en.cppreference.com/w/cpp/concepts>Concepts</a></a></li><li><a href=#原型archetype>原型（Archetype）</a></li><li><a href=#跟踪程序tracer>跟踪程序（Tracer）</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">C++模板</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=https://github.com/mengdemao title=Author target=_blank rel="noopener noreferrer author" class=author>mengdemao</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/><i class="far fa-folder fa-fw"></i>编程语言</a></span>&nbsp;<span class=post-category>和</span>&nbsp;<span class=post-series>系列 <a href=/series/cxx/><i class="far fa-list-alt fa-fw"></i>CXX</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-06-18>2022-06-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-12-23>2023-12-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 47189 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 95 分钟&nbsp;</div></div><div class=featured-image><img loading=eager src=/featuredImage/01.webp srcset="/featuredImage/01.webp, /featuredImage/01.webp 1.5x, /featuredImage/01.webp 2x" sizes=auto alt=C++高级编程 title=C++高级编程 height=auto width=auto></div><div class="details series-nav open"><div class="details-summary series-title"><span>系列 - CXX</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content series-content"><nav><ul><li><span class=active>C++模板</span></li></ul></nav></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#相关知识>相关知识</a></li><li><a href=#模板基础>模板基础</a><ul><li><a href=#函数模版>函数模版</a><ul><li><a href=#实例>实例</a></li><li><a href=#注意事项>注意事项</a></li><li><a href=#普通函数和函数模版的区别>普通函数和函数模版的区别</a></li><li><a href=#普通函数和模版函数调用规则>普通函数和模版函数调用规则</a></li><li><a href=#变参模板>变参模板</a><ul><li><a href=#两阶段编译检查two-phase-translation>两阶段编译检查(Two-Phase Translation)</a></li></ul></li><li><a href=#类型推断中的类型转换>类型推断中的类型转换</a></li><li><a href=#多模板参数调用>多模板参数调用</a><ul><li><a href=#显式指定>显式指定</a></li><li><a href=#返回值指定>返回值指定</a></li><li><a href=#自动推导>自动推导</a></li><li><a href=#公共类型推导>公共类型推导</a></li></ul></li><li><a href=#默认模板参数>默认模板参数</a></li><li><a href=#函数模板重载>函数模板重载</a></li></ul></li><li><a href=#类模板>类模板</a></li><li><a href=#非类型模板参数>非类型模板参数</a><ul><li><a href=#函数模板非类型参数>函数模板非类型参数</a></li><li><a href=#非类型模板参数的限制>非类型模板参数的限制</a></li></ul></li><li><a href=#变参模板-1>变参模板</a><ul><li><a href=#变参模板实例>变参模板实例</a></li><li><a href=#变参个运算符sizeof>变参个运算符<strong>sizeof&mldr;</strong></a></li><li><a href=#折叠表达式>折叠表达式</a></li></ul></li></ul></li><li><a href=#函数模板httpsencppreferencecomwcpplanguagefunction_template><a href=https://en.cppreference.com/w/cpp/language/function_template>函数模板</a></a></li><li><a href=#两阶段编译two-phase-translation>两阶段编译（Two-Phase Translation）</a></li><li><a href=#模板实参推断template-argument-deductionhttpsencppreferencecomwcpplanguagetemplate_argument_deduction><a href=https://en.cppreference.com/w/cpp/language/template_argument_deduction>模板实参推断（Template Argument Deduction）</a></a></li><li><a href=#type-traitshttpsencppreferencecomwcppheadertype_traits><a href=https://en.cppreference.com/w/cpp/header/type_traits>type traits</a></a></li><li><a href=#重载>重载</a></li><li><a href=#用于原始数组与字符串字面值string-literal的模板>用于原始数组与字符串字面值（string literal）的模板</a></li><li><a href=#零初始化zero-initialization>零初始化（Zero Initialization）</a></li><li><a href=#类模板httpsencppreferencecomwcpplanguageclass_template><a href=https://en.cppreference.com/w/cpp/language/class_template>类模板</a></a></li><li><a href=#友元>友元</a></li><li><a href=#特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization><a href=https://en.cppreference.com/w/cpp/language/template_specialization>特化（Specialization）</a></a></li><li><a href=#偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization><a href=https://en.cppreference.com/w/cpp/language/partial_specialization>偏特化（Partial Specialization）</a></a></li><li><a href=#模板的模板参数template-template-parameter>模板的模板参数（Template Template Parameter）</a></li><li><a href=#非类型模板参数non-type-template-parameterhttpsencppreferencecomwcpplanguagetemplate_parametersnon-type_template_parameter><a href=https://en.cppreference.com/w/cpp/language/template_parameters#Non-type_template_parameter>非类型模板参数（Non-type Template Parameter）</a></a></li><li><a href=#限制>限制</a></li><li><a href=#变量模板variable-templatehttpsencppreferencecomwcpplanguagevariable_template><a href=https://en.cppreference.com/w/cpp/language/variable_template>变量模板（Variable Template）</a></a></li><li><a href=#变参模板variadic-template>变参模板（Variadic Template）</a></li><li><a href=#折叠表达式fold-expressionhttpsencppreferencecomwcpplanguagefold><a href=https://en.cppreference.com/w/cpp/language/fold>折叠表达式（Fold Expression）</a></a></li><li><a href=#变参模板的应用>变参模板的应用</a></li><li><a href=#移动语义move-semantics>移动语义（Move Semantics）</a></li><li><a href=#完美转发perfect-forwarding>完美转发（Perfect Forwarding）</a></li><li><a href=#构造函数模板>构造函数模板</a></li><li><a href=#adlargument-dependent-lookupkoenig-lookuphttpsencppreferencecomwcpplanguageadl><a href=https://en.cppreference.com/w/cpp/language/adl>ADL（Argument-Dependent Lookup，Koenig Lookup）</a></a></li><li><a href=#注入类名injected-class-namehttpsencppreferencecomwcpplanguageinjected-class-name><a href=https://en.cppreference.com/w/cpp/language/injected-class-name>注入类名（Injected Class Name）</a></a></li><li><a href=#非模板中的上下文相关性>非模板中的上下文相关性</a></li><li><a href=#dependent-namehttpsencppreferencecomwcpplanguagedependent_name><a href=https://en.cppreference.com/w/cpp/language/dependent_name>Dependent name</a></a><ul><li><a href=#当前实例化current-instantiation和未知特化unknown-specialization>当前实例化（current instantiation）和未知特化（unknown specialization）</a></li><li><a href=#typename-消歧义符>typename 消歧义符</a></li><li><a href=#template-消歧义符>template 消歧义符</a></li></ul></li><li><a href=#non-dependent-base>Non-dependent base</a></li><li><a href=#dependent-base>Dependent base</a></li><li><a href=#隐式实例化>隐式实例化</a></li><li><a href=#延迟实例化lazy-instantiation>延迟实例化（Lazy Instantiation）</a></li><li><a href=#两阶段查找two-phase-lookup>两阶段查找（Two-Phase Lookup）</a></li><li><a href=#poipoints-of-instantiation>POI（Points of Instantiation）</a></li><li><a href=#模板的链接linkage-of-template>模板的链接（Linkage of Template）</a></li><li><a href=#链接错误>链接错误</a></li><li><a href=#显式实例化explicit-instantiationhttpsencppreferencecomwcpplanguageclass_templateexplicit_instantiation><a href=https://en.cppreference.com/w/cpp/language/class_template#Explicit_instantiation>显式实例化（Explicit Instantiation）</a></a></li><li><a href=#deduced-context>Deduced Context</a></li><li><a href=#特殊的推断情况>特殊的推断情况</a></li><li><a href=#sfinaesubstitution-failure-is-not-an-errorhttpsencppreferencecomwcpplanguagesfinae><a href=https://en.cppreference.com/w/cpp/language/sfinae>SFINAE（Substitution Failure Is Not An Error）</a></a></li><li><a href=#deduction-guides>Deduction Guides</a></li><li><a href=#deduction-guides-的问题>Deduction Guides 的问题</a></li><li><a href=#函数模板重载httpsencppreferencecomwcpplanguagefunction_templatefunction_template_overloading><a href=https://en.cppreference.com/w/cpp/language/function_template#Function_template_overloading>函数模板重载</a></a></li><li><a href=#特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization-1><a href=https://en.cppreference.com/w/cpp/language/template_specialization>特化（Specialization）</a></a></li><li><a href=#偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization-1><a href=https://en.cppreference.com/w/cpp/language/partial_specialization>偏特化（Partial Specialization）</a></a></li><li><a href=#traits-的偏特化实现>Traits 的偏特化实现</a></li><li><a href=#元函数转发metafunction-forwarding>元函数转发（Metafunction Forwarding）</a></li><li><a href=#sfinae-based-traits>SFINAE-based traits</a></li><li><a href=#空基类优化ebcoempty-base-class-optimization>空基类优化（EBCO，Empty Base Class Optimization）</a></li><li><a href=#奇异递归模板模式crtpthe-curiously-recurring-template-pattern>奇异递归模板模式（CRTP，The Curiously Recurring Template Pattern）</a></li><li><a href=#mixins>Mixins</a></li><li><a href=#指定模板参数>指定模板参数</a></li><li><a href=#类型擦除type-erasure>类型擦除（Type Erasure）</a></li><li><a href=#元编程metaprogramming>元编程（Metaprogramming）</a></li><li><a href=#循环展开loop-unrolling>循环展开（Loop Unrolling）</a></li><li><a href=#unit-typehttpsenwikipediaorgwikiunit_type><a href=https://en.wikipedia.org/wiki/Unit_type>Unit Type</a></a></li><li><a href=#typelist>Typelist</a></li><li><a href=#stdtuplehttpsencppreferencecomwcpputilitytuple><a href=https://en.cppreference.com/w/cpp/utility/tuple>std::tuple</a></a></li><li><a href=#stdvarianthttpsencppreferencecomwcpputilityvariant><a href=https://en.cppreference.com/w/cpp/utility/variant>std::variant</a></a></li><li><a href=#表达式模板expression-template>表达式模板（Expression Template）</a></li><li><a href=#性能与约束>性能与约束</a></li><li><a href=#浅实例化shallow-instantiation>浅实例化（Shallow Instantiation）</a></li><li><a href=#静态断言static-assertion>静态断言（Static Assertion）</a></li><li><a href=#conceptshttpsencppreferencecomwcppconcepts><a href=https://en.cppreference.com/w/cpp/concepts>Concepts</a></a></li><li><a href=#原型archetype>原型（Archetype）</a></li><li><a href=#跟踪程序tracer>跟踪程序（Tracer）</a></li></ul></nav></div></div><div class=content id=content><h2 id=相关知识 class=headerLink><a href=#%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86 class=header-mark></a>1 相关知识</h2><p><strong>gcc</strong>中<code>typeof</code>关键字用来检查变量类型,那么则可以用来判断魔板生成中的数据类型,
但是在C++中存在这另外的运算符<code>typeid</code>,但是我个人认为<code>typeof</code>更加优秀，但是二者并不相同,
<code>typeid</code>返回类型对象,<code>typeof</code>只可以判断类型;</p><p>代码如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define __toStr(x) #x
</span></span></span><span class=line><span class=cl><span class=cp>#define toStr(x) __toStr(x)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define check_type_item(_x, type) \
</span></span></span><span class=line><span class=cl><span class=cp>if (typeid(_x) == typeid(type)) { \
</span></span></span><span class=line><span class=cl><span class=cp> std::cout &lt;&lt; toStr(_x) &lt;&lt; &#34; is &#34; &lt;&lt; toStr(type) &lt;&lt; std::endl; \
</span></span></span><span class=line><span class=cl><span class=cp>} else
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define check_type_tail(_x) \
</span></span></span><span class=line><span class=cl><span class=cp>{ \
</span></span></span><span class=line><span class=cl><span class=cp> std::cout &lt;&lt; toStr(_x) &lt;&lt; &#34; is unknow&#34; &lt;&lt; std::endl; \
</span></span></span><span class=line><span class=cl><span class=cp>}
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define check_type(_x) \
</span></span></span><span class=line><span class=cl><span class=cp>({ \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, bool)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, char)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, short)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, int)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, long)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, wchar_t)  \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, unsigned char)  \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, unsigned short) \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, unsigned int)  \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, unsigned long)  \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, float)    \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, double)   \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_item(_x, std::string)  \
</span></span></span><span class=line><span class=cl><span class=cp> check_type_tail(_x)     \
</span></span></span><span class=line><span class=cl><span class=cp>})
</span></span></span></code></pre></td></tr></table></div></div><p>从内核中学到的一种用来编译期间校验的宏函数,用来确定推导过程是否正确</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define BUILD_BUG_ON(cond) ((void)sizeof(int[1-2*(!!(cond))]))
</span></span></span></code></pre></td></tr></table></div></div><p>C++还提供了一种运算符<em>static_assert</em>,用作编译期间静态静态检查;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span> <span class=c1>// 正确: 编译通过
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static_assert</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span> <span class=c1>// 错误: static assertion failed
</span></span></span></code></pre></td></tr></table></div></div><p>那么就可以通过此工具来分析模板推导过程是否是正确的</p><h2 id=模板基础 class=headerLink><a href=#%e6%a8%a1%e6%9d%bf%e5%9f%ba%e7%a1%80 class=header-mark></a>2 模板基础</h2><blockquote><p>模板和宏定义区别:模板在编译期进行,宏在预编译期间进行</p></blockquote><p>建立通用的模板,提高复用率</p><p>C++提供两种模版机制:<strong>函数模版</strong>和<strong>类模板</strong></p><h3 id=函数模版 class=headerLink><a href=#%e5%87%bd%e6%95%b0%e6%a8%a1%e7%89%88 class=header-mark></a>2.1 函数模版</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=err>函数声明和定义</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>template &ndash; 声明创建模版</li><li>typename &ndash; 表明后面的符号是数据类型可以用class代替</li><li>T &ndash; 通用的数据类型</li></ul><h4 id=实例 class=headerLink><a href=#%e5%ae%9e%e4%be%8b class=header-mark></a>2.1.1 实例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cm>/* 两个数据交换 */</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>swap</span><span class=p>(</span><span class=n>T</span> <span class=o>&amp;</span><span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=o>&amp;</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>t</span><span class=o>=</span> <span class=n>a</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=注意事项 class=headerLink><a href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 class=header-mark></a>2.1.2 注意事项</h4><ul><li>自动类型推导,必须导出类型一致的T才可以使用</li><li>模版必须要确定T的数据类型,才可以使用</li></ul><h4 id=普通函数和函数模版的区别 class=headerLink><a href=#%e6%99%ae%e9%80%9a%e5%87%bd%e6%95%b0%e5%92%8c%e5%87%bd%e6%95%b0%e6%a8%a1%e7%89%88%e7%9a%84%e5%8c%ba%e5%88%ab class=header-mark></a>2.1.3 普通函数和函数模版的区别</h4><ul><li>普通函数可以发生隐式类型转换</li><li>函数模板: 用自动类型推导，不可以发生隐式转换</li><li>函数模板: 用显示类型推导，可以发生隐式转换</li></ul><p>模版函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>add</span><span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>调用方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cm>/* 自动推导 */</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>add</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/* 显示指定 */</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>add</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=普通函数和模版函数调用规则 class=headerLink><a href=#%e6%99%ae%e9%80%9a%e5%87%bd%e6%95%b0%e5%92%8c%e6%a8%a1%e7%89%88%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e8%a7%84%e5%88%99 class=header-mark></a>2.1.4 普通函数和模版函数调用规则</h4><ul><li>普通函数和模版函数都可以调用,有限调用普通函数</li><li>强制通过空模版参数强制调用函数模版:<strong>函数名&lt;>(参数列表)</strong></li><li>函数模版也可以重载</li><li>函数模版更好的匹配,选择函数模版</li></ul><h4 id=变参模板 class=headerLink><a href=#%e5%8f%98%e5%8f%82%e6%a8%a1%e6%9d%bf class=header-mark></a>2.1.5 变参模板</h4><h5 id=两阶段编译检查two-phase-translation class=headerLink><a href=#%e4%b8%a4%e9%98%b6%e6%ae%b5%e7%bc%96%e8%af%91%e6%a3%80%e6%9f%a5two-phase-translation class=header-mark></a>2.1.5.1 两阶段编译检查(Two-Phase Translation)</h5><ol><li><p>在模板定义阶段，模板的检查并不包含类型参数的检查。只包含下面几个方面：</p><ul><li>语法检查。比如少了分号。</li><li>使用了未定义的不依赖于模板参数的名称（类型名，函数名，&mldr;&mldr;）</li><li>未使用模板参数的static assertions。</li></ul></li><li><p>在模板实例化阶段，为确保所有代码都是有效的，模板会再次被检查，尤其是那些依赖于类型参数的部分。</p></li></ol><p>总结来说</p><ul><li>模板实例化(不同于预编译)</li><li>程序编译</li></ul><h4 id=类型推断中的类型转换 class=headerLink><a href=#%e7%b1%bb%e5%9e%8b%e6%8e%a8%e6%96%ad%e4%b8%ad%e7%9a%84%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2 class=header-mark></a>2.1.6 类型推断中的类型转换</h4><p>在类型推断的时候自动的类型转换是受限制的：</p><ul><li>如果调用参数是按引用传递的，任何类型转换都不被允许。通过模板类型参数T 定义的
两个参数，它们实参的类型必须完全一样。</li><li>如果调用参数是按值传递的，那么只有退化（decay）这一类简单转换是被允许的：<code>const</code>
和<code>volatile</code>限制符会被忽略，引用被转换成被引用的类型，raw array 和函数被转换为相
应的指针类型。通过模板类型参数T 定义的两个参数，它们实参的类型在退化（decay）
后必须一样。</li></ul><h4 id=多模板参数调用 class=headerLink><a href=#%e5%a4%9a%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0%e8%b0%83%e7%94%a8 class=header-mark></a>2.1.7 多模板参数调用</h4><p>主要是为了完成<code>max(1, 21)</code>,但是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=nf>max</span> <span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=n>a</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果直接调用`error: no matching function for call to &lsquo;max(int, double)&rsquo;,会报错,因此可以使用如下方法:</p><h5 id=显式指定 class=headerLink><a href=#%e6%98%be%e5%bc%8f%e6%8c%87%e5%ae%9a class=header-mark></a>2.1.7.1 显式指定</h5><p>将模板显式指定,从而可以保证编译进行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>max</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>2.1</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>但是总感觉不太优雅,因此一定存在更加优秀的方案,但是此时也可以称之为一个方案</p><h5 id=返回值指定 class=headerLink><a href=#%e8%bf%94%e5%9b%9e%e5%80%bc%e6%8c%87%e5%ae%9a class=header-mark></a>2.1.7.2 返回值指定</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=kr>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=kr>typename</span> <span class=n>RT</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=kt>decay_t</span><span class=o>&lt;</span><span class=nf>decltype</span><span class=p>(</span><span class=nb>true</span> <span class=o>?</span> <span class=nf>T1</span><span class=p>()</span> <span class=o>:</span> <span class=nf>T2</span><span class=p>())</span><span class=o>&gt;</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>RT</span> <span class=nf>max</span> <span class=p>(</span><span class=n>T1</span> <span class=n>a</span><span class=p>,</span> <span class=n>T2</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=n>a</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=kt>float</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=nf>check_type</span><span class=p>(</span><span class=nf>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>   <span class=c1>// int
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=nf>check_type</span><span class=p>(</span><span class=nf>max</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>  <span class=c1>// float
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=nf>check_type</span><span class=p>(</span><span class=nf>max</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=mf>2.0</span><span class=p>));</span> <span class=c1>// double
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>其结果满足我的基本知识</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>max<span class=o>(</span>1, 2<span class=o>)</span> is int
</span></span><span class=line><span class=cl>max<span class=o>(</span>a, 2<span class=o>)</span> is float
</span></span><span class=line><span class=cl>max<span class=o>(</span>b, 2.0<span class=o>)</span> is double
</span></span></code></pre></td></tr></table></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>补充知识1<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><code>auto</code>和<code>decltype</code>关键字都可以自动推导出变量的类型,但它们的用法是有区别的;
<code>auto</code>是根据初始化的时候变量或者表达式的类型来处理,<code>auto a = value</code>
<code>decltype</code>使用需要表达式,<code>decltype(exp) varname = value;</code>通过计算exp的类型来确定类型
因此,<code>decltype</code>可以没有初始化的参数,额<code>auto</code>则不可以</div></div></div><p><code>std::decay_t</code>可以认为是剥离引用类型, T:某种类型.</p><ul><li>当T是引用类型,decay<t>::type返回T引用的元素类型;</li><li>当T是非引用类型,decay<t>::type返回T的类型.</li></ul><h5 id=自动推导 class=headerLink><a href=#%e8%87%aa%e5%8a%a8%e6%8e%a8%e5%af%bc class=header-mark></a>2.1.7.3 自动推导</h5><blockquote><p>不指定类型,而是由编译器自行判断,<code>auto</code>关键字判断</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=kr>typename</span> <span class=n>T2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=nf>max</span><span class=p>(</span><span class=n>T1</span> <span class=n>a</span><span class=p>,</span> <span class=n>T2</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=n>a</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=公共类型推导 class=headerLink><a href=#%e5%85%ac%e5%85%b1%e7%b1%bb%e5%9e%8b%e6%8e%a8%e5%af%bc class=header-mark></a>2.1.7.4 公共类型推导</h5><blockquote><p>类型萃取std::common_type&lt;>作为返回类型的默认值</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>common_type_t</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span><span class=n>T2</span><span class=o>&gt;</span> <span class=n>max</span><span class=p>(</span><span class=n>T1</span> <span class=n>a</span><span class=p>,</span> <span class=n>T2</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=n>a</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=默认模板参数 class=headerLink><a href=#%e9%bb%98%e8%ae%a4%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0 class=header-mark></a>2.1.8 默认模板参数</h4><blockquote><p>你也可以给模板参数指定默认值。这些默认值被称为默认模板参数并且可以用于任意类型的
模板。它们甚至可以根据其前面的模板参数来决定自己的类型</p></blockquote><p>简单执行默认参数,直接在<code>T=类型</code>即可,同时可以填入相同类型的默认参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=nf>HelloWorld</span><span class=p>(</span><span class=n>T</span> <span class=n>f</span> <span class=o>=</span> <span class=s>&#34;HelloWorld&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nf>check_type</span><span class=p>(</span><span class=nf>HelloWorld</span><span class=p>());</span>
</span></span><span class=line><span class=cl> <span class=nf>check_type</span><span class=p>(</span><span class=nf>HelloWorld</span><span class=p>(</span><span class=mi>123</span><span class=p>));</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>那么显式如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>HelloWorld<span class=o>()</span> is std::string
</span></span><span class=line><span class=cl>HelloWorld<span class=o>(</span>123<span class=o>)</span> is int
</span></span></code></pre></td></tr></table></div></div><p>模板类型和默认参数必须是同一种类型</p><h4 id=函数模板重载 class=headerLink><a href=#%e5%87%bd%e6%95%b0%e6%a8%a1%e6%9d%bf%e9%87%8d%e8%bd%bd class=header-mark></a>2.1.9 函数模板重载</h4><h3 id=类模板 class=headerLink><a href=#%e7%b1%bb%e6%a8%a1%e6%9d%bf class=header-mark></a>2.2 类模板</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=err>类</span>
</span></span></code></pre></td></tr></table></div></div><p>例子</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>NameType</span><span class=p>,</span> <span class=k>class</span> <span class=nc>AgeType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Person</span><span class=p>(</span><span class=n>NameType</span> <span class=n>Name</span><span class=p>,</span> <span class=n>AgeType</span> <span class=n>Age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m_Name</span> <span class=o>=</span> <span class=n>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>m_Age</span>  <span class=o>=</span> <span class=n>Age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>NameType</span> <span class=n>m_Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>AgeType</span> <span class=n>m_Age</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>实例化</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>Person</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=n>p</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>,</span> <span class=mi>99</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=非类型模板参数 class=headerLink><a href=#%e9%9d%9e%e7%b1%bb%e5%9e%8b%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0 class=header-mark></a>2.3 非类型模板参数</h3><blockquote><p>对于之前介绍的函数模板和类模板,其模板参数不一定非得是某种具体的类型,也可以是常
规数值.和类模板使用类型作为参数类似,可以使代码的另一些细节留到被使用时再确定，
只是对非类型模板参数,待定的不再是类型,而是某个数值.在使用这种模板时需要显式的
指出待定数值的具体值,之后代码会被实例化.</p></blockquote><p>简言之</br><strong>模板</strong>不仅可以作为<strong>类型</strong>,还可以作为<strong>数值</strong></p><h4 id=函数模板非类型参数 class=headerLink><a href=#%e5%87%bd%e6%95%b0%e6%a8%a1%e6%9d%bf%e9%9d%9e%e7%b1%bb%e5%9e%8b%e5%8f%82%e6%95%b0 class=header-mark></a>2.3.1 函数模板非类型参数</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>Val</span><span class=p>,</span> <span class=kr>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=nf>max</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=nf>max</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>Val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>max</span><span class=o>&lt;</span><span class=mi>5</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=非类型模板参数的限制 class=headerLink><a href=#%e9%9d%9e%e7%b1%bb%e5%9e%8b%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0%e7%9a%84%e9%99%90%e5%88%b6 class=header-mark></a>2.3.2 非类型模板参数的限制</h4><ul><li>整形常量(包含枚举)</li><li>指针<code>objects/functions/members</code></li><li><code>objects</code>或者<code>functions</code>的左值引用</li><li><code>std::nullptr_t</code></li></ul><blockquote><p>浮点型数值或者<code>class</code>类型的对象都不能作为非类型模板参数使用</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kt>double</span> <span class=n>VAT</span><span class=o>&gt;</span> <span class=c1>// ERROR: floating-point values are not
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>process</span> <span class=p>(</span><span class=kt>double</span> <span class=n>v</span><span class=p>){}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=o>&gt;</span> <span class=c1>// ERROR: class-type objects are not
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>class</span> <span class=n>MyClass</span> <span class=p>{};</span>
</span></span></code></pre></td></tr></table></div></div><p>使用auto作为变量类型,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>auto</span> <span class=n>Maxsize</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>class</span> <span class=n>MyClass</span> <span class=p>{};</span>
</span></span></code></pre></td></tr></table></div></div><p>需要修改C++标准:</p><ul><li><i class="far fa-square fa-fw"></i> c++98 &ndash;> 无法编译</li><li><i class="far fa-square fa-fw"></i> c++11 &ndash;> 无法编译</li><li><i class="far fa-square fa-fw"></i> c++14 &ndash;> 无法编译</li><li><i class="far fa-check-square fa-fw"></i> c++17 &ndash;> 可以编译</li><li><i class="far fa-check-square fa-fw"></i> c++20 &ndash;> 可以编译</li></ul><ol><li>模板的参数不只可以是类型,也可以是数值.</li><li>不可以将浮点型或者<code>class</code>类型的对象用于非类型模板参数.使用指向字符串常量,临时变量和子对象的指针或引用也有一些限制.</li><li>通过使用关键字auto,可以使非类型模板参数的类型更为泛化</li></ol><h3 id=变参模板-1 class=headerLink><a href=#%e5%8f%98%e5%8f%82%e6%a8%a1%e6%9d%bf-1 class=header-mark></a>2.4 变参模板</h3><blockquote><p>类似于C语言可变参数相似,那么,C++也存在这个类似的功能.
可以将模板参数定义成能够接受任意多个模板参数的情况,这一类模板被称为变参模板.</p></blockquote><ul><li>通过使用参数包，模板可以有任意多个任意类型的参数。</li><li>为了处理这些参数，需要使用递归，而且需要一个非变参函数终结递归（如果使用编译
期判断，则不需要非变参函数来终结递归）。</li><li>运算符sizeof&mldr;用来计算参数包中模板参数的数目。</li><li>变参模板的一个典型应用是用来发送（forward）任意多个任意类型的模板参数。</li><li>通过使用折叠表达式,可以将某种运算应用于参数包中的所有参数.</li></ul><h4 id=变参模板实例 class=headerLink><a href=#%e5%8f%98%e5%8f%82%e6%a8%a1%e6%9d%bf%e5%ae%9e%e4%be%8b class=header-mark></a>2.4.1 变参模板实例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print_var_args</span><span class=p>(</span><span class=n>T</span> <span class=n>firstArg</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>firstArg</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span> <span class=c1>//print first argument
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>print_var_args</span><span class=p>(</span><span class=n>args</span><span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>通过上面的实例我们可以得到,声明可变参数模板的方法
<strong>typename&mldr; Types</strong>或者<strong>class&mldr; Types</strong>,其中Types就可以用来声明可变参数
<strong>Types&mldr; args</strong>,但是为什么还需要在写一次<code>...</code>,我个人是不太理解的.</p><p>以args的剩余参数则称之为<strong>函数参数包</strong>;</p><p>但是只有上述的是编译不过的,因为存在参数消耗殆尽的情况,因此添加一个空的函数,
用作递归结束;</p><p>这就是编译期间编程的概念</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_var_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;变参模板结束&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试函数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=n>print_var_args</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最后运行情况的打印就是<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 变参模板结束</span></span></span></code></pre></td></tr></table></div></div></p><h4 id=变参个运算符sizeof class=headerLink><a href=#%e5%8f%98%e5%8f%82%e4%b8%aa%e8%bf%90%e7%ae%97%e7%ac%a6sizeof class=header-mark></a>2.4.2 变参个运算符<strong>sizeof&mldr;</strong></h4><blockquote><p>C++11为变参模板引入了一种新的<code>sizeof</code>运算符:<code>sizeof...</code>
它会被扩展成参数包中所包含的参数数目</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl> <span class=c1>// void print_var_args(T firstArg, Types... args)
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;sizeof...(Types)</span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Types</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=c1>// 模板参数包
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;sizeof...(args) </span><span class=se>\t</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span>  <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=c1>// 函数参数包
</span></span></span></code></pre></td></tr></table></div></div><p>运行结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># sizeof...(Types) 2</span>
</span></span><span class=line><span class=cl><span class=c1># sizeof...(args) 2</span>
</span></span></code></pre></td></tr></table></div></div><p>因此,可以得出结论</p><ul><li>sizeof&mldr;可以计算每一次展开的个数</li><li>既可以用于模板参数包,也可以用于函数参数包</li></ul><h4 id=折叠表达式 class=headerLink><a href=#%e6%8a%98%e5%8f%a0%e8%a1%a8%e8%be%be%e5%bc%8f class=header-mark></a>2.4.3 折叠表达式</h4><blockquote><p>从C++17开始,提供了一种可以用来计算参数包(可以有初始值)中所有参数运算结果的二
元运算符.</p></blockquote><p>测试程序</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span><span class=err>... </span><span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>foldSun</span><span class=p>(</span><span class=n>T</span><span class=p>...</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=c1>// s1 + s2 + s3 + sn (其中n参数的个数)
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=k>return</span> <span class=p>(...</span> <span class=o>+</span> <span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=函数模板httpsencppreferencecomwcpplanguagefunction_template class=headerLink><a href=#%e5%87%bd%e6%95%b0%e6%a8%a1%e6%9d%bfhttpsencppreferencecomwcpplanguagefunction_template class=header-mark></a>3 <a href=https://en.cppreference.com/w/cpp/language/function_template target=_blank rel="noopener noreferrer">函数模板</a></h2><ul><li>编写时不指定具体类型，直到使用时才能确定，这个概念就是泛型。模板，顾名思义，编写一次即可适用于任意类型。模板定义以关键词 template 开始，后跟一个模板参数列表，类型参数前必须使用关键字 typename 或 class，在模板参数列表中这两个关键字含义相同，可以互换使用。函数模板通常不用声明为 inline，唯一例外的是特定类型的全特化，因为编译器可能忽略 inline，函数模板是否内联取决于编译器的优化策略</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s1</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s2</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=两阶段编译two-phase-translation class=headerLink><a href=#%e4%b8%a4%e9%98%b6%e6%ae%b5%e7%bc%96%e8%af%91two-phase-translation class=header-mark></a>4 两阶段编译（Two-Phase Translation）</h2><ul><li>模板编译分为实例化前检查和实例化两个阶段。实例化前检查模板代码本身，包括<ul><li>检查语法是否正确，如是否遗漏分号</li><li>检查是否使用不依赖于模板参数的未知名称，如未声明的类型名、函数名</li><li>检查不依赖于模板参数的静态断言</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>undeclared</span><span class=p>();</span>  <span class=c1>// 一阶段编译错误，未声明的函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>);</span>  <span class=c1>// 一阶段，sizeof(int) &lt;= 10，总会编译失败
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实例化期间保证代码有效，比如对不能解引用的类型进行解引用就会实例化出错，此外会再次检查依赖于模板参数的部分</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>undeclared</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>  <span class=c1>// 调用 undeclared(T) 才会出现函数未声明的实例化错误
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>);</span>  <span class=c1>// 如果 sizeof(T) &lt;= 10 则实例化错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>  <span class=c1>// 调用函数才会进行实例化，不调用则不会有实例化错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=模板实参推断template-argument-deductionhttpsencppreferencecomwcpplanguagetemplate_argument_deduction class=headerLink><a href=#%e6%a8%a1%e6%9d%bf%e5%ae%9e%e5%8f%82%e6%8e%a8%e6%96%adtemplate-argument-deductionhttpsencppreferencecomwcpplanguagetemplate_argument_deduction class=header-mark></a>5 <a href=https://en.cppreference.com/w/cpp/language/template_argument_deduction target=_blank rel="noopener noreferrer">模板实参推断（Template Argument Deduction）</a></h2><ul><li>调用模板时，如果不显式指定模板参数类型，则编译器会根据传入的实参推断模板参数类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>          <span class=c1>// T 推断为 int
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>  <span class=c1>// T 推断为 double
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s1</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s2</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>  <span class=c1>// T 推断为 std::string
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实参的推断要求一致，其本身不会为了编译通过自动做类型转换</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>);</span>  <span class=c1>// 错误，T 分别推断出 int 和 double，类型不明确
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>字符串字面值传引用会推断为字符数组（传值则推断为 <code>const char*</code>，数组和函数会 decay 为指针）</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=s>&#34;down&#34;</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>  <span class=c1>// 错误，T 推断为 char[5] 和 std::string
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于推断不一致的情况，可以显式指定类型而不使用推断机制，或者强制转换实参为希望的类型使得推断结果一致</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;down&#34;</span><span class=p>,</span> <span class=s>&#34;demo&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;down&#34;</span><span class=p>},</span> <span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>也可以增加一个模板参数，这样每个实参的推断都是独立的，不会出现矛盾</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>  <span class=c1>// T 推断为 int，返回值截断为 int
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板实参不能推断返回类型，必须显式指定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>RT</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++14 允许 auto 作为返回类型，它通过 return 语句推断返回类型，C++11 则需要额外指定尾置返回类型，对于三目运算符，其结果类型为两个操作数类型中更公用的类型，比如 int 和 double 的公用类型是 double</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=k>decltype</span><span class=p>(</span><span class=nb>true</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>用 constexpr 函数可以生成编译期值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=type-traitshttpsencppreferencecomwcppheadertype_traits class=headerLink><a href=#type-traitshttpsencppreferencecomwcppheadertype_traits class=header-mark></a>6 <a href=https://en.cppreference.com/w/cpp/header/type_traits target=_blank rel="noopener noreferrer">type traits</a></h2><ul><li>对于类型进行计算的模板称为 type traits，也可以称为元函数，比如用 <a href=https://en.cppreference.com/w/cpp/types/common_type target=_blank rel="noopener noreferrer">std::common_type</a> 来计算不同类型中最通用的类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=p>,</span> <span class=k>typename</span> <span class=n>RT</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>common_type_t</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>U</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>RT</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=重载 class=headerLink><a href=#%e9%87%8d%e8%bd%bd class=header-mark></a>7 重载</h2><ul><li>当类型同时匹配普通函数和模板时，优先匹配普通函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板参数不同就会构成重载，如果对于给定的实参能同时匹配两个模板，重载解析会优先匹配更特殊的模板，如果同样特殊则产生二义性错误</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>//   jc::f&lt;int&gt;(1, 3.14);  // 二义性错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C-style 字符串的重载</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>max</span><span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span><span class=o>*</span> <span class=n>max</span><span class=p>(</span><span class=n>T</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span><span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=n>a</span> <span class=o>&lt;</span> <span class=o>*</span><span class=n>b</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=nf>max</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=o>&amp;</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s1</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s2</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=p>(</span><span class=s>&#34;down&#34;</span><span class=p>,</span> <span class=s>&#34;demo&#34;</span><span class=p>),</span> <span class=s>&#34;down&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>注意不能返回 C-style 字符串的引用</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>s</span> <span class=o>=</span> <span class=s>&#34;downdemo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=k>const</span> <span class=kt>char</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>  <span class=c1>// 错误：返回临时对象的引用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>这种错误可能在添加代码的过程中引入</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=n>a</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 新增函数来支持 C-style 参数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=nf>max</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=nl>b</span> <span class=p>:</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>max</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>max</span><span class=p>(</span><span class=n>max</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>),</span> <span class=n>c</span><span class=p>);</span>  <span class=c1>// max(&#34;down&#34;, &#34;de&#34;) 返回临时对象的引用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>a</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>b</span> <span class=o>=</span> <span class=s>&#34;de&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>c</span> <span class=o>=</span> <span class=s>&#34;mo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>max</span><span class=o>&lt;</span><span class=k>const</span> <span class=kt>char</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>  <span class=c1>// 错误：返回临时对象的引用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>只有在函数调用前声明的重载才会被匹配，即使后续有更优先的匹配，由于不可见也会被忽略</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>g</span><span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>f</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>g</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=用于原始数组与字符串字面值string-literal的模板 class=headerLink><a href=#%e7%94%a8%e4%ba%8e%e5%8e%9f%e5%a7%8b%e6%95%b0%e7%bb%84%e4%b8%8e%e5%ad%97%e7%ac%a6%e4%b8%b2%e5%ad%97%e9%9d%a2%e5%80%bcstring-literal%e7%9a%84%e6%a8%a1%e6%9d%bf class=header-mark></a>8 用于原始数组与字符串字面值（string literal）的模板</h2><ul><li>字符串字面值传引用会推断为字符数组，为此需要为原始数组和字符串字面值提供特定处理的模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>less</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>M</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>less</span><span class=p>(</span><span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>)[</span><span class=n>M</span><span class=p>],</span> <span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>b</span><span class=p>)[</span><span class=n>N</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>M</span> <span class=o>&amp;&amp;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>M</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>less</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>42</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>less</span><span class=p>(</span><span class=s>&#34;down&#34;</span><span class=p>,</span> <span class=s>&#34;demo&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>less</span><span class=p>(</span><span class=s>&#34;demo&#34;</span><span class=p>,</span> <span class=s>&#34;down&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>各种类型的数组参数对应的偏特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[</span><span class=n>N</span><span class=p>]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=p>)[</span><span class=n>N</span><span class=p>]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=p>)[]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T3</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>void</span> <span class=n>test</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>[],</span> <span class=kt>int</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>a3</span><span class=p>)[</span><span class=mi>42</span><span class=p>],</span> <span class=kt>int</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>x0</span><span class=p>)[],</span> <span class=n>T1</span> <span class=n>x1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>T2</span><span class=o>&amp;</span> <span class=n>x2</span><span class=p>,</span> <span class=n>T3</span><span class=o>&amp;&amp;</span> <span class=n>x3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a1</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>5</span><span class=p>);</span>  <span class=c1>// A&lt;T*&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a2</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>5</span><span class=p>);</span>  <span class=c1>// A&lt;T*&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a3</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>  <span class=c1>// A&lt;T(&amp;)[N]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x0</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>  <span class=c1>// A&lt;T(&amp;)[]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x1</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>5</span><span class=p>);</span>  <span class=c1>// A&lt;T*&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x2</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>  <span class=c1>// A&lt;T(&amp;)[]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x3</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>  <span class=c1>// A&lt;T(&amp;)[]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>42</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>extern</span> <span class=kt>int</span> <span class=n>x</span><span class=p>[];</span>  <span class=c1>// 传引用时将变为 int(&amp;)[]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>  <span class=c1>// A&lt;T[]&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>x</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>  <span class=c1>// 定义前置声明的数组
</span></span></span></code></pre></td></tr></table></div></div><h2 id=零初始化zero-initialization class=headerLink><a href=#%e9%9b%b6%e5%88%9d%e5%a7%8b%e5%8c%96zero-initialization class=header-mark></a>9 零初始化（Zero Initialization）</h2><ul><li>使用模板时常希望模板类型的变量已经用默认值初始化，但内置类型无法满足要求。解决方法是显式调用内置类型的默认构造函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>T</span> <span class=n>default_value</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>x</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DefaultValue</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=nf>DefaultValue</span><span class=p>()</span> <span class=o>:</span> <span class=n>value</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DefaultValue2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>value</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>default_value</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>default_value</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>default_value</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>default_value</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue2</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue2</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue2</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>DefaultValue2</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=类模板httpsencppreferencecomwcpplanguageclass_template class=headerLink><a href=#%e7%b1%bb%e6%a8%a1%e6%9d%bfhttpsencppreferencecomwcpplanguageclass_template class=header-mark></a>10 <a href=https://en.cppreference.com/w/cpp/language/class_template target=_blank rel="noopener noreferrer">类模板</a></h2><ul><li>和函数类似，类也支持泛型，比如实现一个基于拓扑排序遍历的有向无环图的森林</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span><span class=lnt>447
</span><span class=lnt>448
</span><span class=lnt>449
</span><span class=lnt>450
</span><span class=lnt>451
</span><span class=lnt>452
</span><span class=lnt>453
</span><span class=lnt>454
</span><span class=lnt>455
</span><span class=lnt>456
</span><span class=lnt>457
</span><span class=lnt>458
</span><span class=lnt>459
</span><span class=lnt>460
</span><span class=lnt>461
</span><span class=lnt>462
</span><span class=lnt>463
</span><span class=lnt>464
</span><span class=lnt>465
</span><span class=lnt>466
</span><span class=lnt>467
</span><span class=lnt>468
</span><span class=lnt>469
</span><span class=lnt>470
</span><span class=lnt>471
</span><span class=lnt>472
</span><span class=lnt>473
</span><span class=lnt>474
</span><span class=lnt>475
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;algorithm&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;map&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;memory&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;queue&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;set&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unordered_set&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>DAGNode</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>K</span> <span class=n>k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>V</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;</span> <span class=n>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;</span> <span class=n>out</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DAGGraph</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=n>AddEdge</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>from</span><span class=p>,</span> <span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>V</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>Exist</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>Size</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>Walk</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=kt>bool</span> <span class=n>start_from_head</span> <span class=o>=</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>WalkHeads</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>WalkTails</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>NextKeys</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>NextKeys</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=n>IsCyclic</span><span class=p>(</span><span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>from</span><span class=p>,</span> <span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>to</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>RefreshWalkSequences</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>ConnectedComponents</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>DFS</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;*</span> <span class=n>visited</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;*</span> <span class=n>connected_components</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>TopologicalSequence</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=n>connected_components</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=kt>bool</span> <span class=n>start_from_head</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>bucket_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>heads_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>tails_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>sequences_start_from_head_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>sequences_start_from_tail_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=n>allow_modify_</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>sequences_start_from_head_for_next_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>current_heads_for_next_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>AddEdge</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>from</span><span class=p>,</span> <span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>to</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>allow_modify_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>from</span> <span class=o>==</span> <span class=n>to</span> <span class=o>||</span> <span class=o>!</span><span class=n>bucket_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>from</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=n>bucket_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>to</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>      <span class=n>IsCyclic</span><span class=p>(</span><span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>from</span><span class=p>),</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>to</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>from</span><span class=p>).</span><span class=n>out</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=o>&amp;</span><span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>to</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>to</span><span class=p>).</span><span class=n>in</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=o>&amp;</span><span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>from</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>heads_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>to</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>tails_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>from</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_tail_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=k>operator</span><span class=p>[](</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>bucket_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>allow_modify_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bucket_</span><span class=p>[</span><span class=n>key</span><span class=p>].</span><span class=n>k</span> <span class=o>=</span> <span class=n>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>heads_</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>tails_</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>sequences_start_from_tail_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>).</span><span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>Exist</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>Clear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>allow_modify_</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>bucket_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>heads_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>tails_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_tail_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>Size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>Walk</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                 <span class=kt>bool</span> <span class=n>start_from_head</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RefreshWalkSequences</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;&amp;</span> <span class=n>seqs_to_walk</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>start_from_head</span> <span class=o>?</span> <span class=nl>sequences_start_from_head_</span> <span class=p>:</span> <span class=n>sequences_start_from_tail_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=nl>seq</span> <span class=p>:</span> <span class=n>seqs_to_walk</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>for_each</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>node</span> <span class=o>=</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>f</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=n>k</span><span class=p>,</span> <span class=n>node</span><span class=p>.</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>WalkHeads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RefreshWalkSequences</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=nl>seq</span> <span class=p>:</span> <span class=n>sequences_start_from_head_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>for_each</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>heads_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>node</span> <span class=o>=</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=n>k</span><span class=p>,</span> <span class=n>node</span><span class=p>.</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>WalkTails</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RefreshWalkSequences</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=nl>seq</span> <span class=p>:</span> <span class=n>sequences_start_from_tail_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>for_each</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>tails_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>node</span> <span class=o>=</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=n>k</span><span class=p>,</span> <span class=n>node</span><span class=p>.</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>NextKeys</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>allow_modify_</span><span class=p>);</span>  <span class=c1>// allowed call once unless Clear()
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>allow_modify_</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>current_heads_for_next_</span> <span class=o>=</span> <span class=n>heads_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RefreshWalkSequences</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>heads_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>NextKeys</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>allow_modify_</span><span class=p>);</span>  <span class=c1>// must call NextKeys() before
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>current_heads_for_next_</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>current_heads_for_next_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=nl>seq</span> <span class=p>:</span> <span class=n>sequences_start_from_head_for_next_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>it</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>find</span><span class=p>(</span><span class=n>begin</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>it</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>seq</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;&amp;</span> <span class=n>nodes</span> <span class=o>=</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>).</span><span class=n>out</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>nodes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;&amp;</span> <span class=n>prev_nodes</span> <span class=o>=</span> <span class=n>v</span><span class=o>-&gt;</span><span class=n>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>bool</span> <span class=n>no_prev_node_in_seq</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>          <span class=n>std</span><span class=o>::</span><span class=n>all_of</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>prev_nodes</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>prev_nodes</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                      <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=n>in_node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>find</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                         <span class=n>in_node</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>)</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>seq</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                      <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>no_prev_node_in_seq</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>current_heads_for_next_</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>IsCyclic</span><span class=p>(</span><span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>from</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=k>const</span> <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&amp;</span> <span class=n>to</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>queue</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;</span> <span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>from</span><span class=p>.</span><span class=n>in</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;</span> <span class=n>visited</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=n>node</span> <span class=o>=</span> <span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>visited</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>node</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>node</span> <span class=o>==</span> <span class=o>&amp;</span><span class=n>to</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>visited</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>node</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>node</span><span class=o>-&gt;</span><span class=n>in</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>q</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>RefreshWalkSequences</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_tail_</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>connected_components</span> <span class=o>=</span> <span class=n>ConnectedComponents</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=nl>x</span> <span class=p>:</span> <span class=n>connected_components</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>seq_from_head</span> <span class=o>=</span> <span class=n>TopologicalSequence</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>seq_from_tail</span> <span class=o>=</span> <span class=n>TopologicalSequence</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>seq_from_head</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>seq_from_tail</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>sequences_start_from_head_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>seq_from_head</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>sequences_start_from_tail_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>seq_from_tail</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>sequences_start_from_head_for_next_</span> <span class=o>=</span> <span class=n>sequences_start_from_head_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>ConnectedComponents</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>visited</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>&amp;</span> <span class=nl>x</span> <span class=p>:</span> <span class=n>bucket_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DFS</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>second</span><span class=p>.</span><span class=n>k</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>visited</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>tmp</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>res</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>sort</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>res</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>end</span><span class=p>(</span><span class=n>res</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>DFS</span><span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;*</span> <span class=n>visited</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;*</span> <span class=n>connected_components</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>visited</span><span class=o>-&gt;</span><span class=n>count</span><span class=p>(</span><span class=n>k</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>visited</span><span class=o>-&gt;</span><span class=n>emplace</span><span class=p>(</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>connected_components</span><span class=o>-&gt;</span><span class=n>emplace</span><span class=p>(</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>k</span><span class=p>).</span><span class=n>in</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>k</span><span class=p>).</span><span class=n>in</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>DFS</span><span class=p>(</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>,</span> <span class=n>visited</span><span class=p>,</span> <span class=n>connected_components</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>k</span><span class=p>).</span><span class=n>out</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>k</span><span class=p>).</span><span class=n>out</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>DFS</span><span class=p>(</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>,</span> <span class=n>visited</span><span class=p>,</span> <span class=n>connected_components</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;::</span><span class=n>TopologicalSequence</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&amp;</span> <span class=n>connected_components</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>start_from_head</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;&gt;</span> <span class=n>adjacency_list</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=kt>int32_t</span><span class=o>&gt;</span> <span class=n>in_degree</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=nl>key</span> <span class=p>:</span> <span class=n>connected_components</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>in_degree</span><span class=p>.</span><span class=n>count</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>in_degree</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*&gt;&amp;</span> <span class=n>nodes</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>start_from_head</span> <span class=o>?</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>).</span><span class=nl>out</span> <span class=p>:</span> <span class=n>bucket_</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>key</span><span class=p>).</span><span class=n>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>DAGNode</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;*</span> <span class=nl>v</span> <span class=p>:</span> <span class=n>nodes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>adjacency_list</span><span class=p>[</span><span class=n>key</span><span class=p>].</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=o>++</span><span class=n>in_degree</span><span class=p>[</span><span class=n>v</span><span class=o>-&gt;</span><span class=n>k</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>queue</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>&amp;</span> <span class=nl>x</span> <span class=p>:</span> <span class=n>in_degree</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>second</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>q</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>first</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>q</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>K</span> <span class=n>key</span> <span class=o>=</span> <span class=n>q</span><span class=p>.</span><span class=n>front</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=nl>k</span> <span class=p>:</span> <span class=n>adjacency_list</span><span class=p>[</span><span class=n>key</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>--</span><span class=n>in_degree</span><span class=p>.</span><span class=n>at</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>res</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>connected_components</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>  <span class=c1>// graph is DAG
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MockPipelineEngine</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>Start</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>Stop</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>Destroy</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>DAGGraph</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MockPipelineEngine</span><span class=o>&gt;&gt;</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Make Direct Acyclic Graph:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//    0    6      11  13
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   / \   |      |
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//  1   3  7  8   12
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//  | x |      \ /
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//  2   4       9
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   \ /        |
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//    5         10
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Traverse each child graph in order whose size smaller
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Start Order:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 13
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 6 -&gt; 7
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 8 -&gt; 11 -&gt; 12 -&gt; 9 -&gt; 10
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 0 -&gt; 1 -&gt; 3 -&gt; 2 -&gt; 4 -&gt; 5
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Stop Order:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 13
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 7 -&gt; 6
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 10 -&gt; 9 -&gt; 8 -&gt; 12 -&gt; 11
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 5 -&gt; 2 -&gt; 4 -&gt; 1 -&gt; 3 -&gt; 0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>nodes_count</span> <span class=o>=</span> <span class=mi>14</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes_count</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>reset</span><span class=p>(</span><span class=k>new</span> <span class=n>MockPipelineEngine</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>9</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>Size</span><span class=p>()</span> <span class=o>==</span> <span class=n>nodes_count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes_count</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>Exist</span><span class=p>(</span><span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span> <span class=mi>6</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span> <span class=mi>13</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>AddEdge</span><span class=p>(</span><span class=mi>13</span><span class=p>,</span> <span class=mi>14</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>start_from_head</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>start_order</span><span class=p>{</span><span class=mi>13</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>.</span><span class=n>Walk</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=kt>int</span> <span class=n>key</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MockPipelineEngine</span><span class=o>&gt;&amp;</span> <span class=n>pipeline</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>pipeline</span><span class=o>-&gt;</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>start_from_head</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>v</span> <span class=o>==</span> <span class=n>start_order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>stop_order</span><span class=p>{</span><span class=mi>13</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>.</span><span class=n>Walk</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=kt>int</span> <span class=n>key</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MockPipelineEngine</span><span class=o>&gt;&amp;</span> <span class=n>pipeline</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>pipeline</span><span class=o>-&gt;</span><span class=n>Stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=o>!</span><span class=n>start_from_head</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>v</span> <span class=o>==</span> <span class=n>stop_order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>heads_order</span><span class=p>{</span><span class=mi>13</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>.</span><span class=n>WalkHeads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=kt>int</span> <span class=n>key</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MockPipelineEngine</span><span class=o>&gt;&amp;</span> <span class=n>pipeline</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>pipeline</span><span class=o>-&gt;</span><span class=n>Destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>v</span> <span class=o>==</span> <span class=n>heads_order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>tails_order</span><span class=p>{</span><span class=mi>13</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span><span class=p>.</span><span class=n>WalkTails</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=kt>int</span> <span class=n>key</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MockPipelineEngine</span><span class=o>&gt;&amp;</span> <span class=n>pipeline</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>pipeline</span><span class=o>-&gt;</span><span class=n>Destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>v</span> <span class=o>==</span> <span class=n>tails_order</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>test_sequence</span><span class=p>{</span><span class=mi>13</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span>  <span class=mi>1</span><span class=p>,</span>  <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                   <span class=mi>2</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>heads</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>13</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>NextKeys</span><span class=p>()</span> <span class=o>==</span> <span class=n>heads</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span> <span class=n>next_keys</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{},</span> <span class=p>{</span><span class=mi>7</span><span class=p>},</span> <span class=p>{},</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>},</span> <span class=p>{},</span> <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>},</span> <span class=p>{},</span> <span class=p>{</span><span class=mi>5</span><span class=p>},</span> <span class=p>{},</span> <span class=p>{},</span> <span class=p>{</span><span class=mi>12</span><span class=p>},</span> <span class=p>{</span><span class=mi>9</span><span class=p>},</span> <span class=p>{</span><span class=mi>10</span><span class=p>},</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>test_sequence</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>nodes_count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>next_keys</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>nodes_count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes_count</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>NextKeys</span><span class=p>(</span><span class=n>test_sequence</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>==</span> <span class=n>next_keys</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>d</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>Size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nodes_count</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>d</span><span class=p>.</span><span class=n>Exist</span><span class=p>(</span><span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc::test
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于不同类型模板参数的类模板，会为每个类型实例化出不同的类，类的函数被调用时才实例化，类模板的 static 数据成员会分别在每个不同的类中实例化，static 数据成员和成员函数只被同一个类共享。通过 <a href=https://github.com/andreasfertig/cppinsights target=_blank rel="noopener noreferrer">C++ Insights</a> 可以查看类的实例化代码，该工具提供了<a href=https://cppinsights.io/ target=_blank rel="noopener noreferrer">在线版本</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>value</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>    <span class=c1>// 实例化 A&lt;void&gt;::n
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>;</span>  <span class=c1>// 实例化 A&lt;int&gt;::n，bc 共享 A&lt;int&gt;::value() 和 A&lt;int&gt;::n
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>();</span>  <span class=c1>// 实例化 A&lt;double&gt;::value()
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>n</span> <span class=o>=</span> <span class=n>b</span><span class=p>.</span><span class=n>value</span><span class=p>();</span>               <span class=c1>// 使用 A&lt;int&gt;::value()
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>n</span> <span class=o>=</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>();</span>  <span class=c1>// 必须指定模板参数以确定实例化版本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>由于函数被调用时才实例化，如果不调用实例化时会出错的函数，代码也能通过编译</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>value</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>f</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// OK，实例化 A&lt;void&gt;::n
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   a.value();         // 实例化错误，f 未声明
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   A&lt;void&gt;::value();  // 实例化错误，f 未声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=友元 class=headerLink><a href=#%e5%8f%8b%e5%85%83 class=header-mark></a>11 友元</h2><ul><li>类内定义友元可以省略模板参数，但友元函数在类模板实例化后才会实例化，如果类模板中的友元函数不包含模板参数，则会出现重定义的错误</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;typeinfo&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 类作用域内的 A 是注入类名，等价于 A&lt;T&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>friend</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;A&lt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>typeid</span><span class=p>(</span><span class=n>T</span><span class=p>).</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&gt; = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// 实例化 operator&lt;&lt;(std::ostream&amp;, const A&lt;void&gt;&amp;) 和 f()
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// A&lt;void&gt; = 0
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// jc::A&lt;int&gt; b;    // 错误：第二次实例化 f()，重定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类外定义友元不会有重定义的问题，需要在类内声明处为类模板额外指定不同的模板参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;typeinfo&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>void</span> <span class=nf>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;A&lt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>typeid</span><span class=p>(</span><span class=n>T</span><span class=p>).</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&gt; = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// A&lt;void&gt; = 0
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>b</span><span class=p>;</span>  <span class=c1>// A&lt;int&gt; = 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果要在类外定义友元，又不想在类内声明额外指定模板参数，则可以将友元声明为函数模板，在类内使用模板实例作为友元</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;typeinfo&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;A&lt;&#34;</span> <span class=o>&lt;&lt;</span> <span class=k>typeid</span><span class=p>(</span><span class=n>T</span><span class=p>).</span><span class=n>name</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;&gt; = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// A&lt;void&gt; = 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果将类模板实例声明为友元，则类模板必须已声明并可见</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Tree</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=k>class</span> <span class=nc>Node</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// 友元类模板必须已声明并可见
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>friend</span> <span class=k>class</span> <span class=nc>A</span><span class=p>;</span>        <span class=c1>// 友元类可以未声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板参数可以是友元</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=n>T</span><span class=p>;</span>  <span class=c1>// 如果 T 不是 class 则忽略
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>a</span><span class=p>.</span><span class=n>n</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization class=headerLink><a href=#%e7%89%b9%e5%8c%96specializationhttpsencppreferencecomwcpplanguagetemplate_specialization class=header-mark></a>12 <a href=https://en.cppreference.com/w/cpp/language/template_specialization target=_blank rel="noopener noreferrer">特化（Specialization）</a></h2><ul><li>特化一般指的是全特化，即为一种特定类型指定一个特定实现，该类型将不使用模板的实例化版本</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>g</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>g</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization class=headerLink><a href=#%e5%81%8f%e7%89%b9%e5%8c%96partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization class=header-mark></a>13 <a href=https://en.cppreference.com/w/cpp/language/partial_specialization target=_blank rel="noopener noreferrer">偏特化（Partial Specialization）</a></h2><ul><li>偏特化是为一类类型指定特定实现，是一种更通用的特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>g</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>g</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;*&gt;</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>g</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>偏特化可以指定多个模板参数之间的关系，如果多个偏特化匹配程度相同，将产生二义性错误。如果模板声明是一个普通声明（没有在模板名称后添加尖括号），这个声明就是一个主模板（primary template），编写偏特化通常会有一个主模板和其他偏特化模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>  <span class=c1>// primary template
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*</span><span class=p>,</span> <span class=n>U</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;::</span><span class=n>j</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>double</span><span class=o>*&gt;::</span><span class=n>k</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//   A&lt;int, int&gt;{};    // 错误，匹配 A&lt;T, T&gt; 和 A&lt;T, int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   A&lt;int*, int*&gt;{};  // 错误，匹配 A&lt;T, T&gt; 和 A&lt;T*, U*&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果多个特化中，有一个匹配程度最高，则不会有二义性错误</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*</span><span class=p>,</span> <span class=n>U</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*</span><span class=p>,</span> <span class=n>T</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;::</span><span class=n>j</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>double</span><span class=o>*&gt;::</span><span class=n>k</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;::</span><span class=n>k</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;::</span><span class=n>k</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>*</span><span class=p>,</span> <span class=kt>double</span><span class=o>*&gt;::</span><span class=n>k</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>偏特化常用于元编程</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Tuple</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_among</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Tuple</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_among</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>disjunction</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>List</span><span class=o>&gt;</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Tuple</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_among_v</span> <span class=o>=</span> <span class=n>is_among</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Tuple</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_among_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_among_v</span><span class=o>&lt;</span><span class=kt>float</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>偏特化遍历 <a href=https://en.cppreference.com/w/cpp/utility/tuple target=_blank rel="noopener noreferrer">std::tuple</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>Index</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>PrintImpl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=nf>impl</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PrintImpl</span><span class=o>&lt;</span><span class=n>Index</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>List</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>impl</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>PrintImpl</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>List</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=nf>impl</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Print</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>PrintImpl</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>List</span><span class=p>),</span> <span class=n>List</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>impl</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=s>&#34;hello world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Print</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>  <span class=c1>// 3.14 42 hello world
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/member_template target=_blank rel="noopener noreferrer">成员模板</a>也能特化或偏特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>as</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=n>A</span><span class=o>::</span><span class=n>as</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>s</span> <span class=o>==</span> <span class=s>&#34;true&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>as</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>a</span><span class=p>.</span><span class=n>as</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b</span><span class=p>{</span><span class=s>&#34;true&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>as</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>成员函数模板不能为虚函数，因为虚函数表的大小是固定的，而成员函数模板的实例化个数要编译完成后才能确定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Dynamic</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=o>~</span><span class=n>Dynamic</span><span class=p>()</span> <span class=p>{}</span>  <span class=c1>// OK，每个 Dynamic&lt;T&gt; 对应一个析构函数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{}</span>  <span class=c1>// 错误，编译器不知道一个 Dynamic&lt;T&gt; 中 f() 个数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=模板的模板参数template-template-parameter class=headerLink><a href=#%e6%a8%a1%e6%9d%bf%e7%9a%84%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0template-template-parameter class=header-mark></a>14 模板的模板参数（Template Template Parameter）</h2><ul><li>如果模板参数的类型是类模板，则需要使用模板的模板参数。对于模板的模板参数，C++11 之前只能用 class 关键字修饰，C++11 及其之后可以用别名模板的名称来替代，C++17 可以用 typename 修饰</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;set&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>Container</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>set</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实际上容器还有一个模板参数，即内存分配器 allocator</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;deque&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Elem</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>allocator</span><span class=o>&lt;</span><span class=n>Elem</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=k>class</span> <span class=nc>Container</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>deque</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Stack</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>reference</span> <span class=o>=</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>const_reference</span> <span class=o>=</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=k>class</span> <span class=nc>Stack</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Elem2</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>allocator</span><span class=o>&lt;</span><span class=n>Elem2</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>            <span class=k>class</span> <span class=nc>Container2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>U</span><span class=p>,</span> <span class=n>Container2</span><span class=o>&gt;&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>push</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>reference</span> <span class=nf>top</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>const_reference</span> <span class=nf>top</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>empty</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Container</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>container_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;&amp;</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=k>operator</span><span class=o>=</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>U</span><span class=p>,</span> <span class=n>Container2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>container_</span><span class=p>.</span><span class=n>assign</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>container_</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>container_</span><span class=p>.</span><span class=n>end</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>push</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>container_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>pop</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>container_</span><span class=p>.</span><span class=n>pop_back</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>typename</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>reference</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>top</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>container_</span><span class=p>.</span><span class=n>back</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>typename</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>const_reference</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>top</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>container_</span><span class=p>.</span><span class=n>back</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>container_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>bool</span> <span class=n>Stack</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Container</span><span class=o>&gt;::</span><span class=n>empty</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>container_</span><span class=p>.</span><span class=n>empty</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Stack</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>s</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>s</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=s>&#34;world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>top</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>s</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>top</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>s</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=非类型模板参数non-type-template-parameterhttpsencppreferencecomwcpplanguagetemplate_parametersnon-type_template_parameter class=headerLink><a href=#%e9%9d%9e%e7%b1%bb%e5%9e%8b%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0non-type-template-parameterhttpsencppreferencecomwcpplanguagetemplate_parametersnon-type_template_parameter class=header-mark></a>15 <a href=https://en.cppreference.com/w/cpp/language/template_parameters#Non-type_template_parameter target=_blank rel="noopener noreferrer">非类型模板参数（Non-type Template Parameter）</a></h2><ul><li>非类型模板参数表示在编译期或链接期可以确定的常量值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;bitset&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>IsSet</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>find_next</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>cur</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=n>cur</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>test</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>^</span> <span class=n>IsSet</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>IsSet</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>find_prev</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>cur</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>cur</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>cur</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>--</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>test</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>^</span> <span class=n>IsSet</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>IsSet</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>circular_find_next</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>cur</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>cur</span> <span class=o>&gt;</span> <span class=n>N</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>cur</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>res</span> <span class=o>=</span> <span class=n>find_next</span><span class=o>&lt;</span><span class=n>IsSet</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>cur</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>res</span> <span class=o>!=</span> <span class=n>N</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>cur</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>test</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>^</span> <span class=n>IsSet</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>IsSet</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>circular_find_prev</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>cur</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=n>N</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>res</span> <span class=o>=</span> <span class=n>find_prev</span><span class=o>&lt;</span><span class=n>IsSet</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>cur</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>res</span> <span class=o>!=</span> <span class=n>N</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=n>N</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=n>cur</span><span class=p>;</span> <span class=o>--</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>test</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>^</span> <span class=n>IsSet</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_find_next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=mi>8</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=s>&#34;10010111&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_next_set</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_next_unset</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>size</span><span class=p>(</span><span class=n>_next_set</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>find_next</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_next_set</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>find_next</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_next_unset</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_find_prev</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=mi>8</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=s>&#34;10010110&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_prev_set</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_prev_unset</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>8</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>size</span><span class=p>(</span><span class=n>_prev_set</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>find_prev</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_prev_set</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>find_prev</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_prev_unset</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_circular_find_next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=mi>8</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=s>&#34;01010111&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_next_set</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_next_unset</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>size</span><span class=p>(</span><span class=n>_next_set</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>circular_find_next</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_next_set</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>circular_find_next</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_next_unset</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_circular_find_prev</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>bitset</span><span class=o>&lt;</span><span class=mi>8</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=s>&#34;10011001&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_prev_set</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>_prev_unset</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>size</span><span class=p>(</span><span class=n>_prev_set</span><span class=p>);</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>circular_find_prev</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_prev_set</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>circular_find_prev</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>==</span> <span class=n>_prev_unset</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>test_find_next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_find_prev</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_circular_find_next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_circular_find_prev</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板参数可以由之前的参数推断类型，C++17 允许将非类型模板参数定义为 auto 或 decltype(auto)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>get_class</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>ClassType</span><span class=p>,</span> <span class=k>typename</span> <span class=n>MemberType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>get_class</span><span class=o>&lt;</span><span class=n>MemberType</span> <span class=n>ClassType</span><span class=o>::*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>ClassType</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>get_class_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>auto</span> <span class=n>ClassMember</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Wrapper</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Wrapper</span><span class=p>(</span><span class=n>get_class_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>ClassMember</span><span class=p>)</span><span class=o>&gt;&amp;</span> <span class=n>obj</span><span class=p>)</span> <span class=o>:</span> <span class=n>obj_</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>increase</span><span class=p>()</span> <span class=p>{</span> <span class=o>++</span><span class=p>(</span><span class=n>obj_</span><span class=p>.</span><span class=o>*</span><span class=n>ClassMember</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>get_class_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>ClassMember</span><span class=p>)</span><span class=o>&gt;&amp;</span> <span class=n>obj_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Wrapper</span><span class=o>&lt;&amp;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>::</span><span class=n>i</span><span class=o>&gt;</span><span class=p>{</span><span class=n>a</span><span class=p>}.</span><span class=n>increase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++14 允许 auto 作返回类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>add</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=k>const</span> <span class=n>U</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>add</span><span class=p>(</span><span class=sc>&#39;A&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=o>==</span> <span class=sc>&#39;C&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=限制 class=headerLink><a href=#%e9%99%90%e5%88%b6 class=header-mark></a>16 限制</h2><ul><li>C++20 之前，非类型模板参数不能是浮点数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>auto</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>N</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=mi>42</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=mf>3.14</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>  <span class=c1>// C++20
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>不能用字符串字面值常量、临时对象、数据成员或其他子对象作模板实参。C++ 标准演进过程中逐渐放宽了对字符数组作为模板实参的限制，C++11 仅允许外链接（external linkage，不定义于单一的文件作用域，链接到全局符号表），C++14 允许外链接或内链接（internal linkage，只能在单个文件内部看到，不能被其他文件访问，不暴露给链接器），C++17 不要求链接</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>s</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>s1</span> <span class=o>=</span> <span class=s>&#34;hello&#34;</span><span class=p>;</span>  <span class=c1>// 内链接对象的指针
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>extern</span> <span class=k>const</span> <span class=kt>char</span> <span class=n>s2</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;world&#34;</span><span class=p>;</span>    <span class=c1>// 外链接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>char</span> <span class=n>s3</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;down&#34;</span><span class=p>;</span>            <span class=c1>// 内链接
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>const</span> <span class=kt>char</span> <span class=n>s4</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>  <span class=c1>// 无链接
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=s>&#34;downdemo&#34;</span><span class=o>&gt;</span><span class=p>{};</span>              <span class=c1>// 错误
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>s1</span><span class=o>&gt;</span><span class=p>{};</span>                      <span class=c1>// 错误
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>s2</span><span class=o>&gt;</span><span class=p>{};</span>                      <span class=c1>// C++11 允许
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>s3</span><span class=o>&gt;</span><span class=p>{};</span>                      <span class=c1>// C++14 允许
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>s4</span><span class=o>&gt;</span><span class=p>{};</span>                      <span class=c1>// C++17 允许
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>非类型模板参数可以是左值引用，此时实参必须是静态常量</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span><span class=o>&amp;</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=p>{</span> <span class=o>++</span><span class=n>N</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>A</span><span class=p>()</span> <span class=p>{</span> <span class=o>--</span><span class=n>N</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>&lt;</span><span class=n>n</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>n</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>函数和数组类型作为非类型模板参数会退化为指针类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>buf</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Lexer</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;int* buf&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// struct Lexer {};  // 错误：重定义
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>fun</span><span class=p>()</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FuncWrap</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;int (*)()&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// struct FuncWrap {};  // 错误：重定义
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果模板实参的表达式有大于号，必须用小括号包裹表达式，否则大于号会被编译器视为表示参数列表终止的右尖括号，导致编译错误</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>b</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>inline</span> <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=变量模板variable-templatehttpsencppreferencecomwcpplanguagevariable_template class=headerLink><a href=#%e5%8f%98%e9%87%8f%e6%a8%a1%e6%9d%bfvariable-templatehttpsencppreferencecomwcpplanguagevariable_template class=header-mark></a>17 <a href=https://en.cppreference.com/w/cpp/language/variable_template target=_blank rel="noopener noreferrer">变量模板（Variable Template）</a></h2><ul><li>C++14 提供了变量模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span> <span class=o>=</span> <span class=kt>double</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>T</span> <span class=n>pi</span><span class=p>{</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=mf>3.1415926535897932385</span><span class=p>)};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>pi</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=o>==</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>pi</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>pi</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=o>==</span> <span class=mf>3.1415926535897932385</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>pi</span><span class=o>&lt;&gt;</span> <span class=o>==</span> <span class=mf>3.1415926535897932385</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>变量模板可以由非类型参数参数化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;</span> <span class=n>arr</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>auto</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>decltype</span><span class=p>(</span><span class=n>N</span><span class=p>)</span> <span class=n>x</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>x</span><span class=o>&lt;</span><span class=sc>&#39;c&#39;</span><span class=o>&gt;</span> <span class=o>==</span> <span class=sc>&#39;c&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>arr</span><span class=o>&lt;</span><span class=mi>10</span><span class=o>&gt;</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>arr</span><span class=o>&lt;</span><span class=mi>10</span><span class=o>&gt;</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=变参模板variadic-template class=headerLink><a href=#%e5%8f%98%e5%8f%82%e6%a8%a1%e6%9d%bfvariadic-template class=header-mark></a>18 变参模板（Variadic Template）</h2><ul><li>如果函数要接受任意数量任意类型的参数，没有模板时可以通过 <a href=https://en.cppreference.com/w/cpp/utility/variadic/va_list target=_blank rel="noopener noreferrer">std::va_list</a> 实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdarg&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdio&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=p>...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>va_list</span> <span class=n>args</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>va_start</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>n</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>va_arg</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=kt>double</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>va_arg</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=kt>int</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>va_arg</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span><span class=p>),</span> <span class=s>&#34;hello&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>va_arg</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span><span class=p>),</span> <span class=s>&#34;world&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>va_end</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>fmt</span><span class=p>,</span> <span class=p>...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>256</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>va_list</span> <span class=n>args</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>va_start</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>fmt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vsnprintf</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=n>fmt</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>va_end</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=s>&#34;3.14 42 hello world&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>}.</span><span class=n>c_str</span><span class=p>(),</span> <span class=s>&#34;world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>(</span><span class=s>&#34;%.2f %d %s %s&#34;</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>}.</span><span class=n>c_str</span><span class=p>(),</span> <span class=s>&#34;world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++11 引入了变参模板，用省略号表示一个<a href=https://en.cppreference.com/w/cpp/language/parameter_pack target=_blank rel="noopener noreferrer">参数包</a>，类型名后接省略号表示任意数量给定类型的参数。在表达式后跟省略号，如果表达式中有参数包，就会把表达式应用到参数包中的每个参数。如果表达式中出现两次参数包，对整个表达式扩展，而不会做笛卡尔积计算</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print</span><span class=p>()</span> <span class=p>{}</span>  <span class=c1>// 参数包展开到零参数时调用
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>t</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;,&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=p>,</span> <span class=kt>int</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>test1</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>Index</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)...);</span>  <span class=c1>// print(std::get&lt;2&gt;(t), std::get&lt;3&gt;(t));
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=p>,</span> <span class=kt>int</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>test2</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>Index</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>))...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test1</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span><span class=p>{});</span>     <span class=c1>// hello,world
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>test2</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;</span><span class=p>{});</span>  <span class=c1>// 6.28,84,hellohello,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>注意参数包的省略号不能直接接在数值字面值后</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>args</span> <span class=o>+</span> <span class=mf>1.</span><span class=p>..);</span>    <span class=c1>// ERROR：1... 是带多个小数点的字面值，不合法
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>print</span><span class=p>(</span><span class=n>args</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>...);</span>   <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>print</span><span class=p>((</span><span class=n>args</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)...);</span>  <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>可以直接用逗号运算符做参数包扩展，逗号左侧是对参数包每个元素做的操作，右侧是一个无关紧要的值，这样展开后对每个元素都做了操作，并形成了一个以无关值为元素的数组，这个数组无作用，只是为了满足扩展时省略号不能为表达式最后的 token 而引入</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{(</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>,</span> <span class=mi>0</span><span class=p>)...};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++11 引入了 <a href=https://en.cppreference.com/w/cpp/language/sizeof... target=_blank rel="noopener noreferrer">sizeof&mldr;</a> 在编译期计算参数包中的元素数，C++17 引入了 if constexpr 判断编译期值，编译期结果为 true 才会实例化代码</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>t</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 不能用 if，因为零长包也会实例化代码
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>print</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>  <span class=c1>// 当条件满足时才实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在 C++11 中可以利用偏特化来达到 if constexpr 的效果</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>b</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>t</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>b</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=nf>f</span><span class=p>(...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=折叠表达式fold-expressionhttpsencppreferencecomwcpplanguagefold class=headerLink><a href=#%e6%8a%98%e5%8f%a0%e8%a1%a8%e8%be%be%e5%bc%8ffold-expressionhttpsencppreferencecomwcpplanguagefold class=header-mark></a>19 <a href=https://en.cppreference.com/w/cpp/language/fold target=_blank rel="noopener noreferrer">折叠表达式（Fold Expression）</a></h2><ul><li>C++17 引入了折叠表达式，用于获取对所有参数包实参使用二元运算符的计算结果</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>sum</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>a</span> <span class=o>=</span> <span class=p>(...</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>));</span>      <span class=c1>// (((1 + 2) + 3) + 4)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>auto</span> <span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>+</span> <span class=p>...);</span>      <span class=c1>// (1 + (2 + (3 + 4)))
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>auto</span> <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=mi>5</span> <span class=o>+</span> <span class=p>...</span> <span class=o>+</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>));</span>  <span class=c1>// ((((5 + 1) + 2) + 3) + 4)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>auto</span> <span class=n>d</span> <span class=o>=</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>+</span> <span class=p>...</span> <span class=o>+</span> <span class=mi>5</span><span class=p>);</span>  <span class=c1>// (1 + (2 + (3 + (4 + 5))))
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>print1</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// operator&lt;&lt; 左折叠，std::cout 是初始值
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=p>...</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>print2</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// operator, 左折叠
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;,&#34;</span><span class=p>),</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>]</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>sum</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>print1</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>  <span class=c1>// 10101515
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>print2</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>  <span class=c1>// 10,10,15,15,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于空扩展需要决定类型和值，空的一元折叠表达式通常会产生错误，除了三种例外情况<ul><li>一个 && 的一元折叠的空扩展产生值 true</li><li>一个 || 的一元折叠的空扩展产生值 false</li><li>一个 , 的一元折叠空扩展产生一个 void 表达式</li></ul></li></ul><table><thead><tr><th style=text-align:center>折叠表达式</th><th style=text-align:center>计算结果</th></tr></thead><tbody><tr><td style=text-align:center>(&mldr; op pack)</td><td style=text-align:center>(((pack1 op pack2) op pack3) &mldr; op PackN)</td></tr><tr><td style=text-align:center>(pack op &mldr;)</td><td style=text-align:center>(pack1 op (&mldr; (packN-1 op packN)))</td></tr><tr><td style=text-align:center>(init op &mldr; op pack)</td><td style=text-align:center>(((init op pack1) op pack2) &mldr; op PackN)</td></tr><tr><td style=text-align:center>(pack op &mldr; op init)</td><td style=text-align:center>(pack1 op (&mldr; (packN op init)))</td></tr></tbody></table><ul><li>折叠表达式借鉴的是 Haskell 的 fold</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hs data-lang=hs><span class=line><span class=cl><span class=kr>import</span> <span class=nn>Data.List</span> <span class=p>(</span><span class=nf>foldl&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>foldlList</span> <span class=ow>::</span> <span class=p>[</span><span class=kt>Char</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>foldlList</span> <span class=ow>=</span> <span class=n>foldl&#39;</span> <span class=p>(</span><span class=nf>\</span><span class=n>x</span> <span class=n>y</span> <span class=ow>-&gt;</span> <span class=n>concat</span> <span class=p>[</span><span class=s>&#34;(&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=s>&#34;+&#34;</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=s>&#34;)&#34;</span><span class=p>])</span> <span class=s>&#34;0&#34;</span> <span class=p>(</span><span class=n>map</span> <span class=n>show</span> <span class=p>[</span><span class=mi>1</span> <span class=o>..</span> <span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>foldrList</span> <span class=ow>::</span> <span class=p>[</span><span class=kt>Char</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>foldrList</span> <span class=ow>=</span> <span class=n>foldr</span> <span class=p>((</span><span class=nf>\</span><span class=n>x</span> <span class=n>y</span> <span class=ow>-&gt;</span> <span class=n>concat</span> <span class=p>[</span><span class=s>&#34;(&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=s>&#34;+&#34;</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=s>&#34;)&#34;</span><span class=p>])</span> <span class=o>.</span> <span class=n>show</span><span class=p>)</span> <span class=s>&#34;0&#34;</span> <span class=p>[</span><span class=mi>1</span> <span class=o>..</span> <span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>main</span> <span class=ow>::</span> <span class=kt>IO</span> <span class=nb>()</span>
</span></span><span class=line><span class=cl><span class=nf>main</span> <span class=ow>=</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>  <span class=n>putStrLn</span> <span class=n>foldlList</span> <span class=c1>-- ((((0+1)+2)+3)+4)</span>
</span></span><span class=line><span class=cl>  <span class=n>putStrLn</span> <span class=n>foldrList</span> <span class=c1>-- (1+(2+(3+(4+0))))</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实现与 Haskell 类似的左折叠和右折叠</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>foldlList</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>zero</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Args</span><span class=p>),</span> <span class=sc>&#39;(&#39;</span><span class=p>))),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>zero</span><span class=p>)))),</span>
</span></span><span class=line><span class=cl>   <span class=p>...,</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=sc>&#39;+&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>x</span><span class=p>))),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=sc>&#39;)&#39;</span><span class=p>))));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>foldrList</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>zero</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=sc>&#39;(&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>x</span><span class=p>))),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=sc>&#39;+&#39;</span><span class=p>))),</span>
</span></span><span class=line><span class=cl>   <span class=p>...,</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>zero</span><span class=p>))),</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Args</span><span class=p>),</span> <span class=sc>&#39;)&#39;</span><span class=p>)))));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>print</span> <span class=o>=</span> <span class=p>[](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>x</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>foldlList</span><span class=p>(</span><span class=n>print</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>  <span class=c1>// ((((0+1)+2)+3)+4)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>foldrList</span><span class=p>(</span><span class=n>print</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>  <span class=c1>// (1+(2+(3+(4+0))))
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>折叠表达式几乎可以使用所有二元运算符</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Node</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>val</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>val</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>left</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>right</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用 operator-&gt;* 的折叠表达式，用于遍历指定的二叉树路径
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Node</span><span class=o>*</span> <span class=n>traverse</span><span class=p>(</span><span class=n>T</span> <span class=n>root</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span> <span class=n>paths</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=n>root</span><span class=o>-&gt;*</span><span class=p>...</span><span class=o>-&gt;*</span><span class=n>paths</span><span class=p>);</span>  <span class=c1>// root -&gt;* paths1 -&gt;* paths2 ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>root</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>root</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>{</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>root</span><span class=o>-&gt;</span><span class=n>left</span><span class=o>-&gt;</span><span class=n>right</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>{</span><span class=mi>2</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>root</span><span class=o>-&gt;</span><span class=n>left</span><span class=o>-&gt;</span><span class=n>right</span><span class=o>-&gt;</span><span class=n>left</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>{</span><span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>left</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>Node</span><span class=o>::</span><span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>right</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>Node</span><span class=o>::</span><span class=n>right</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>node1</span> <span class=o>=</span> <span class=n>traverse</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>left</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>node1</span><span class=o>-&gt;</span><span class=n>val</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>node2</span> <span class=o>=</span> <span class=n>traverse</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>left</span><span class=p>,</span> <span class=n>right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>node2</span><span class=o>-&gt;</span><span class=n>val</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Node</span><span class=o>*</span> <span class=n>node3</span> <span class=o>=</span> <span class=n>traverse</span><span class=p>(</span><span class=n>node2</span><span class=p>,</span> <span class=n>left</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>node3</span><span class=o>-&gt;</span><span class=n>val</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>包扩展可以用于编译期表达式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_homogeneous</span><span class=p>(</span><span class=n>T</span><span class=p>,</span> <span class=n>Args</span><span class=p>...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Args</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span> <span class=p>...);</span>  <span class=c1>// operator&amp;&amp; 的折叠表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_homogeneous</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=s>&#34;hello&#34;</span><span class=p>,</span> <span class=s>&#34;world&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_homogeneous</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=s>&#34;world&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=变参模板的应用 class=headerLink><a href=#%e5%8f%98%e5%8f%82%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%ba%94%e7%94%a8 class=header-mark></a>20 变参模板的应用</h2><ul><li>无需指定类型，自动获取 <a href=https://en.cppreference.com/w/cpp/utility/variant target=_blank rel="noopener noreferrer">std::variant</a> 值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;variant&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>make_array_impl</span><span class=p>(</span><span class=n>F</span> <span class=n>f</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>N</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>invoke_result_t</span><span class=o>&lt;</span><span class=n>F</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=o>&gt;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>N</span><span class=p>)</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>N</span><span class=p>),</span> <span class=n>N</span><span class=o>&gt;</span><span class=p>{})...};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span> <span class=n>F</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>make_array</span><span class=p>(</span><span class=n>F</span> <span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>invoke_result_t</span><span class=o>&lt;</span><span class=n>F</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>make_array_impl</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Dst</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>get_value_impl</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=n>Dst</span><span class=o>&amp;</span> <span class=n>dst</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>holds_alternative</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Dst</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>dst</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>Dst</span><span class=o>&gt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Dst</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>get_value</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=n>Dst</span><span class=o>&amp;</span> <span class=n>dst</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Variant</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>F</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>(</span><span class=k>const</span> <span class=n>Variant</span><span class=o>&amp;</span><span class=p>,</span> <span class=n>Dst</span><span class=o>&amp;</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>auto</span> <span class=n>_list</span> <span class=o>=</span> <span class=n>make_array</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>List</span><span class=p>)</span><span class=o>&gt;</span><span class=p>([](</span><span class=k>auto</span> <span class=n>i</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>F</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=n>get_value_impl</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>variant_alternative_t</span><span class=o>&lt;</span><span class=n>i</span><span class=p>,</span> <span class=n>Variant</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Dst</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=n>List</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>_list</span><span class=p>[</span><span class=n>v</span><span class=p>.</span><span class=n>index</span><span class=p>()],</span> <span class=n>v</span><span class=p>,</span> <span class=n>dst</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>v</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;test&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get_value</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>s</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span> <span class=o>==</span> <span class=s>&#34;test&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get_value</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>字节序转换</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// https://en.cppreference.com/w/cpp/language/fold
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdint&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>size_t</span><span class=p>...</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>T</span> <span class=n>bswap_impl</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>N</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(((</span><span class=n>t</span> <span class=o>&gt;&gt;</span> <span class=n>N</span> <span class=o>*</span> <span class=mi>8</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>N</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span> <span class=o>|</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unsigned_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>U</span> <span class=n>bswap</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>bswap_impl</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>bswap</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=kt>uint32_t</span><span class=o>&gt;</span><span class=p>(</span><span class=mh>0x12345678u</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x78563412u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>((</span><span class=mh>0x12345678u</span> <span class=o>&gt;&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x12345678u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>((</span><span class=mh>0x12345678u</span> <span class=o>&gt;&gt;</span> <span class=mi>8</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x00123456u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>((</span><span class=mh>0x12345678u</span> <span class=o>&gt;&gt;</span> <span class=mi>16</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x00001234u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>((</span><span class=mh>0x12345678u</span> <span class=o>&gt;&gt;</span> <span class=mi>24</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x00000012u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>bswap</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=kt>uint16_t</span><span class=o>&gt;</span><span class=p>(</span><span class=mh>0x1234u</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x3412u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/user_literal target=_blank rel="noopener noreferrer">自定义字面值（User-defined literals）</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;algorithm&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>char</span><span class=p>...</span> <span class=n>args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=k>operator</span><span class=s>&#34;&#34;</span> <span class=n>_dbg</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>{</span><span class=n>args</span><span class=p>...};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>stringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=nl>x</span> <span class=p>:</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=cp>#ifndef NDEBUG
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=k>operator</span><span class=s>&#34;&#34;</span> <span class=n>_encrypt</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>c</span><span class=p>,</span> <span class=n>size_t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>{</span><span class=n>c</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>p</span><span class=p>{</span><span class=n>R</span><span class=s>&#34;(passwd: &#34;</span><span class=p>)</span><span class=s>&#34;};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>it</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>search</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span> <span class=n>s</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=n>std</span><span class=o>::</span><span class=n>boyer_moore_horspool_searcher</span><span class=p>{</span><span class=n>p</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span> <span class=n>p</span><span class=p>.</span><span class=n>end</span><span class=p>()});</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>it</span> <span class=o>!=</span> <span class=n>s</span><span class=p>.</span><span class=n>end</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=o>+=</span> <span class=n>p</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>it</span> <span class=o>!=</span> <span class=n>s</span><span class=p>.</span><span class=n>end</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=o>*</span><span class=n>it</span> <span class=o>!=</span> <span class=sc>&#39;\&#34;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=o>*</span><span class=n>it</span><span class=o>++</span> <span class=o>=</span> <span class=sc>&#39;*&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>#if !defined(NDEBUG)
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>s</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=mf>12.34</span><span class=n>_dbg</span> <span class=o>==</span> <span class=s>&#34;12.34&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=n>R</span><span class=s>&#34;JSON({</span>
</span></span><span class=line><span class=cl>  <span class=nl>data_dir</span><span class=p>:</span> <span class=s>&#34;C:\Users\downdemo\.data\*.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nl>user</span><span class=p>:</span> <span class=s>&#34;downdemo(accelerate rapidly)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nl>passwd</span><span class=p>:</span> <span class=s>&#34;123456&#34;</span>
</span></span><span class=line><span class=cl><span class=p>})</span><span class=n>JSON</span><span class=s>&#34;_encrypt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>R</span><span class=s>&#34;JSON({</span>
</span></span><span class=line><span class=cl>  <span class=nl>data_dir</span><span class=p>:</span> <span class=s>&#34;C:\Users\downdemo\.data\*.txt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nl>user</span><span class=p>:</span> <span class=s>&#34;downdemo(accelerate rapidly)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nl>passwd</span><span class=p>:</span> <span class=s>&#34;******&#34;</span>
</span></span><span class=line><span class=cl><span class=p>})</span><span class=n>JSON</span><span class=s>&#34;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>s</span> <span class=o>==</span> <span class=n>s2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>变参基类</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unordered_set&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A_EQ</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>operator</span><span class=p>()(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>s</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A_Hash</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=k>operator</span><span class=p>()(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>hash</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>{}(</span><span class=n>a</span><span class=p>.</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义一个组合所有基类的 operator() 的派生类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Bases</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Overloader</span> <span class=o>:</span> <span class=n>Bases</span><span class=p>...</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Bases</span><span class=o>::</span><span class=k>operator</span><span class=p>()...;</span>  <span class=c1>// C++17
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>A_OP</span> <span class=o>=</span> <span class=n>Overloader</span><span class=o>&lt;</span><span class=n>A_Hash</span><span class=p>,</span> <span class=n>A_EQ</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 将 A_EQ 和 A_Hash 组合到一个类型中
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=cm>/* unordered_set 的声明
</span></span></span><span class=line><span class=cl><span class=cm>  template&lt;
</span></span></span><span class=line><span class=cl><span class=cm>  class Key,
</span></span></span><span class=line><span class=cl><span class=cm>      class Hash = std::hash&lt;Key&gt;,
</span></span></span><span class=line><span class=cl><span class=cm>      class KeyEqual = std::equal_to&lt;Key&gt;,
</span></span></span><span class=line><span class=cl><span class=cm>      class Allocator = std::allocator&lt;Key&gt;
</span></span></span><span class=line><span class=cl><span class=cm>  &gt; class unordered_set;
</span></span></span><span class=line><span class=cl><span class=cm>  */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_Hash</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_EQ</span><span class=o>&gt;</span> <span class=n>s1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>unordered_set</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_OP</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_OP</span><span class=o>&gt;</span> <span class=n>s2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++14 使用 <a href=https://en.cppreference.com/w/cpp/utility/integer_sequence target=_blank rel="noopener noreferrer">std::integer_sequence</a> 遍历 <a href=https://en.cppreference.com/w/cpp/utility/tuple target=_blank rel="noopener noreferrer">std::tuple</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>apply_impl</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Index</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>apply</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>apply_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence_for</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Print</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=k>operator</span><span class=p>()(</span><span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>no_used</span> <span class=o>=</span> <span class=p>{(</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>args</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)...};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=s>&#34;hello world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>apply</span><span class=p>(</span><span class=n>Print</span><span class=p>{},</span> <span class=n>t</span><span class=p>);</span>  <span class=c1>// 3.14 42 hello world
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++11 未提供 <a href=https://en.cppreference.com/w/cpp/utility/integer_sequence target=_blank rel="noopener noreferrer">std::integer_sequence</a>，手动实现一个即可</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;tuple&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>index_sequence</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Index</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>List2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>concat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>List1</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>List2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>concat</span><span class=o>&lt;</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>List1</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>List2</span><span class=p>...</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>List1</span><span class=p>...,</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>List1</span><span class=p>)</span> <span class=o>+</span> <span class=n>List2</span><span class=p>)...</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>List2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>concat_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>concat</span><span class=o>&lt;</span><span class=n>List1</span><span class=p>,</span> <span class=n>List2</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>make_index_sequence_impl</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>concat_t</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>make_index_sequence_impl</span><span class=o>&lt;</span><span class=n>N</span> <span class=o>/</span> <span class=mi>2</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=k>typename</span> <span class=n>make_index_sequence_impl</span><span class=o>&lt;</span><span class=n>N</span> <span class=o>-</span> <span class=n>N</span> <span class=o>/</span> <span class=mi>2</span><span class=o>&gt;::</span><span class=n>type</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>make_index_sequence_impl</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>index_sequence</span><span class=o>&lt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>make_index_sequence_impl</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>make_index_sequence</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>make_index_sequence_impl</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>index_sequence_for</span> <span class=o>=</span> <span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Types</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>apply_impl</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Index</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>apply</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>apply_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>t</span><span class=p>,</span> <span class=n>index_sequence_for</span><span class=o>&lt;</span><span class=n>List</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Print</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=k>operator</span><span class=p>()(</span><span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>no_used</span> <span class=o>=</span> <span class=p>{(</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>args</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)...};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=s>&#34;hello world&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>apply</span><span class=p>(</span><span class=n>Print</span><span class=p>{},</span> <span class=n>t</span><span class=p>);</span>  <span class=c1>// 3.14 42 hello world
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=移动语义move-semantics class=headerLink><a href=#%e7%a7%bb%e5%8a%a8%e8%af%ad%e4%b9%89move-semantics class=header-mark></a>21 移动语义（Move Semantics）</h2><ul><li>C++11 的<a href=https://en.cppreference.com/w/cpp/language/value_category target=_blank rel="noopener noreferrer">值类别</a>包括左值（lvalue）、纯右值（prvalue）、亡值（xvalue），左值和亡值组成了泛左值（glvalue），纯右值和亡值组成了右值（rvalue）。为了让编译器识别接受右值作为参数的构造函数，则需要引入右值引用符号（&&），以区分移动构造函数和拷贝构造函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=o>:</span> <span class=n>data</span><span class=p>(</span><span class=k>new</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>data</span><span class=p>(</span><span class=k>new</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=o>*</span><span class=n>rhs</span><span class=p>.</span><span class=n>data</span><span class=p>})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>:</span> <span class=n>data</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>data</span><span class=p>)</span> <span class=p>{</span> <span class=n>rhs</span><span class=p>.</span><span class=n>data</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>A</span><span class=p>()</span> <span class=p>{</span> <span class=k>delete</span> <span class=n>data</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>*</span> <span class=n>data</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>{});</span>  <span class=c1>// 调用默认构造函数、移动构造函数、析构函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>  <span class=c1>// 调用拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>a</span><span class=p>));</span>  <span class=c1>// 调用移动构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>a</span><span class=p>.</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>右值引用即只能绑定到右值的引用，字面值（纯右值）和临时变量（亡值）就是常见的右值。如果把左值传递给右值引动参数，则需要强制类型转换，<a href=https://en.cppreference.com/w/cpp/utility/move target=_blank rel="noopener noreferrer">std::move</a> 就是不需要显式指定类型的到右值引用的强制类型转换</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>std</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;&amp;</span> <span class=n>move</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;&amp;&gt;</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;&gt;</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=完美转发perfect-forwarding class=headerLink><a href=#%e5%ae%8c%e7%be%8e%e8%bd%ac%e5%8f%91perfect-forwarding class=header-mark></a>22 完美转发（Perfect Forwarding）</h2><ul><li>右值引用是能接受右值的引用，引用可以取址，是左值，因此右值引用是左值。如果一个函数接受右值引用参数，把参数传递给其他函数时，会按左值传递，这样就丢失了原有的值类别</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=n>s</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>为了转发时保持值类别不丢失，需要手写多个重载版本</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=n>s</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=n>s</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>));</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>s2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板参数中右值引用符号表示的是万能引用（universal reference），因为模板参数本身可以推断为引用，它可以匹配几乎任何类型（少部分特殊类型无法匹配，如位域），传入左值时推断为左值引用类型，传入右值时推断为右值引用类型。对万能引用参数使用 <a href=https://en.cppreference.com/w/cpp/utility/forward target=_blank rel="noopener noreferrer">std::forward</a> 则可以保持值类别不丢失，这种保留值类别的转发手法就叫完美转发，因此万能引用也叫转发引用（forwarding reference）</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>forward</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&amp;&amp;&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>g</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>f</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span><span class=p>));</span>  <span class=c1>// 等价于 std::forward
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>             <span class=c1>// T = T&amp;&amp; = std::string&amp;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>s2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>                   <span class=c1>// T = T&amp;&amp; = const std::string&amp;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>  <span class=c1>// T = std::string, T&amp;&amp; = std::string&amp;&amp;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>        <span class=c1>// T = T&amp;&amp; = std::string&amp;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=s>&#34;downdemo&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>           <span class=c1>// T = T&amp;&amp; = const char (&amp;)[9]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>结合变参模板完美转发转发任意数量的实参</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>void</span> <span class=n>constexpr_for</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)),</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>constexpr_for</span><span class=p>([](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/lambda target=_blank rel="noopener noreferrer">Lambda</a> 中使用完美转发需要借助 decltype 推断类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>constexpr_for</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>auto</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span>
</span></span><span class=line><span class=cl>               <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>   <span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>print</span> <span class=o>=</span> <span class=p>[](</span><span class=k>auto</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>constexpr_for</span><span class=p>([](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>args</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++20 可以为 lambda 指定模板参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=n>constexpr_for</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=p>[]</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)),</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>print</span> <span class=o>=</span> <span class=p>[]</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span> <span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>constexpr_for</span><span class=p>([](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++20 的 lambda 可以捕获参数包</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>[...</span> <span class=n>args</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)]</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>args</span><span class=p>),</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl>  <span class=p>}([](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>x</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>{</span><span class=s>&#34;hello&#34;</span><span class=p>},</span> <span class=s>&#34;world&#34;</span><span class=p>);</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=构造函数模板 class=headerLink><a href=#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0%e6%a8%a1%e6%9d%bf class=header-mark></a>23 构造函数模板</h2><ul><li>模板也能用于构造函数，但它不是真正的构造函数，从函数模板实例化而来的函数不和普通函数等价，由成员函数模板实例化的函数不会重写虚函数，由构造函数模板实例化的构造函数不是拷贝或移动构造函数，但对一个 non-const 对象调用构造函数时，万能引用是更优先的匹配</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=s>&#34;downdemo&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b</span><span class=p>{</span><span class=n>a</span><span class=p>};</span>  <span class=c1>// OK，匹配拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   jc::A c{b};  // 错误，匹配模板构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>为此可以用 <a href=https://en.cppreference.com/w/cpp/types/enable_if target=_blank rel="noopener noreferrer">std::enable_if</a> 约束模板参数，在条件满足的情况下才会匹配模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span>  <span class=c1>// 要求 T 能转为 std::string
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=s>&#34;downdemo&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b</span><span class=p>{</span><span class=n>a</span><span class=p>};</span>  <span class=c1>// OK，匹配拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>c</span><span class=p>{</span><span class=n>b</span><span class=p>};</span>  <span class=c1>// OK，匹配拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++20 可以用 <a href=https://en.cppreference.com/w/cpp/concepts target=_blank rel="noopener noreferrer">concepts</a> 约束模板参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;concepts&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>requires</span> <span class=n>std</span><span class=o>::</span><span class=n>convertible_to</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>:</span> <span class=n>s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>s</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=s>&#34;downdemo&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b</span><span class=p>{</span><span class=n>a</span><span class=p>};</span>  <span class=c1>// OK，匹配拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>c</span><span class=p>{</span><span class=n>b</span><span class=p>};</span>  <span class=c1>// OK，匹配拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=adlargument-dependent-lookupkoenig-lookuphttpsencppreferencecomwcpplanguageadl class=headerLink><a href=#adlargument-dependent-lookupkoenig-lookuphttpsencppreferencecomwcpplanguageadl class=header-mark></a>24 <a href=https://en.cppreference.com/w/cpp/language/adl target=_blank rel="noopener noreferrer">ADL（Argument-Dependent Lookup，Koenig Lookup）</a></h2><ul><li><a href=https://en.cppreference.com/w/cpp/language/lookup target=_blank rel="noopener noreferrer">Name lookup</a> 是当程序中出现一个名称时，将其与引入它的声明联系起来的过程，它分为 <a href=https://en.cppreference.com/w/cpp/language/qualified_lookup target=_blank rel="noopener noreferrer">qualified name lookup</a> 和 <a href=https://en.cppreference.com/w/cpp/language/lookup target=_blank rel="noopener noreferrer">unqualified name lookup</a>，<a href=https://en.cppreference.com/w/cpp/language/lookup target=_blank rel="noopener noreferrer">unqualified name lookup</a> 对于函数名查找会使用 <a href=https://en.cppreference.com/w/cpp/language/adl target=_blank rel="noopener noreferrer">ADL</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f1</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f2</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jd</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f1</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f1</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>  <span class=c1>// 调用 jd::f1()，造成无限递归
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f2</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f2</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>  <span class=c1>// 通过 t 的类型 jc::A 看到 jc，通过 jc 看到 jc::f2()
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=c1>// 因为 jd::f2() 也可见，此处产生二义性调用错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f3</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>B</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f3</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>  <span class=c1>// 通过 t 的类型 jc::B 看到 jc，但 jc 中无 jc::f3()
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=c1>// 此处调用 jd::f3()，造成无限递归
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jd
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/qualified_lookup target=_blank rel="noopener noreferrer">Qualified name lookup</a> 即对使用了作用域运算符的名称做查找，查找在受限的作用域内进行</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>Base</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=n>Derived</span><span class=o>*</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>p</span><span class=o>-&gt;</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>        <span class=c1>// 找到 Base::i
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Derived</span><span class=o>::</span><span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// 错误：在受限作用域中找不到 ::x
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/lookup target=_blank rel="noopener noreferrer">Unqualified name lookup</a> 即对不指定作用域的名称做查找，先查找当前作用域，若找不到再继续查找外围作用域</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=kt>int</span> <span class=n>x</span><span class=p>;</span>  <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>  <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>f</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>       <span class=c1>// 使用 3
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=o>::</span><span class=n>x</span><span class=p>;</span>  <span class=c1>// 分别使用 2、1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/adl target=_blank rel="noopener noreferrer">ADL</a> 即实参依赖查找，对于一个类，其成员函数与使用了它的非成员函数，都是该类的逻辑组成部分，如果函数接受一个类作为参数，编译器查找函数名时，不仅会查找局部作用域，还会查找类所在的命名空间</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{}</span>  <span class=c1>// f() 是 A 的逻辑组成部分
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>  <span class=c1>// 通过 ADL 找到 jc::f()，如果没有 ADL，就要写成 jc::f(a)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>s</span><span class=p>;</span>  <span class=c1>// std::operator&lt;&lt;() 是 std::string 的逻辑组成部分
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 如果没有 ADL，就要写成 std::operator&lt;&lt;(std::cout, s)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ADL 是通过实参查找，对于函数模板，查找前无法先得知其为函数，也就无法确定实参，因此不会使用 ADL</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>*</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>g</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>*</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>  <span class=c1>// 错误，不知道 f&lt;int&gt; 是函数，所以不知道 p 是实参，不会用 ADL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ADL 会忽略 using 声明</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jd</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>  <span class=c1>// 忽略 using 声明，不会调用 jc::f
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>enum</span> <span class=nc>Color</span> <span class=p>{</span> <span class=n>red</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=n>Color</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jd
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>jd</span><span class=o>::</span><span class=n>red</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>  <span class=c1>// 受限的函数名称，不使用 ADL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>jd</span><span class=o>::</span><span class=n>red</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>    <span class=c1>// 使用 ADL 找到 jd::f()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ADL 会查找实参关联的命名空间和类，关联的命名空间和类组成的集合定义如下<ul><li>内置类型：集合为空</li><li>指针和数组类型：所引用类型关联的命名空间和类</li><li>枚举类型：关联枚举声明所在的命名空间</li><li>类成员：关联成员所在的类</li><li>类类型：关联的类包括该类本身、外围类型、直接和间接基类，关联的命名空间为每个关联类所在的命名空间，如果类是一个类模板实例则还包含模板实参本身类型、模板的模板实参所在的类和命名空间</li><li>函数类型：所有参数和返回类型关联的命名空间和类</li><li>类成员指针类型：成员和类关联的命名空间和类</li></ul></li><li>友元声明在外围作用域不可见，因为如果可见的话，实例化类模板会使普通函数的声明可见，如果没有先实例化类就调用函数，将导致编译错误，但如果友元函数所在类属于 ADL 的关联类集合，则在外围作用域可以找到该友元声明，且调用时，未实例化的类会被实例化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>g</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>();</span>   <span class=c1>// f() 无参数，不能使用 ADL，不可见
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>f</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>  <span class=c1>// f(A&lt;int&gt;) 关联类 A&lt;int&gt; 所以可见，若类 A&lt;int&gt; 未实例化则调用时实例化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=注入类名injected-class-namehttpsencppreferencecomwcpplanguageinjected-class-name class=headerLink><a href=#%e6%b3%a8%e5%85%a5%e7%b1%bb%e5%90%8dinjected-class-namehttpsencppreferencecomwcpplanguageinjected-class-name class=header-mark></a>25 <a href=https://en.cppreference.com/w/cpp/language/injected-class-name target=_blank rel="noopener noreferrer">注入类名（Injected Class Name）</a></h2><ul><li>为了便于查找，在类作用域中，类名称是自身类型的 public 别名，该名称称为注入类名</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>*</span> <span class=n>p</span><span class=p>;</span>    <span class=c1>// OK：A 是注入类名
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>::</span><span class=n>A</span><span class=o>*</span> <span class=n>q</span><span class=p>;</span>  <span class=c1>// 错误：查找到变量名 A，隐藏了 struct A 的名称
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类模板的注入类名可以被用作模板名或类型名</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>B</span><span class=o>*</span> <span class=n>a</span><span class=p>;</span>            <span class=c1>// B 被当作类型名，等价于 B&lt;T&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>B</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;*</span> <span class=n>b</span><span class=p>;</span>      <span class=c1>// B 被当作模板名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>c</span> <span class=o>=</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// B 被当作模板名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>A</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&gt;</span> <span class=n>d</span><span class=p>;</span>      <span class=c1>// jc::B 不是注入类名，总会被当作模板名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=非模板中的上下文相关性 class=headerLink><a href=#%e9%9d%9e%e6%a8%a1%e6%9d%bf%e4%b8%ad%e7%9a%84%e4%b8%8a%e4%b8%8b%e6%96%87%e7%9b%b8%e5%85%b3%e6%80%a7 class=header-mark></a>26 非模板中的上下文相关性</h2><ul><li>解析理论主要面向上下文无关语言，而 C++ 是上下文相关语言，为了解决这个问题，编译器使用一张符号表结合扫描器和解析器</li><li>解析某个声明时会把它添加到表中，扫描器找到一个标识符时，会在符号表中查找，如果发现该符号是一个类型就会注释这个标记，如编译器看见 <code>x*</code>，扫描器会查找 x，如果发现 x 是一个类型，解析器会看到标记如下，认为表达式是一个声明</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>identifier, type, x
</span></span><span class=line><span class=cl>symbol, *
</span></span></code></pre></td></tr></table></div></div><ul><li>如果 x 不是类型，则解析器从扫描器获得标记如下，表达式被视为一个乘积</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>identifier</span><span class=p>,</span> <span class=n>nontype</span><span class=p>,</span> <span class=n>x</span>
</span></span><span class=line><span class=cl><span class=n>symbol</span><span class=p>,</span> <span class=o>*</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于 <code>A&lt;1>(0)</code>，如果 A 是类模板，则表达式是把 0 转换成 <code>A&lt;1></code> 类型。如果不是类模板，表达式等价于 <code>(A&lt;1)>0</code>，计算表达式 A 小于 1 的结果，再将结果与 0 比较大小。因此解析器先查找 <code>&lt;</code> 前的名称，如果名称是模板才会把 <code>&lt;</code> 看作左尖括号，其他情况则看作小于号</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>B</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>const</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=n>B</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=p>(</span><span class=mi>1</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>);</span>  <span class=c1>// 必须使用小括号
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dependent-namehttpsencppreferencecomwcpplanguagedependent_name class=headerLink><a href=#dependent-namehttpsencppreferencecomwcpplanguagedependent_name class=header-mark></a>27 <a href=https://en.cppreference.com/w/cpp/language/dependent_name target=_blank rel="noopener noreferrer">Dependent name</a></h2><h3 id=当前实例化current-instantiation和未知特化unknown-specialization class=headerLink><a href=#%e5%bd%93%e5%89%8d%e5%ae%9e%e4%be%8b%e5%8c%96current-instantiation%e5%92%8c%e6%9c%aa%e7%9f%a5%e7%89%b9%e5%8c%96unknown-specialization class=header-mark></a>27.1 当前实例化（current instantiation）和未知特化（unknown specialization）</h3><ul><li>Name lookup 对 dependent name 与 non-dependent name 有不同的查找规则，在模板定义中，依赖于模板参数的名称称为 dependent name，dependent name 包含当前实例化和未知特化。类模板的注入类名属于当前实例化，依赖于模板参数但不是当前实例化的为未知特化（unknown specialization）</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>*</span> <span class=n>a</span><span class=p>;</span>        <span class=c1>// A 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>A</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;*</span> <span class=n>b</span><span class=p>;</span>  <span class=c1>// A&lt;type&gt; 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;*</span> <span class=n>c</span><span class=p>;</span>    <span class=c1>// A&lt;T*&gt; 是未知特化
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>*</span> <span class=n>a</span><span class=p>;</span>        <span class=c1>// A 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;*</span> <span class=n>b</span><span class=p>;</span>  <span class=c1>// A&lt;type&gt; 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>B</span><span class=o>*</span> <span class=n>c</span><span class=p>;</span>        <span class=c1>// B 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>C</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>*</span> <span class=n>a</span><span class=p>;</span>        <span class=c1>// A 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span><span class=o>&lt;</span><span class=n>type</span><span class=o>&gt;*</span> <span class=n>b</span><span class=p>;</span>  <span class=c1>// A&lt;type&gt; 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>B</span><span class=o>*</span> <span class=n>c</span><span class=p>;</span>        <span class=c1>// 不在 B 的作用域内，B 是未知特化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>C</span><span class=o>*</span> <span class=n>d</span><span class=p>;</span>        <span class=c1>// C 是当前实例化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>C</span><span class=p>{}.</span><span class=n>c</span><span class=o>-&gt;</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>C</span><span class=p>{}.</span><span class=n>c</span><span class=o>-&gt;</span><span class=n>i</span><span class=p>;</span>  <span class=c1>// 使用特化的 A&lt;int&gt;::B
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=typename-消歧义符 class=headerLink><a href=#typename-%e6%b6%88%e6%ad%a7%e4%b9%89%e7%ac%a6 class=header-mark></a>27.2 typename 消歧义符</h3><ul><li>模板名称的问题主要是不能有效确定名称，模板中不能引用其他模板的名称，因为其他模板可能有使原名称失效的特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// x 是值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>x</span><span class=o>*</span> <span class=n>y</span><span class=p>;</span>  <span class=c1>// 默认被看作乘法表达式
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>x</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>  <span class=c1>// x 是类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>   <span class=c1>// A&lt;int&gt;::x* y 是声明，int* y
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>  <span class=c1>// A&lt;void&gt;::x* y 是乘法，0 * y
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Dependent name 默认不会被看作类型，如果要表明是类型则需要加上 typename 消歧义符</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// x 是值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>x</span><span class=o>*</span> <span class=n>y</span><span class=p>;</span>  <span class=c1>// 默认被看作声明
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>x</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>  <span class=c1>// x 是类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>   <span class=c1>// A&lt;int&gt;::x* y 是声明，int* y
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>  <span class=c1>// A&lt;void&gt;::x* y 是乘法，0 * y
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>typename 消歧义符只能用于不在基类列表和初始化列表中的 dependent name，用作用域运算符访问 dependent name 中的成员类型时，必须指定 typename 消歧义符</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span> <span class=p>{</span>  <span class=c1>// 基类列表中不能加 typename 消歧义符
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Derived</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span>  <span class=c1>// 初始化列表中不能加 typename 消歧义符
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>(</span><span class=k>typename</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>{</span><span class=mi>0</span><span class=p>})</span>  <span class=c1>// 必须加 typename 消歧义符
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=o>*</span> <span class=n>p</span><span class=p>;</span>  <span class=c1>// 必须加 typename 消歧义符
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>type</span><span class=o>*</span> <span class=n>s</span><span class=p>;</span>  <span class=c1>// non-dependent name，typename 消歧义符可有可无
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>Base</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=template-消歧义符 class=headerLink><a href=#template-%e6%b6%88%e6%ad%a7%e4%b9%89%e7%ac%a6 class=header-mark></a>27.3 template 消歧义符</h3><ul><li>访问模板参数的 dependent name 时，要在 dependent name 前加 template 消歧义符，才能让编译器知道引用的是一个模板，否则 <code>&lt;</code> 会被视为小于号</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>Impl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Y</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>void</span> <span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>test</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>::</span><span class=k>template</span> <span class=n>Impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>f</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>::</span><span class=k>template</span> <span class=n>f</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>test</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=non-dependent-base class=headerLink><a href=#non-dependent-base class=header-mark></a>28 Non-dependent base</h2><ul><li>Non-dependent base 是不用知道模板实参就可以推断类型的基类，派生类中查找 non-dependent name 时会先查找 non-dependent base，再查找模板参数列表</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>T</span> <span class=o>=</span> <span class=kt>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived1</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// non-dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>               <span class=c1>// T 是 Base&lt;void&gt;::T
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived2</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>            <span class=c1>// T 是模板参数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>Derived1</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>Derived2</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=dependent-base class=headerLink><a href=#dependent-base class=header-mark></a>29 Dependent base</h2><ul><li>对于 non-dependent name，不会在 dependent base 中做查找</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span><span class=p>;</span>  <span class=c1>// 错误：不会在 dependent base 中查找 non-dependent name
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果要在 dependent base 中查找，则可以使用 <code>this-></code> 或作用域运算符将 non-dependent name 变为 dependent name</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>value</span><span class=p>;</span>  <span class=c1>// dependent name，会在 dependent base 中查找
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>或者使用 using 声明，这样只需要引入一次</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span><span class=p>;</span>  <span class=c1>// dependent name，会在 dependent base 中查找
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>使用作用域运算符不会访问虚函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果需要使用虚函数，则只能使用 <code>this-></code> 或 using 声明</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived1</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived2</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>  <span class=c1>// dependent base
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>get_value</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>3</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived1</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived1</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived2</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived2</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>get_value</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=隐式实例化 class=headerLink><a href=#%e9%9a%90%e5%bc%8f%e5%ae%9e%e4%be%8b%e5%8c%96 class=header-mark></a>30 隐式实例化</h2><ul><li>编译器遇到模板特化时会用所给的模板实参替换对应的模板参数，从而产生特化。如果声明类模板的指针或引用，不需要看到类模板定义，但如果要访问特化的成员或想知道模板特化的大小，就要先看到定义</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;*</span> <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// OK：不需要类模板定义
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>g</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 只使用类模板声明
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=p>();</span>             <span class=c1>// 使用了类模板定义，需要 A::f() 的定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>函数重载时，如果候选函数的参数是类类型，则该类必须可见。如果重载函数的参数是类模板，为了检查重载匹配，就需要实例化类模板。通过 <a href=https://cppinsights.io/ target=_blank rel="noopener noreferrer">C++ Insights</a> 或在 Visual Studio 中使用 <code>/d1templateStats</code> 命令行参数查看模板的实例化结果</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>  <span class=c1>// 两个函数声明都匹配，调用第二个，但仍会实例化第一个
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=延迟实例化lazy-instantiation class=headerLink><a href=#%e5%bb%b6%e8%bf%9f%e5%ae%9e%e4%be%8b%e5%8c%96lazy-instantiation class=header-mark></a>31 延迟实例化（Lazy Instantiation）</h2><ul><li>隐式实例化类模板时，也会实例化每个成员声明，但不会实例化定义。例外的是匿名 union 和虚函数，union 成员会被实例化，虚函数是否实例化依赖于具体实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=n>N</span><span class=p>];</span>  <span class=c1>// 编译器会假设 N 是正整数，实例化时 N &lt;= 0 则失败
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>  <span class=c1>// 如果 N &lt;= 0，调用时出错
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>//   void error() {  // 即使不被调用也会引发错误
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//     A&lt;-1&gt; a;  // 要求给出 A&lt;-1&gt; 的完整定义，定义 -1 大小的数组出错
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>//   virtual void g();  // 虚函数只有声明没有定义会导致链接错误
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>Nested</span> <span class=p>{</span>  <span class=c1>// N &lt;= 0 时使用该定义出错
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>//   union {    // union 的所有成员声明都会被生成
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//     A&lt;N&gt; a;  // N &lt;= 0 时出错
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   };
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>//   b.f();                     // 调用则出错
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//   jc::B&lt;int, -1&gt;::Nested{};  // 错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=两阶段查找two-phase-lookup class=headerLink><a href=#%e4%b8%a4%e9%98%b6%e6%ae%b5%e6%9f%a5%e6%89%betwo-phase-lookup class=header-mark></a>32 两阶段查找（Two-Phase Lookup）</h2><ul><li>编译器解析模板时，不能解析 <a href=https://en.cppreference.com/w/cpp/language/dependent_name target=_blank rel="noopener noreferrer">dependent name</a>，于是会在 POI（point of instantiation）再次查找 dependent name，而 non-dependent name 在首次看到模板时就会进行查找，因此就有了两阶段查找，第一阶段发生在模板解析阶段，第二阶段在模板实例化阶段<ul><li>第一阶段使用 <a href=https://en.cppreference.com/w/cpp/language/lookup target=_blank rel="noopener noreferrer">unqualified name lookup</a>（对于函数名查找会使用 <a href=https://en.cppreference.com/w/cpp/language/adl target=_blank rel="noopener noreferrer">ADL</a>）查找 non-dependent name 和非受限的 dependent name（如具有 dependent name 实参的函数名称），但后者的查找不完整，在实例化时还会再次查找</li><li>第二阶段发生的地点称为 POI，该阶段查找受限的 dependent name，并对非受限的 dependent name 再次进行 ADL</li></ul></li></ul><h2 id=poipoints-of-instantiation class=headerLink><a href=#poipoints-of-instantiation class=header-mark></a>33 POI（Points of Instantiation）</h2><ul><li>编译器会在模板中的某个位置访问模板实例的声明或定义，实例化相应的模板定义时就会产生 POI，POI 是代码中的一个点，在该点会插入替换后的模板实例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>i</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span> <span class=k>operator</span><span class=o>-</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>A</span><span class=p>{</span><span class=o>-</span><span class=n>a</span><span class=p>.</span><span class=n>i</span><span class=p>};</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=k>operator</span><span class=o>&lt;</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Int</span> <span class=o>=</span> <span class=n>A</span><span class=p>;</span>  <span class=c1>// 若使用 int 而不使用 A 则无法使用 ADL 找到 g
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span><span class=p>(</span><span class=o>-</span><span class=n>i</span><span class=p>);</span>  <span class=c1>// POI 二阶段查找，T 为 A 可以使用 ADL，T 为 int 则找不到 g
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 此处不能为 POI，因为 g() 不可见，无法解析 g(-i)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>g</span><span class=p>(</span><span class=n>Int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 此处不能为 POI，不允许在此处插入 f&lt;Int&gt;(Int) 的定义
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>f</span><span class=o>&lt;</span><span class=n>Int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>  <span class=c1>// 调用点
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 此处不能为 POI，不允许在此处插入 f&lt;Int&gt;(Int) 的定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 是 POI，此时 g() 可见，实例化 f&lt;Int&gt;(Int)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类模板实例的 POI 位置只能定义在包含该实例的声明或定义前的最近作用域</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// POI
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 不能是 POI，A&lt;int&gt; 的定义不能出现在函数作用域内
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 不能是 POI，A&lt;int&gt; 的定义不能出现在函数作用域内
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 不能是 POI，如果是 POI 则 sizeof(A&lt;int&gt;) 无效，因为编译后才知道大小
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实例化一个模板时，可能附带实例化其他模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// A&lt;char&gt; 的 POI
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// A&lt;double&gt; 的 POI
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// f&lt;double&gt; 的 POI
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// f 使用了 dependent name A&lt;T&gt;，需要一个二次 POI
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 此处有两个 POI，对于类实例，二次 POI 位于主 POI 之前（函数实例则位置相同）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>一个编译单元通常会包含一个实例的多个 POI，对类模板实例，每个编译单元只保留首个 POI，忽略其他 POI（它们不会被真正认为是 POI），对函数模板和变量模板的实例，所有 POI 都会被保留</li></ul><h2 id=模板的链接linkage-of-template class=headerLink><a href=#%e6%a8%a1%e6%9d%bf%e7%9a%84%e9%93%be%e6%8e%a5linkage-of-template class=header-mark></a>34 模板的链接（Linkage of Template）</h2><ul><li>类模板不能和其他实例共用一个名称</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>;</span>  <span class=c1>// OK：两者名称在不同的空间
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span><span class=p>;</span>  <span class=c1>// 错误：名称冲突
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span><span class=p>;</span>  <span class=c1>// 错误：名称冲突
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板不能有 C linkage</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C++&#34;</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>normal</span><span class=p>();</span>  <span class=c1>// 默认方式，链接规范可以省略不写
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>invalid</span><span class=p>();</span>  <span class=c1>// 错误：不能使用 C 链接
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;Java&#34;</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>java_link</span><span class=p>();</span>  <span class=c1>// 非标准链接，某些编译器可能支持
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板通常具有外链接（external linkage），唯一例外的是 static 修饰的函数模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>  <span class=c1>// 与其他文件中同名的声明指向相同的实例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=n>external</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>  <span class=c1>// 与其他文件中同名的模板无关
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=kt>void</span> <span class=n>internal</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>  <span class=c1>// 重复声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=kt>void</span> <span class=n>internal</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>  <span class=c1>// 与其他文件中同名的模板无关
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=n>other_internal</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>  <span class=c1>// 重复声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=n>other_internal</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{}</span>  <span class=c1>// 无链接：不能被重复声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=链接错误 class=headerLink><a href=#%e9%93%be%e6%8e%a5%e9%94%99%e8%af%af class=header-mark></a>35 链接错误</h2><ul><li>和普通的函数不同，如果将模板的声明和实现分离，将出现链接错误，原因是编译器在函数调用处未看到实例化的函数定义，只是假设在别处提供了定义，并产生一个指向该定义的引用，并让链接器利用该引用解决此问题</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// a.hpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// a.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// main.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>  <span class=c1>// 链接错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>推荐的做法是直接在头文件中实现模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// a.hpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// main.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=显式实例化explicit-instantiationhttpsencppreferencecomwcpplanguageclass_templateexplicit_instantiation class=headerLink><a href=#%e6%98%be%e5%bc%8f%e5%ae%9e%e4%be%8b%e5%8c%96explicit-instantiationhttpsencppreferencecomwcpplanguageclass_templateexplicit_instantiation class=header-mark></a>36 <a href=https://en.cppreference.com/w/cpp/language/class_template#Explicit_instantiation target=_blank rel="noopener noreferrer">显式实例化（Explicit Instantiation）</a></h2><ul><li>如果希望在头文件中不暴露模板实现，则可以使用显式实例化，显式实例化相当于为模板手动实例化指定的类型，但用户仅能使用已指定类型的模板，可以在头文件中使用 extern 声明显式实例化，告知用户支持的实例化类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// a.hpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=k>template</span> <span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>         <span class=c1>// 声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>extern</span> <span class=k>template</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span>  <span class=c1>// 声明
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// a.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// 实例化 A&lt;int&gt;，同时会实例化其所有成员
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span>  <span class=c1>// 仅实例化该成员
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// main.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>可以把显式实例化可提取到一个单独的文件中，注意这个文件要包含定义模板的文件</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// a.hpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=k>template</span> <span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>extern</span> <span class=k>template</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// a.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// a_init.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.cpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=k>class</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// main.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;a.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>显式实例化不会影响类型推断规则，它只是实例化了一个实例，并不是一个可以优先匹配的非模板函数。从函数模板实例化而来的函数永远不和普通函数等价</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=kt>void</span> <span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>);</span>  <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>);</span>  <span class=c1>// 错误：推断类型不一致，不存在普通函数 f(double, double)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>显式实例化的本质是创建一个特化的实例，因此显式实例化之后，不能定义同类型的特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template&lt;&gt; struct A&lt;int&gt; { void f() {} };
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// 相当于创建如上实例
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// struct A&lt;int&gt; {};  // 不允许重定义
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=deduced-context class=headerLink><a href=#deduced-context class=header-mark></a>37 Deduced Context</h2><ul><li>复杂的类型声明的匹配过程从最顶层构造开始，然后不断递归子构造，即各种组成元素，这些构造被称为 deduced context，non-deduced context 不会参与推断，而是使用其他处推断的结果，受限类型名称如 <code>A&lt;T>::type</code> 不能用来推断 T，非类型表达式如 <code>A&lt;N + 1></code> 不能用来推断 N</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>T</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>  <span class=c1>// A&lt;N&gt;::T 是 non-deduced context，X&lt;N&gt;::*p 是 deduced context
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=kt>void</span> <span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;::*</span><span class=n>p</span><span class=p>)(</span><span class=k>typename</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;::</span><span class=n>T</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>);</span>  <span class=c1>// 由 A&lt;N&gt;::*p 推断 N 为 0，A&lt;N&gt;::T 则使用 N 变为 A&lt;0&gt;::T
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>默认实参不能用于推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>42</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>();</span>  <span class=c1>// T = int
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>();</span>       <span class=c1>// 错误：无法推断 T
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=特殊的推断情况 class=headerLink><a href=#%e7%89%b9%e6%ae%8a%e7%9a%84%e6%8e%a8%e6%96%ad%e6%83%85%e5%86%b5 class=header-mark></a>38 特殊的推断情况</h2><ul><li>成员函数的推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>RT</span> <span class=p>(</span><span class=n>T</span><span class=o>::*</span><span class=p>)(</span><span class=n>Args</span><span class=p>...)</span> <span class=k>const</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=o>&amp;</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>::</span><span class=n>f</span><span class=p>);</span>  <span class=c1>// RT = void，T = A，Args = int*
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>取函数模板地址和调用转型运算符模板的推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>T</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>g</span><span class=p>(</span><span class=kt>int</span> <span class=p>(</span><span class=o>&amp;</span><span class=p>)[</span><span class=mi>3</span><span class=p>])</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>pf</span><span class=p>)(</span><span class=kt>int</span><span class=p>)</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>;</span>  <span class=c1>// 推断为 f&lt;int&gt;(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>g</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>  <span class=c1>// a 要转为 int(&amp;)[3]，T 推断为 int[3]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>初始化列表作为实参没有具体类型，不能直接推断为初始化列表</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;initializer_list&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>initializer_list</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// jc::f({1, 2, 3});  // 错误：不能推断出 T 为 initializer_list
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>g</span><span class=p>({</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>});</span>  <span class=c1>// OK：T 为 int
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>参数包的推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Args</span><span class=o>&gt;&amp;</span><span class=p>...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>g</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>U</span><span class=o>&gt;&amp;</span><span class=p>...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=k>namespace</span> <span class=n>jc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>{},</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>{});</span>   <span class=c1>// T = int, Args = [bool,char]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>g</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>{},</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>{});</span>   <span class=c1>// T = [int, int], U = [bool, char]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>g</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>{},</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>{});</span>  <span class=c1>// T = [int, char], U = [bool, char]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// f(A&lt;int, bool&gt;{}, A&lt;char, char&gt;{});  // 错误，T 分别推断为 int 和 char
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>完美转发处理空指针常量时，整型值会被当作常量值 0</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(...)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>g</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>g</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>g</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>g</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=sfinaesubstitution-failure-is-not-an-errorhttpsencppreferencecomwcpplanguagesfinae class=headerLink><a href=#sfinaesubstitution-failure-is-not-an-errorhttpsencppreferencecomwcpplanguagesfinae class=header-mark></a>39 <a href=https://en.cppreference.com/w/cpp/language/sfinae target=_blank rel="noopener noreferrer">SFINAE（Substitution Failure Is Not An Error）</a></h2><ul><li>SFINAE 用于禁止不相关函数模板在重载解析时造成错误，当替换返回类型无意义时，会忽略（SFINAE out）匹配而选择另一个更差的匹配</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span><span class=o>*</span> <span class=n>begin</span><span class=p>(</span><span class=n>T</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>)[</span><span class=n>N</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Container</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>typename</span> <span class=n>Container</span><span class=o>::</span><span class=n>iterator</span> <span class=n>begin</span><span class=p>(</span><span class=n>Container</span><span class=o>&amp;</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>c</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>  <span class=c1>// OK：只匹配第二个，SFINAE out 第一个
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>  <span class=c1>// OK：只匹配第一个，SFINAE out 第二个
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>SFINAE 只发生于函数模板替换的即时上下文中，对于模板定义中不合法的表达式，不会使用 SFINAE 机制</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>,</span> <span class=n>U</span> <span class=n>u</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=k>decltype</span><span class=p>(</span><span class=n>t</span> <span class=o>+</span> <span class=n>u</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>t</span> <span class=o>+</span> <span class=n>u</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>(...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>g</span><span class=p>(</span><span class=n>T</span> <span class=n>t</span><span class=p>,</span> <span class=n>U</span> <span class=n>u</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=k>decltype</span><span class=p>(</span><span class=k>auto</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 必须实例化 t 和 u 来确定返回类型
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>t</span> <span class=o>+</span> <span class=n>u</span><span class=p>;</span>  <span class=c1>// 不是即时上下文，不会使用 SFINAE
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>g</span><span class=p>(...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>X</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>A</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>X</span><span class=p>{},</span> <span class=n>X</span><span class=p>{}));</span>  <span class=c1>// OK：A 为 void
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>using</span> <span class=n>B</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>g</span><span class=p>(</span><span class=n>X</span><span class=p>{},</span> <span class=n>X</span><span class=p>{}));</span>  <span class=c1>// 错误：g&lt;X, X&gt; 的实例化非法
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>一个简单的 SFINAE 技巧是使用尾置返回类型，用 devltype 和逗号运算符定义返回类型，在 decltype 中定义必须有效的表达式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>size</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span> <span class=n>T</span><span class=o>::</span><span class=n>size_type</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>t</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>size</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>如果替换时使用了类成员，则会实例化类模板，此期间发生的错误不在即时上下文中，即使另一个函数模板匹配无误也不会使用 SFINAE</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>iterator</span> <span class=o>=</span> <span class=n>T</span><span class=o>*</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>typename</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>iterator</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&amp;&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>  <span class=c1>// 错误：第一个模板实例化 Array&lt;int&amp;&gt;，创建引用的指针是非法的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>SFINAE 最出名的应用是 <a href=https://en.cppreference.com/w/cpp/types/enable_if target=_blank rel="noopener noreferrer">std::enable_if</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>append</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>R</span><span class=s>&#34;(&#34;</span><span class=p>)</span><span class=s>&#34; &lt;&lt; k &lt;&lt; R&#34;</span><span class=p>(</span><span class=s>&#34;:)&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>boolalpha</span> <span class=o>&lt;&lt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;!</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                               <span class=n>std</span><span class=o>::</span><span class=n>is_arithmetic_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>append</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>R</span><span class=s>&#34;(&#34;</span><span class=p>)</span><span class=s>&#34; &lt;&lt; k &lt;&lt; R&#34;</span><span class=p>(</span><span class=s>&#34;:)&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>K</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_constructible_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                     <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>append</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>K</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>R</span><span class=s>&#34;(&#34;</span><span class=p>)</span><span class=s>&#34; &lt;&lt; k &lt;&lt; R&#34;</span><span class=p>(</span><span class=s>&#34;:&#34;</span><span class=p>)</span><span class=s>&#34; &lt;&lt; v &lt;&lt; R&#34;</span><span class=p>(</span><span class=s>&#34;)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>kv_string_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;&gt;</span><span class=p>())</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>kv_string_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>k</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>append</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;,&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>kv_string_impl</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>args</span><span class=p>...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>kv_string</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>field</span><span class=p>,</span> <span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>field</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;:{&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>kv_string_impl</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>args</span><span class=p>...);</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>a</span><span class=p>{</span><span class=n>R</span><span class=s>&#34;(data:{})&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>b</span><span class=p>{</span><span class=n>R</span><span class=s>&#34;(data:{&#34;</span><span class=n>name</span><span class=s>&#34;:&#34;</span><span class=n>jc</span><span class=s>&#34;,&#34;</span><span class=n>ID</span><span class=s>&#34;:1})&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>c</span><span class=p>{</span><span class=n>R</span><span class=s>&#34;(data:{&#34;</span><span class=n>name</span><span class=s>&#34;:&#34;</span><span class=n>jc</span><span class=s>&#34;,&#34;</span><span class=n>ID</span><span class=s>&#34;:1,&#34;</span><span class=n>active</span><span class=s>&#34;:true})&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>kv_string</span><span class=p>(</span><span class=s>&#34;data&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>b</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>kv_string</span><span class=p>(</span><span class=s>&#34;data&#34;</span><span class=p>,</span> <span class=s>&#34;name&#34;</span><span class=p>,</span> <span class=s>&#34;jc&#34;</span><span class=p>,</span> <span class=s>&#34;ID&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>kv_string</span><span class=p>(</span><span class=s>&#34;data&#34;</span><span class=p>,</span> <span class=s>&#34;name&#34;</span><span class=p>,</span> <span class=s>&#34;jc&#34;</span><span class=p>,</span> <span class=s>&#34;ID&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s>&#34;active&#34;</span><span class=p>,</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=deduction-guides class=headerLink><a href=#deduction-guides class=header-mark></a>40 Deduction Guides</h2><ul><li>字符串字面值传引用时推断为字符数组</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>val</span><span class=p>)</span> <span class=o>:</span> <span class=n>container_</span><span class=p>({</span><span class=n>val</span><span class=p>})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>container_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=s>&#34;downdemo&#34;</span><span class=p>;</span>  <span class=c1>// 错误：T 为 char[9]，构造 std::vector&lt;char[9]&gt; 出错
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>改为传值，字符串字面值会推断为 <code>const char*</code></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span> <span class=n>val</span><span class=p>)</span> <span class=o>:</span> <span class=n>container_</span><span class=p>({</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>val</span><span class=p>)})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>container_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=s>&#34;downdemo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=k>const</span> <span class=kt>char</span><span class=o>*&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++17 可以定义 deduction guides 对特定类型的实参指定其推断类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>val</span><span class=p>)</span> <span class=o>:</span> <span class=n>container_</span><span class=p>({</span><span class=n>val</span><span class=p>})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>container_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>A</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=s>&#34;downdemo&#34;</span><span class=p>};</span>  <span class=c1>// 等号初始化会出错，const char[9] 不能转为 std::string
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>为聚合类模板定义 deduction guides</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>A</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;down&#34;</span><span class=p>,</span> <span class=s>&#34;demo&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>x</span> <span class=o>==</span> <span class=s>&#34;down&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>x</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>使用花括号赋值可以解决没有初始化列表的问题，圆括号则不行</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a1</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>     <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a2</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>  <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a3</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>   <span class=c1>// 错误：没有初始化列表，int 不能转为 jc::A&lt;int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a4</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// 错误：没有初始化列表，int 不能转为 jc::A&lt;int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>explicit 声明的 deduction guides 只用于直接初始化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&amp;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>explicit</span> <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// 只能用于直接初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>  <span class=c1>// A&lt;int, int&amp;&gt; a = 1;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b</span><span class=p>{</span><span class=mi>2</span><span class=p>};</span>   <span class=c1>// A&lt;int, int&gt; b{2};
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/container/array target=_blank rel="noopener noreferrer">std::array</a> 是一个聚合类模板，<a href=https://en.cppreference.com/w/cpp/container/array/deduction_guides target=_blank rel="noopener noreferrer">C++17 为其定义了一个 deduction guides</a> 来推断模板参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;typename T, typename... U&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// array(T, U...)
</span></span></span><span class=line><span class=cl><span class=c1>//     -&gt; array&lt;
</span></span></span><span class=line><span class=cl><span class=c1>//   enable_if_t&lt;(is_same_v&lt;T, U&gt; &amp;&amp; ...), T&gt;,
</span></span></span><span class=line><span class=cl><span class=c1>//   1 + sizeof...(U)
</span></span></span><span class=line><span class=cl><span class=c1>//  &gt;;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span> <span class=n>a</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++17 允许<a href=https://en.cppreference.com/w/cpp/language/class_template_argument_deduction target=_blank rel="noopener noreferrer">类模板实参推断</a>，但类模板的所有参数要么通过显式指定指出，要么通过实参推断推出，不能一部分使用显式指定一部分使用推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Y</span> <span class=o>=</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span> <span class=o>=</span> <span class=n>T</span><span class=p>{},</span> <span class=n>U</span> <span class=n>y</span> <span class=o>=</span> <span class=n>U</span><span class=p>{},</span> <span class=n>Y</span> <span class=n>z</span> <span class=o>=</span> <span class=n>Y</span><span class=p>{})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=s>&#34;hello&#34;</span><span class=p>};</span>  <span class=c1>// T = int，U = double，T3 = const char*
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>};</span>           <span class=c1>// T = int，U = Y = double
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>{</span><span class=s>&#34;hi&#34;</span><span class=p>,</span> <span class=s>&#34;downdemo&#34;</span><span class=p>};</span>  <span class=c1>// T = U = Y = const char*
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>{</span><span class=s>&#34;hi&#34;</span><span class=p>,</span> <span class=s>&#34;downdemo&#34;</span><span class=p>,</span> <span class=mi>42</span><span class=p>};</span>  <span class=c1>// 错误：只指定了 T，U 未推断
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;&gt;</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=mi>42</span><span class=p>};</span>                      <span class=c1>// 错误：T 和 U 都未指定
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类模板实参推断的本质是为每个构造函数和构造函数模板隐式添加一个 deduction guides</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>val</span><span class=p>)</span> <span class=o>:</span> <span class=n>container_</span><span class=p>({</span><span class=n>val</span><span class=p>})</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>container_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;typename T&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// A(const T&amp;) -&gt; A&lt;T&gt;;  // 隐式 deduction guides
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a1</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a2</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a3</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>a4</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a1</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a2</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a3</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a4</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=deduction-guides-的问题 class=headerLink><a href=#deduction-guides-%e7%9a%84%e9%97%ae%e9%a2%98 class=header-mark></a>41 Deduction Guides 的问题</h2><ul><li>用类模板实例作为实参时，Deduction guides 对实参推断的类型有歧义，标准委员会对于该情况有争议地规定，推断时不会将实参推断为类模板的实例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a1</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a2</span><span class=p>{</span><span class=n>a1</span><span class=p>};</span>  <span class=c1>// A&lt;int&gt; 还是 A&lt;A&lt;int&gt;&gt;？标准委员会规定为 A&lt;int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a3</span><span class=p>(</span><span class=n>a1</span><span class=p>);</span>  <span class=c1>// A&lt;int&gt; 还是 A&lt;A&lt;int&gt;&gt;？标准委员会规定为 A&lt;int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a1</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a2</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a3</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>这个争议造成的问题如下</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>x</span><span class=p>,</span> <span class=k>const</span> <span class=n>Args</span><span class=o>&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 如果 T 为 std::vector
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=p>{</span><span class=n>x</span><span class=p>,</span> <span class=n>args</span><span class=p>...};</span>  <span class=c1>// 参数包是否为空将决定不同的返回类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>vector</span> <span class=n>v1</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>vector</span> <span class=n>v2</span><span class=p>{</span><span class=n>v1</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>vector</span> <span class=n>v3</span><span class=p>{</span><span class=n>v1</span><span class=p>,</span> <span class=n>v1</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>v1</span><span class=p>),</span> <span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>v2</span><span class=p>),</span> <span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>v3</span><span class=p>),</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>v1</span><span class=p>)),</span> <span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v1</span><span class=p>)),</span> <span class=n>vector</span><span class=o>&lt;</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>添加隐式 deduction guides 是有争议的，主要反对观点是这个特性自动将接口添加到已存在的库中，并且对于有限定名称的情况，deduction guides 会失效</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>type_identity</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>ArgType</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>type_identity</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>ArgType</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=p>(</span><span class=k>typename</span> <span class=n>type_identity</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 该 deduction guides 无效，因为有限定名称符 type_identity&lt;T&gt;::
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>  <span class=c1>// 错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>为了保持向后兼容性，如果模板名称是<a href=https://en.cppreference.com/w/cpp/language/injected-class-name target=_blank rel="noopener noreferrer">注入类名</a>，则禁用类模板实参推断</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>U</span> <span class=n>x</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>f</span><span class=p>(</span><span class=n>U</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>A</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>  <span class=c1>// 根据注入类名规则 A 是 A&lt;T&gt;，根据类模板实参推断 A 是 A&lt;U&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>res</span> <span class=o>=</span> <span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>res</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>使用转发引用的 deduction guides 可能推断出引用类型，导致实例化错误或产生空悬引用，因此标准委员会决定使用隐式 deduction guides 的推断时，禁用 T&& 这个特殊的推断规则</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;typename T&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// A(const T&amp;) -&gt; A&lt;T&gt;;  // 隐式生成
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;typename T&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// A(T&amp;&amp;) -&gt; A&lt;T&gt;;  // 不会隐式生成该 deduction guides
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>  <span class=c1>// T 推断为 std::string
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 若指定 T&amp;&amp; 的 deduction guides，则 T 推断为 std::string&amp;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Deduction guides 只用于推断而非调用，实参的传递方式不必完全对应构造函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>B</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>B</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>B</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>B</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>  <span class=c1>// 不需要完全对应构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=p>{</span><span class=n>a</span><span class=p>};</span>             <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span><span class=p>{</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>a</span><span class=p>)};</span>  <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=函数模板重载httpsencppreferencecomwcpplanguagefunction_templatefunction_template_overloading class=headerLink><a href=#%e5%87%bd%e6%95%b0%e6%a8%a1%e6%9d%bf%e9%87%8d%e8%bd%bdhttpsencppreferencecomwcpplanguagefunction_templatefunction_template_overloading class=header-mark></a>42 <a href=https://en.cppreference.com/w/cpp/language/function_template#Function_template_overloading target=_blank rel="noopener noreferrer">函数模板重载</a></h2><ul><li>对于实参推断能匹配多个模板的情况，标准规定了偏序（partial ordering）规则，最终将调用最特殊（能接受更少类型）的模板</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>  <span class=c1>// 两个模板均匹配，第二个模板更特殊
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>  <span class=c1>// 0 推断为 int，匹配第一个模板
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>  <span class=c1>// nullptr 推断为 std::nullptr_t，匹配第一个模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于两个模板，用实参替代第一个模板的参数，替代后的结果作为实参去推断第二个模板，如果推断成功，反过来用第二个模板推断第一个模板，若推断失败，则第一个模板更特殊，如果均推断失败或推断成功，则两个模板没有偏序关系</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>int</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 推断结果：
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 1: f(T)        [T = const int*]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 2: f(T*)       [T = const int]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 3: f(const T*) [T = int]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 偏序处理：
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 2 推断 1，T = U*，推断成功
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 1 推断 2，T* = U，无法推断 T
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 2 比 1 特殊
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 3 推断 1，T = const U*，推断成功
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 1 推断 3，const T* = U，无法推断 T
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 3 比 1 特殊
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 3 推断 2，T = const U，推断成功
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 用 2 推断 3，const T = U，无法推断 T
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 3 比 2 特殊
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 3 最特殊，因此调用 3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>函数模板可以和非模板函数重载</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a2</span><span class=p>{</span><span class=n>a1</span><span class=p>};</span>  <span class=c1>// 3，对 non-const 对象，成员模板优于拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a3</span><span class=p>{</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>a1</span><span class=p>)};</span>  <span class=c1>// 2，移动构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>const</span> <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b2</span><span class=p>{</span><span class=n>b1</span><span class=p>};</span>             <span class=c1>// 1，拷贝构造函数
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>b3</span><span class=p>{</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>b1</span><span class=p>)};</span>  <span class=c1>// 3，const A&amp;&amp;，更匹配成员模板
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>变参模板的重载</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Ts</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Ts</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>Ts</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Ts</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=n>Ts</span><span class=o>*</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>double</span><span class=o>*&gt;</span><span class=p>{})</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=特化specializationhttpsencppreferencecomwcpplanguagetemplate_specialization-1 class=headerLink><a href=#%e7%89%b9%e5%8c%96specializationhttpsencppreferencecomwcpplanguagetemplate_specialization-1 class=header-mark></a>43 <a href=https://en.cppreference.com/w/cpp/language/template_specialization target=_blank rel="noopener noreferrer">特化（Specialization）</a></h2><ul><li>函数模板特化引入了重载和实参推断，如果能推断特化版本，就可以不显式声明模板实参</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 1
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// OK：1 的特化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// OK：2 的特化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>f</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>函数模板的特化不能有默认实参，但会使用要被特化的模板的默认实参</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// T 不会由默认实参推断
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>f</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// 不能指定默认实参
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类模板特化的实参列表必须对应模板参数，如果有默认实参可以不指定对应参数。可以特化整个类模板，也可以特化部分成员。如果对某种类型特化类模板成员，就不能再特化整个类模板，其他未特化的成员会被保留</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span> <span class=o>=</span> <span class=kt>int</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>f</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// struct A&lt;char, char&gt; {};  // 错误，不能对已经特化过成员的类型做特化
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// jc::A&lt;void, double&gt;{};  // 错误：未定义类型
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>i</span> <span class=o>==</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;::</span><span class=n>B</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>{}.</span><span class=n>j</span> <span class=o>==</span> <span class=mi>3</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>类模板特化必须在实例化之前，对已实例化的类型不能再进行特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=p>{};</span>  <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=p>{};</span>  <span class=c1>// 错误：不能特化已实例化的 A&lt;int&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=偏特化partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization-1 class=headerLink><a href=#%e5%81%8f%e7%89%b9%e5%8c%96partial-specializationhttpsencppreferencecomwcpplanguagepartial_specialization-1 class=header-mark></a>44 <a href=https://en.cppreference.com/w/cpp/language/partial_specialization target=_blank rel="noopener noreferrer">偏特化（Partial Specialization）</a></h2><ul><li>类模板偏特化限定一些类型，而非某个具体类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=p>;</span>  <span class=c1>// primary template
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>size</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[</span><span class=n>N</span><span class=p>]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>size</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>int</span> <span class=o>*</span> <span class=n>Class</span><span class=o>::*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>T</span> <span class=o>*</span> <span class=n>Class</span><span class=o>::*&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=kt>void</span> <span class=p>(</span><span class=n>Class</span><span class=o>::*</span><span class=p>)()</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Class</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>RT</span> <span class=p>(</span><span class=n>Class</span><span class=o>::*</span><span class=p>)()</span> <span class=k>const</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Class</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>RT</span> <span class=p>(</span><span class=n>Class</span><span class=o>::*</span><span class=p>)(</span><span class=n>Args</span><span class=p>...)</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>RT</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Class</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span><span class=o>&lt;</span><span class=n>RT</span> <span class=p>(</span><span class=n>Class</span><span class=o>::*</span><span class=p>)(</span><span class=n>Args</span><span class=p>...)</span> <span class=k>const</span> <span class=k>noexcept</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span><span class=o>*</span> <span class=n>i</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span><span class=o>*</span> <span class=n>j</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f1</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f2</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f3</span><span class=p>(</span><span class=kt>int</span><span class=o>&amp;</span><span class=p>,</span> <span class=kt>double</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f4</span><span class=p>(</span><span class=kt>int</span><span class=o>&amp;</span><span class=p>,</span> <span class=kt>double</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>i</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>j</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>f1</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>f2</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>f3</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>B</span><span class=o>::</span><span class=n>f4</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>i</span> <span class=o>==</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>A</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=o>&gt;::</span><span class=n>size</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// jc::A&lt;const int[3]&gt;{};  // 错误：匹配多个版本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/language/variable_template target=_blank rel="noopener noreferrer">变量模板（variable template）</a>的特化和偏特化</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;list&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&amp;&gt;</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>double</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&amp;&gt;</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 变量模板特化的类型可以不匹配 primary template
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>iterator</span> <span class=n>null_iterator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>null_iterator</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span><span class=o>*</span> <span class=n>null_iterator</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[</span><span class=n>N</span><span class=p>]</span><span class=o>&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>it1</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>null_iterator</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>it2</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>null_iterator</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>it3</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>null_iterator</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>it1</span><span class=p>),</span> <span class=kt>int</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>it1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>it2</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>iterator</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>it3</span><span class=p>),</span> <span class=kt>double</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>it3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=traits-的偏特化实现 class=headerLink><a href=#traits-%e7%9a%84%e5%81%8f%e7%89%b9%e5%8c%96%e5%ae%9e%e7%8e%b0 class=header-mark></a>45 Traits 的偏特化实现</h2><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_same target=_blank rel="noopener noreferrer">std::is_same</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_same</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_same</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_same_v</span> <span class=o>=</span> <span class=n>is_same</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>U</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>获取元素类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>get_element</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>get_element</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_element</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>get_element</span><span class=o>&lt;</span><span class=n>T</span><span class=p>[</span><span class=n>N</span><span class=p>]</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_element</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>get_element_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_element</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>get_element_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>get_element_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>[]</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>get_element_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>[</span><span class=mi>3</span><span class=p>][</span><span class=mi>4</span><span class=p>][</span><span class=mi>5</span><span class=p>]</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/remove_reference target=_blank rel="noopener noreferrer">std::remove_reference</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>remove_reference</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>remove_reference</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&amp;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>remove_reference</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&amp;&amp;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>remove_reference_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>remove_reference</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&amp;&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&amp;&amp;&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/enable_if target=_blank rel="noopener noreferrer">std::enable_if</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;list&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>enable_if</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>enable_if</span><span class=o>&lt;</span><span class=nb>true</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>B</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>enable_if_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>enable_if</span><span class=o>&lt;</span><span class=n>B</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Base</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived1</span> <span class=o>:</span> <span class=n>Base</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Derived2</span> <span class=o>:</span> <span class=n>Base</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>impl</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_constructible_v</span><span class=o>&lt;</span><span class=n>Base</span><span class=o>*</span><span class=p>,</span> <span class=n>T</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>V</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>jc</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_constructible_v</span><span class=o>&lt;</span><span class=n>Base</span><span class=o>*</span><span class=p>,</span> <span class=n>T</span><span class=o>*&gt;</span><span class=p>,</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>Args</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>impl</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>args</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span> <span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Derived1</span><span class=o>&gt;</span><span class=p>{},</span> <span class=n>std</span><span class=o>::</span><span class=n>list</span><span class=o>&lt;</span><span class=n>Derived2</span><span class=o>&gt;</span><span class=p>{});</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=元函数转发metafunction-forwarding class=headerLink><a href=#%e5%85%83%e5%87%bd%e6%95%b0%e8%bd%ac%e5%8f%91metafunction-forwarding class=header-mark></a>46 元函数转发（Metafunction Forwarding）</h2><ul><li>Traits 可以视为对类型做操作的函数，称为元函数，元函数一般包含一些相同的成员，将相同成员封装成一个基类作为基本元函数，继承这个基类即可使用成员，这种实现方式称为元函数转发，标准库中实现了 <a href=https://en.cppreference.com/w/cpp/types/integral_constant target=_blank rel="noopener noreferrer">std::integral_constant</a> 作为基本元函数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>v</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>integral_constant</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>T</span> <span class=n>value</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>value_type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>v</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=k>operator</span> <span class=nf>value_type</span><span class=p>()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>value_type</span> <span class=nf>operator</span><span class=p>()()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>to_int</span><span class=p>(</span><span class=kt>char</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// hexadecimal letters:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;A&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;F&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;A&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;a&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;f&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;0&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;9&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>parse_int</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>arr</span><span class=p>)[</span><span class=n>N</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>base</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>   <span class=c1>// to handle base (default: decimal)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>offset</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// to skip prefixes like 0x
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=n>N</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=n>arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;0&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;x&#39;</span><span class=o>:</span>  <span class=c1>// prefix 0x or 0X, so hexadecimal
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>case</span> <span class=sc>&#39;X&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;b&#39;</span><span class=o>:</span>  <span class=c1>// prefix 0b or 0B (since C++14), so binary
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>case</span> <span class=sc>&#39;B&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>base</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>  <span class=c1>// prefix 0, so octal
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>base</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>multiplier</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span> <span class=o>-</span> <span class=n>offset</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>N</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;\&#39;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>res</span> <span class=o>+=</span> <span class=n>to_int</span><span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>N</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>i</span><span class=p>])</span> <span class=o>*</span> <span class=n>multiplier</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>multiplier</span> <span class=o>*=</span> <span class=n>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>char</span><span class=p>...</span> <span class=n>cs</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=k>operator</span><span class=s>&#34;&#34;</span> <span class=n>_c</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>parse_int</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>cs</span><span class=p>)</span><span class=o>&gt;</span><span class=p>({</span><span class=n>cs</span><span class=p>...})</span><span class=o>&gt;</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=mi>2</span><span class=n>_c</span><span class=p>),</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=mh>0xFF</span><span class=n>_c</span><span class=p>),</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>255</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=mb>0b1111&#39;1111</span><span class=n>_c</span><span class=p>),</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>255</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>42</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;::</span><span class=n>value_type</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>42</span><span class=o>&gt;</span><span class=p>{}</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>42</span><span class=o>&gt;</span> <span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>利用元函数转发实现 <a href=https://en.cppreference.com/w/cpp/types/is_same target=_blank rel="noopener noreferrer">std::is_same</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>v</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>integral_constant</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>T</span> <span class=n>value</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>value_type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>v</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=k>operator</span> <span class=nf>value_type</span><span class=p>()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>value_type</span> <span class=nf>operator</span><span class=p>()()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>bool</span> <span class=n>B</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>bool_constant</span> <span class=o>=</span> <span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=n>B</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>true_type</span> <span class=o>=</span> <span class=n>bool_constant</span><span class=o>&lt;</span><span class=nb>true</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>false_type</span> <span class=o>=</span> <span class=n>bool_constant</span><span class=o>&lt;</span><span class=nb>false</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_same</span> <span class=o>:</span> <span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_same</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_same_v</span> <span class=o>=</span> <span class=n>is_same</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>U</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=sfinae-based-traits class=headerLink><a href=#sfinae-based-traits class=header-mark></a>47 SFINAE-based traits</h2><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_default_constructible target=_blank rel="noopener noreferrer">std::is_default_constructible</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_default_constructible</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>U</span><span class=p>())</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=n>test</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=n>test</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>test</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>nullptr</span><span class=p>))</span><span class=o>::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_default_constructible_v</span> <span class=o>=</span> <span class=n>is_default_constructible</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_default_constructible_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/void_t target=_blank rel="noopener noreferrer">std::void_t</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>void_t</span> <span class=o>=</span> <span class=kt>void</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>void_t</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_default_constructible</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_default_constructible</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>void_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>T</span><span class=p>())</span><span class=o>&gt;&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_default_constructible_v</span> <span class=o>=</span> <span class=n>is_default_constructible</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_default_constructible_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/utility/declval target=_blank rel="noopener noreferrer">std::declval</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>always_false</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>add_rvalue_reference_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>declval</span><span class=p>()</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>always_false</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=s>&#34;declval not allowed in an evaluated context&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>has_less</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>has_less</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>jc</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>())</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>has_less_v</span> <span class=o>=</span> <span class=n>has_less</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>()</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=k>operator</span><span class=o>&lt;</span><span class=p>(</span><span class=k>const</span> <span class=n>A</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_less_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_move_constructible target=_blank rel="noopener noreferrer">std::is_nothrow_move_constructible</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_nothrow_move_constructible</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_nothrow_move_constructible</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>T</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()))</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>bool_constant</span><span class=o>&lt;</span><span class=k>noexcept</span><span class=p>(</span><span class=n>T</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()))</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_nothrow_move_constructible_v</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>is_nothrow_move_constructible</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>A</span><span class=p>(</span><span class=n>A</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>B</span><span class=p>(</span><span class=n>B</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_nothrow_move_constructible_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_nothrow_move_constructible_v</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_convertible target=_blank rel="noopener noreferrer">std::is_convertible</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 转为 void 类型需要单独处理，转为数组和函数类型总是 false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>From</span><span class=p>,</span> <span class=k>typename</span> <span class=n>To</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>is_void_v</span><span class=o>&lt;</span><span class=n>To</span><span class=o>&gt;</span> <span class=o>||</span> <span class=n>std</span><span class=o>::</span><span class=n>is_array_v</span><span class=o>&lt;</span><span class=n>To</span><span class=o>&gt;</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                 <span class=n>std</span><span class=o>::</span><span class=n>is_function_v</span><span class=o>&lt;</span><span class=n>To</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_convertible_impl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>bool_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_void_v</span><span class=o>&lt;</span><span class=n>To</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span> <span class=n>std</span><span class=o>::</span><span class=n>is_void_v</span><span class=o>&lt;</span><span class=n>From</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>From</span><span class=p>,</span> <span class=k>typename</span> <span class=n>To</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_convertible_impl</span><span class=o>&lt;</span><span class=n>From</span><span class=p>,</span> <span class=n>To</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>To</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=k>typename</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()))</span><span class=o>&gt;</span>  <span class=c1>// 将 T 转为 To
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=n>test</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=n>test</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>test</span><span class=o>&lt;</span><span class=n>From</span><span class=p>,</span> <span class=n>To</span><span class=o>&gt;</span><span class=p>(</span><span class=k>nullptr</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>From</span><span class=p>,</span> <span class=k>typename</span> <span class=n>To</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_convertible</span> <span class=o>:</span> <span class=n>is_convertible_impl</span><span class=o>&lt;</span><span class=n>From</span><span class=p>,</span> <span class=n>To</span><span class=o>&gt;::</span><span class=n>type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>From</span><span class=p>,</span> <span class=k>typename</span> <span class=n>To</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_convertible_v</span> <span class=o>=</span> <span class=n>is_convertible</span><span class=o>&lt;</span><span class=n>From</span><span class=p>,</span> <span class=n>To</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=o>:</span> <span class=n>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=n>B</span><span class=p>,</span> <span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=n>B</span><span class=o>*</span><span class=p>,</span> <span class=n>A</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>*</span><span class=p>,</span> <span class=n>B</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>,</span> <span class=kt>void</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_convertible_v</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>[]</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_class target=_blank rel="noopener noreferrer">std::is_class</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_class</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_class</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>T</span><span class=o>::*&gt;&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_class_v</span> <span class=o>=</span> <span class=n>is_class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>union</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_class_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_class_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_class_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_union_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>   <span class=c1>// 仅能由编译器开洞实现
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>std</span><span class=o>::</span><span class=n>is_class_v</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>);</span>  <span class=c1>// 排除了 union 类型
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_member_pointer target=_blank rel="noopener noreferrer">std::is_member_pointer</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_pointer_helper</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=p>,</span> <span class=k>class</span> <span class=nc>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_pointer_helper</span><span class=o>&lt;</span><span class=n>T</span> <span class=n>U</span><span class=o>::*&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_pointer</span> <span class=o>:</span> <span class=n>is_member_pointer_helper</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>remove_cv_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_member_pointer_v</span> <span class=o>=</span> <span class=n>is_member_pointer</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>f</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=kt>int</span> <span class=p>(</span><span class=n>A</span><span class=o>::*</span><span class=p>)()</span> <span class=k>const</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=kt>void</span> <span class=p>(</span><span class=n>A</span><span class=o>::*</span><span class=p>)()</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>i</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=kt>double</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=p>(</span><span class=n>A</span><span class=o>::*</span><span class=n>pf</span><span class=p>)()</span> <span class=k>const</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>A</span><span class=o>::*</span><span class=n>pi</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>A</span><span class=p>{}.</span><span class=o>*</span><span class=n>pf</span><span class=p>)()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>pf</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>A</span><span class=p>{}.</span><span class=o>*</span><span class=n>pi</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>pi</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_member_function_pointer target=_blank rel="noopener noreferrer">std::is_member_function_pointer</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_function_pointer_helper</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=p>,</span> <span class=k>class</span> <span class=nc>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_function_pointer_helper</span><span class=o>&lt;</span><span class=n>T</span> <span class=n>U</span><span class=o>::*&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>is_function</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_function_pointer</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>is_member_function_pointer_helper</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>remove_cv_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_member_function_pointer_v</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>is_member_function_pointer</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span> <span class=nf>g</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>f</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>g</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>f</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>i</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=kt>double</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/types/is_member_object_pointer target=_blank rel="noopener noreferrer">std::is_member_object_pointer</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_member_object_pointer</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>bool_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_member_pointer_v</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                         <span class=o>!</span><span class=n>std</span><span class=o>::</span><span class=n>is_member_function_pointer_v</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_member_object_pointer_v</span> <span class=o>=</span> <span class=n>is_member_object_pointer</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>f</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=kt>int</span> <span class=p>(</span><span class=n>A</span><span class=o>::*</span><span class=p>)()</span> <span class=k>const</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=o>!</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=kt>void</span> <span class=p>(</span><span class=n>A</span><span class=o>::*</span><span class=p>)()</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>&amp;</span><span class=n>A</span><span class=o>::</span><span class=n>i</span><span class=p>)</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>is_member_object_pointer_v</span><span class=o>&lt;</span><span class=kt>double</span> <span class=n>A</span><span class=o>::*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>检查可访问的 non-static 成员</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define DEFINE_HAS_VAR(V)                                                  \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename, typename = std::void_t&lt;&gt;&gt;                            \
</span></span></span><span class=line><span class=cl><span class=cp>  struct has_var_##V : std::false_type {};                                 \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename T&gt;                                                    \
</span></span></span><span class=line><span class=cl><span class=cp>  struct has_var_##V&lt;T, std::void_t&lt;decltype(&amp;T::V)&gt;&gt; : std::true_type {}; \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename T&gt;                                                    \
</span></span></span><span class=line><span class=cl><span class=cp>  constexpr bool has_var_##V##_v = has_var_##V&lt;T&gt;::value;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define DEFINE_HAS_METHOD(F)                                           \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename, typename = std::void_t&lt;&gt;&gt;                        \
</span></span></span><span class=line><span class=cl><span class=cp>  struct has_func_##F : std::false_type {};                            \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename T&gt;                                                \
</span></span></span><span class=line><span class=cl><span class=cp>  struct has_func_##F&lt;T, std::void_t&lt;decltype(std::declval&lt;T&gt;().F())&gt;&gt; \
</span></span></span><span class=line><span class=cl><span class=cp>      : std::true_type {};                                             \
</span></span></span><span class=line><span class=cl><span class=cp>  template &lt;typename T&gt;                                                \
</span></span></span><span class=line><span class=cl><span class=cp>  constexpr bool has_func_##F##_v = has_func_##F&lt;T&gt;::value;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DEFINE_HAS_VAR</span><span class=p>(</span><span class=n>first</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>DEFINE_HAS_METHOD</span><span class=p>(</span><span class=n>begin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_var_first_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>pair</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_func_begin_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><a href=https://en.cppreference.com/w/cpp/experimental/is_detected target=_blank rel="noopener noreferrer">Detection idiom</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Op</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>detector</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Op</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>detector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=n>Op</span><span class=o>&lt;</span><span class=n>Args</span><span class=p>...</span><span class=o>&gt;&gt;</span><span class=p>,</span> <span class=n>Op</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Op</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>is_detected</span> <span class=o>=</span> <span class=n>detector</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>,</span> <span class=n>Op</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>has_emplace_back</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>().</span><span class=n>emplace_back</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>value_type</span><span class=o>&gt;</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>has_emplace_back_v</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>is_detected</span><span class=o>&lt;</span><span class=n>has_emplace_back</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>remove_reference_t</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_emplace_back_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_emplace_back_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>has_emplace_back_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=空基类优化ebcoempty-base-class-optimization class=headerLink><a href=#%e7%a9%ba%e5%9f%ba%e7%b1%bb%e4%bc%98%e5%8c%96ebcoempty-base-class-optimization class=header-mark></a>48 空基类优化（EBCO，Empty Base Class Optimization）</h2><ul><li>为了保证给类动态分配内存时有不同的地址，C++ 规定空类大小必须大于 0</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>B</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>A</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>B</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>a</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>一般编译器将空类大小设为 1 字节，对于空类存在继承关系的情况，如果支持 EBCO，可以优化派生类的空间占用大小</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* 不支持 EBCO 的内存布局：
</span></span></span><span class=line><span class=cl><span class=cm> * [    ] } A } B } C
</span></span></span><span class=line><span class=cl><span class=cm> * [    ]     }   }
</span></span></span><span class=line><span class=cl><span class=cm> * [    ]         }
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * 支持 EBCO 的内存布局：
</span></span></span><span class=line><span class=cl><span class=cm> * [    ] } A } B } C
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Int</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=o>:</span> <span class=n>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span> <span class=o>:</span> <span class=n>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>B</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>C</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板参数可能是空类</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>U</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>C</span><span class=o>&lt;</span><span class=n>A</span><span class=p>,</span> <span class=n>B</span><span class=o>&gt;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>为了利用 EBCO 压缩内存空间，可以将模板参数设为基类</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span> <span class=o>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>U</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>C</span><span class=o>&lt;</span><span class=n>A</span><span class=p>,</span> <span class=n>B</span><span class=o>&gt;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>但模板参数可能是相同类型，或者不一定是类，此时将其设为基类在实例化时会报错。如果已知一个模板参数类型为空类，把可能为空的类型参数与一个不为空的成员利用 EBCO 合并起来，即可把空类占用的空间优化掉</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Base</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Member</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Pair</span> <span class=o>:</span> <span class=k>private</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Pair</span><span class=p>(</span><span class=k>const</span> <span class=n>Base</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>,</span> <span class=k>const</span> <span class=n>Member</span><span class=o>&amp;</span> <span class=n>m</span><span class=p>)</span> <span class=o>:</span> <span class=n>Base</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=n>member_</span><span class=p>(</span><span class=n>m</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Base</span><span class=o>&amp;</span> <span class=n>first</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=p>(</span><span class=k>const</span> <span class=n>Base</span><span class=o>&amp;</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=o>&amp;</span> <span class=n>first</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=p>(</span><span class=n>Base</span><span class=o>&amp;</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Member</span><span class=o>&amp;</span> <span class=n>second</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>member_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Member</span><span class=o>&amp;</span> <span class=n>second</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>member_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Member</span> <span class=n>member_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Unoptimizable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>info</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span><span class=o>*</span> <span class=n>storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Optimizable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Pair</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=n>info_and_storage</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Unoptimizable</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>*</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Optimizable</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=奇异递归模板模式crtpthe-curiously-recurring-template-pattern class=headerLink><a href=#%e5%a5%87%e5%bc%82%e9%80%92%e5%bd%92%e6%a8%a1%e6%9d%bf%e6%a8%a1%e5%bc%8fcrtpthe-curiously-recurring-template-pattern class=header-mark></a>49 奇异递归模板模式（CRTP，The Curiously Recurring Template Pattern）</h2><ul><li>CRTP 的实现手法是将派生类作为基类的模板参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>count</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>()</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>(</span><span class=k>const</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>(</span><span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>Base</span><span class=p>()</span> <span class=p>{</span> <span class=o>--</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>Derived</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>count</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;::</span><span class=n>count</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>通常大量运算符重载会一起出现，但通常这些运算符只需要一个定义，其他运算符可以提取到基类中基于这一个来实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>!=</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=o>!</span><span class=p>(</span><span class=n>lhs</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>Derived</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>i_</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>i_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>i_</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span> <span class=n>a</span><span class=p>{</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span> <span class=n>b</span><span class=p>{</span><span class=mi>2</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span> <span class=o>!=</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>CRTP 基类可以基于 CRTP 派生类暴露的小得多的接口定义大部分接口，这个模式称为 facade 模式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iterator&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Derived</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Value</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Category</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>IteratorFacade</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>value_type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>remove_const_t</span><span class=o>&lt;</span><span class=n>Value</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>reference</span> <span class=o>=</span> <span class=n>Value</span><span class=o>&amp;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>pointer</span> <span class=o>=</span> <span class=n>Value</span><span class=o>*</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>difference_type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>ptrdiff_t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>iterator_category</span> <span class=o>=</span> <span class=n>Category</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>reference</span> <span class=k>operator</span><span class=o>*</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=nf>as_derived</span><span class=p>().</span><span class=n>dereference</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>++</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>as_derived</span><span class=p>().</span><span class=n>increment</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>as_derived</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span> <span class=k>operator</span><span class=o>++</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Derived</span> <span class=nf>tmp</span><span class=p>(</span><span class=n>as_derived</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>as_derived</span><span class=p>().</span><span class=n>increment</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>IteratorFacade</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>IteratorFacade</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>as_derived</span><span class=p>().</span><span class=n>equals</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>as_derived</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>!=</span><span class=p>(</span><span class=k>const</span> <span class=n>IteratorFacade</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>IteratorFacade</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>!</span><span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=n>lhs</span><span class=p>,</span> <span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>as_derived</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>Derived</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>as_derived</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>Derived</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ListNode</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>ListNode</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=o>:</span> <span class=n>value</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;*</span> <span class=n>next</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ListNodeIterator</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=k>public</span> <span class=n>IteratorFacade</span><span class=o>&lt;</span><span class=n>ListNodeIterator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>forward_iterator_tag</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>ListNodeIterator</span><span class=p>(</span><span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;*</span> <span class=n>t</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>)</span> <span class=o>:</span> <span class=n>t_</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=n>dereference</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>t_</span><span class=o>-&gt;</span><span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>increment</span><span class=p>()</span> <span class=p>{</span> <span class=n>t_</span> <span class=o>=</span> <span class=n>t_</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>equals</span><span class=p>(</span><span class=k>const</span> <span class=n>ListNodeIterator</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>t_</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>t_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>ListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;*</span> <span class=n>t_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>a</span> <span class=o>=</span> <span class=k>new</span> <span class=n>jc</span><span class=o>::</span><span class=n>ListNode</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{</span><span class=mi>1</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>jc</span><span class=o>::</span><span class=n>ListNode</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{</span><span class=mi>2</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>c</span> <span class=o>=</span> <span class=k>new</span> <span class=n>jc</span><span class=o>::</span><span class=n>ListNode</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{</span><span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>a</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>b</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>first</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>ListNodeIterator</span><span class=p>{</span><span class=n>a</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>last</span> <span class=o>=</span> <span class=o>++</span><span class=n>jc</span><span class=o>::</span><span class=n>ListNodeIterator</span><span class=p>{</span><span class=n>c</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=n>it</span> <span class=o>=</span> <span class=n>first</span><span class=p>;</span> <span class=n>it</span> <span class=o>!=</span> <span class=n>last</span><span class=p>;</span> <span class=o>++</span><span class=n>it</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=o>*</span><span class=n>it</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>v</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>delete</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>delete</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>delete</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=mixins class=headerLink><a href=#mixins class=header-mark></a>50 Mixins</h2><ul><li>使用 Mixins 手法可以更方便地引入额外信息</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Mixins</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Point</span> <span class=o>:</span> <span class=n>Mixins</span><span class=p>...</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Point</span><span class=p>()</span> <span class=o>:</span> <span class=n>Mixins</span><span class=p>()...,</span> <span class=n>x</span><span class=p>(</span><span class=mf>0.0</span><span class=p>),</span> <span class=n>y</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>Point</span><span class=p>(</span><span class=kt>double</span> <span class=n>x</span><span class=p>,</span> <span class=kt>double</span> <span class=n>y</span><span class=p>)</span> <span class=o>:</span> <span class=n>Mixins</span><span class=p>()...,</span> <span class=n>x</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>y</span><span class=p>(</span><span class=n>y</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Label</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>label</span> <span class=o>=</span> <span class=s>&#34;point&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>enum</span> <span class=p>{</span> <span class=n>red</span><span class=p>,</span> <span class=n>green</span><span class=p>,</span> <span class=n>blue</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>CustomPoint</span> <span class=o>=</span> <span class=n>Point</span><span class=o>&lt;</span><span class=n>Label</span><span class=p>,</span> <span class=n>Color</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>CustomPoint</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=s>&#34;point&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>red</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>::</span><span class=n>red</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>green</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>::</span><span class=n>green</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>blue</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>::</span><span class=n>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>CRTP-mixin</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>int</span> <span class=n>count</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>()</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>(</span><span class=k>const</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Base</span><span class=p>(</span><span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span> <span class=o>++</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>Base</span><span class=p>()</span> <span class=p>{</span> <span class=o>--</span><span class=n>i</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span><span class=err>... </span><span class=nc>Mixins</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Point</span> <span class=o>:</span> <span class=n>Mixins</span><span class=o>&lt;</span><span class=n>Point</span><span class=o>&lt;&gt;&gt;</span><span class=p>...</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Point</span><span class=p>()</span> <span class=o>:</span> <span class=n>Mixins</span><span class=o>&lt;</span><span class=n>Point</span><span class=o>&lt;&gt;&gt;</span><span class=p>()...,</span> <span class=n>x</span><span class=p>(</span><span class=mf>0.0</span><span class=p>),</span> <span class=n>y</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=n>Point</span><span class=p>(</span><span class=kt>double</span> <span class=n>x</span><span class=p>,</span> <span class=kt>double</span> <span class=n>y</span><span class=p>)</span> <span class=o>:</span> <span class=n>Mixins</span><span class=o>&lt;</span><span class=n>Point</span><span class=o>&lt;&gt;&gt;</span><span class=p>()...,</span> <span class=n>x</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>y</span><span class=p>(</span><span class=n>y</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Label</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>label</span> <span class=o>=</span> <span class=s>&#34;point&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>enum</span> <span class=p>{</span> <span class=n>red</span><span class=p>,</span> <span class=n>green</span><span class=p>,</span> <span class=n>blue</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>PointCount</span> <span class=o>=</span> <span class=n>Point</span><span class=o>&lt;</span><span class=n>Base</span><span class=p>,</span> <span class=n>Label</span><span class=p>,</span> <span class=n>Color</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>PointCount</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>PointCount</span><span class=o>::</span><span class=n>count</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=s>&#34;point&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>red</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;::</span><span class=n>red</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>green</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;::</span><span class=n>green</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>blue</span> <span class=o>==</span> <span class=n>jc</span><span class=o>::</span><span class=n>Color</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;::</span><span class=n>blue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Mixins 参数化成员函数的虚拟性</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Mixins</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=o>:</span> <span class=k>private</span> <span class=n>Mixins</span><span class=p>...</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>  <span class=c1>// 是否为虚函数由 Mixins 中的声明决定
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Mixins</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>Mixins</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Base</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>new</span> <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=n>A</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>p</span><span class=o>-&gt;</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>Base</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;*</span> <span class=n>q</span> <span class=o>=</span> <span class=k>new</span> <span class=n>jc</span><span class=o>::</span><span class=n>Derived</span><span class=o>&lt;</span><span class=n>B</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>q</span><span class=o>-&gt;</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=指定模板参数 class=headerLink><a href=#%e6%8c%87%e5%ae%9a%e6%a8%a1%e6%9d%bf%e5%8f%82%e6%95%b0 class=header-mark></a>51 指定模板参数</h2><ul><li>模板常常带有一长串类型参数，不过通常都设有默认值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span> <span class=o>=</span> <span class=n>A</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span> <span class=o>=</span> <span class=n>B</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T3</span> <span class=o>=</span> <span class=n>C</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MyClass</span> <span class=p>{};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>现在想指定某个实参，而其他参数依然使用默认实参</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>B</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>C</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Alias</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P1</span> <span class=o>=</span> <span class=n>A</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P2</span> <span class=o>=</span> <span class=n>B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P3</span> <span class=o>=</span> <span class=n>C</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>SetT1</span> <span class=o>:</span> <span class=k>virtual</span> <span class=n>Alias</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P1</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>SetT2</span> <span class=o>:</span> <span class=k>virtual</span> <span class=n>Alias</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P2</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>SetT3</span> <span class=o>:</span> <span class=k>virtual</span> <span class=n>Alias</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>P3</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 由于不能从多个相同类直接继承，需要一个中间层用于区分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Mid</span> <span class=o>:</span> <span class=n>T</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T3</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>SetBase</span> <span class=o>:</span> <span class=n>Mid</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Mid</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Mid</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* Alias 要被用作默认实参
</span></span></span><span class=line><span class=cl><span class=cm> * 但 SetBase 会将其多次指定为 Mid 的基类
</span></span></span><span class=line><span class=cl><span class=cm> * 为了防止多次继承产生二义性
</span></span></span><span class=line><span class=cl><span class=cm> * 虚派生一个新类替代 Alias 作为默认实参
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Args</span> <span class=o>:</span> <span class=k>virtual</span> <span class=n>Alias</span> <span class=p>{};</span>  <span class=c1>// Args 即包含了别名 P1、P2、P3
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span> <span class=o>=</span> <span class=n>Args</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span> <span class=o>=</span> <span class=n>Args</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T3</span> <span class=o>=</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Policies</span> <span class=o>=</span> <span class=n>SetBase</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>T3</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>Policies</span><span class=o>::</span><span class=n>P3</span><span class=o>::</span><span class=n>f</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>D</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>MyClass</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>MyClass</span><span class=o>&lt;</span><span class=n>SetT3</span><span class=o>&lt;</span><span class=n>D</span><span class=o>&gt;&gt;</span><span class=p>{}.</span><span class=n>f</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=类型擦除type-erasure class=headerLink><a href=#%e7%b1%bb%e5%9e%8b%e6%93%a6%e9%99%a4type-erasure class=header-mark></a>52 类型擦除（Type Erasure）</h2><ul><li>类型擦除即将不同类型抽象为相同的表示，但使用时仍可以还原出原有类型的行为，<a href=https://en.cppreference.com/w/cpp/utility/any target=_blank rel="noopener noreferrer">std::any</a> 和 <a href=https://en.cppreference.com/w/cpp/utility/functional/function target=_blank rel="noopener noreferrer">std::function</a> 就使用了类型擦除的手法。比起函数指针，<a href=https://en.cppreference.com/w/cpp/utility/functional/function target=_blank rel="noopener noreferrer">std::function</a> 在编译期擦除掉了不需要关心的原有类型，用同一种表示抽象了所有函数类型，并且能存储 lambda 或函数对象，使用时又能像调用函数一样使用原有类型</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;any&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;exception&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>is_equality_comparable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>void</span><span class=o>*</span> <span class=n>conv</span><span class=p>(</span><span class=kt>bool</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=n>test</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=k>decltype</span><span class=p>(</span><span class=n>conv</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>U</span><span class=o>&amp;&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>U</span><span class=o>&amp;&gt;</span><span class=p>())),</span>
</span></span><span class=line><span class=cl>      <span class=k>decltype</span><span class=p>(</span><span class=n>conv</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>U</span><span class=o>&amp;&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>U</span><span class=o>&amp;&gt;</span><span class=p>()))));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=n>test</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>test</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>nullptr</span><span class=p>,</span> <span class=k>nullptr</span><span class=p>))</span><span class=o>::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_equality_comparable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>try_equals</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>bool</span> <span class=nf>equals</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>lhs</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>not_equality_comparable</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>exception</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>try_equals</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>bool</span> <span class=nf>equals</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=n>not_equality_comparable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>functor_bridge</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=o>~</span><span class=n>functor_bridge</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>functor_bridge</span><span class=o>*</span> <span class=nf>clone</span><span class=p>()</span> <span class=k>const</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>R</span> <span class=nf>invoke</span><span class=p>(</span><span class=n>Args</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=k>const</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>bool</span> <span class=nf>equals</span><span class=p>(</span><span class=k>const</span> <span class=n>functor_bridge</span><span class=o>*</span><span class=p>)</span> <span class=k>const</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>functor_bridge_impl</span> <span class=o>:</span> <span class=k>public</span> <span class=n>functor_bridge</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>functor_bridge_impl</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>)</span> <span class=o>:</span> <span class=n>f_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>functor_bridge_impl</span><span class=o>*</span> <span class=nf>clone</span><span class=p>()</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>functor_bridge_impl</span><span class=p>(</span><span class=n>f_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=n>R</span> <span class=nf>invoke</span><span class=p>(</span><span class=n>Args</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>f_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>virtual</span> <span class=kt>bool</span> <span class=nf>equals</span><span class=p>(</span><span class=k>const</span> <span class=n>functor_bridge</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;*</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>auto</span> <span class=n>p</span> <span class=o>=</span> <span class=k>dynamic_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>functor_bridge_impl</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>try_equals</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;::</span><span class=n>equals</span><span class=p>(</span><span class=n>f_</span><span class=p>,</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>f_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>F</span> <span class=n>f_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>function</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>function</span><span class=o>&lt;</span><span class=n>R</span><span class=p>(</span><span class=n>Args</span><span class=p>...)</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>lhs</span> <span class=o>||</span> <span class=o>!</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>!</span><span class=n>lhs</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>rhs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>bridge_</span><span class=o>-&gt;</span><span class=n>equals</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>!=</span><span class=p>(</span><span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>!</span><span class=p>(</span><span class=n>lhs</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>void</span> <span class=nf>swap</span><span class=p>(</span><span class=n>function</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>swap</span><span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>,</span> <span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=p>(</span><span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>bridge_</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=o>-&gt;</span><span class=n>clone</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=p>(</span><span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>function</span><span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>function</span><span class=o>&amp;&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=p>(</span><span class=n>function</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>:</span> <span class=n>bridge_</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Bridge</span> <span class=o>=</span> <span class=n>functor_bridge_impl</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>R</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bridge_</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Bridge</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>));</span>  <span class=c1>// type erasure
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>function</span><span class=p>()</span> <span class=p>{</span> <span class=k>delete</span> <span class=n>bridge_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>function</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=nf>tmp</span><span class=p>(</span><span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>swap</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>,</span> <span class=n>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>function</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>bridge_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bridge_</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>rhs</span><span class=p>.</span><span class=n>bridge_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>function</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=nf>tmp</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>swap</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>,</span> <span class=n>tmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=k>operator</span> <span class=nf>bool</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>bridge_</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>R</span> <span class=nf>operator</span><span class=p>()(</span><span class=n>Args</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bridge_</span><span class=o>-&gt;</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Args</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>functor_bridge</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;*</span> <span class=n>bridge_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>f</span> <span class=o>=</span> <span class=p>[](</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>any</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>any_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>f</span><span class=p>(</span><span class=mf>3.14</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=元编程metaprogramming class=headerLink><a href=#%e5%85%83%e7%bc%96%e7%a8%8bmetaprogramming class=header-mark></a>53 元编程（Metaprogramming）</h2><ul><li>元编程将计算在编译期完成，避免了运行期计算的开销</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=p>,</span> <span class=kt>int</span><span class=p>...</span> <span class=n>Ns</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>max</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>max</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>N2</span><span class=p>,</span> <span class=kt>int</span><span class=p>...</span> <span class=n>Ns</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>max</span><span class=o>&lt;</span><span class=n>N1</span><span class=p>,</span> <span class=n>N2</span><span class=p>,</span> <span class=n>Ns</span><span class=p>...</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=p>(</span><span class=n>N1</span> <span class=o>&lt;</span> <span class=n>N2</span><span class=p>)</span> <span class=o>?</span> <span class=n>max</span><span class=o>&lt;</span><span class=n>N2</span><span class=p>,</span> <span class=n>Ns</span><span class=p>...</span><span class=o>&gt;::</span><span class=nl>value</span>
</span></span><span class=line><span class=cl>                                            <span class=p>:</span> <span class=n>max</span><span class=o>&lt;</span><span class=n>N1</span><span class=p>,</span> <span class=n>Ns</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span><span class=p>...</span> <span class=n>Ns</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>max_v</span> <span class=o>=</span> <span class=n>max</span><span class=o>&lt;</span><span class=n>Ns</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>max_v</span><span class=o>&lt;</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=o>&gt;</span> <span class=o>==</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>模板元编程通常使用偏特化和递归实现，由于编译期需要实例化代码，如果递归层次过深，会带来代码体积膨胀的问题</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=p>,</span> <span class=kt>int</span> <span class=n>L</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>R</span> <span class=o>=</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>sqrt</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>M</span> <span class=o>=</span> <span class=n>L</span> <span class=o>+</span> <span class=p>(</span><span class=n>R</span> <span class=o>-</span> <span class=n>L</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>T</span> <span class=o>=</span> <span class=n>N</span> <span class=o>/</span> <span class=n>M</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>value</span> <span class=o>=</span>  <span class=c1>// 避免递归实例化所有分支
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>std</span><span class=o>::</span><span class=n>conditional_t</span><span class=o>&lt;</span><span class=p>(</span><span class=n>T</span> <span class=o>&lt;</span> <span class=n>M</span><span class=p>),</span> <span class=n>sqrt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>L</span><span class=p>,</span> <span class=n>M</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>sqrt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>M</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>R</span><span class=o>&gt;&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=p>,</span> <span class=kt>int</span> <span class=n>M</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>sqrt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>M</span><span class=p>,</span> <span class=n>M</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>value</span> <span class=o>=</span> <span class=n>M</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>sqrt_v</span> <span class=o>=</span> <span class=n>sqrt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>sqrt_v</span><span class=o>&lt;</span><span class=mi>10000</span><span class=o>&gt;</span> <span class=o>==</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++14 支持 constexpr 函数，简化了实现并且没有递归实例化的代码膨胀问题</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>sqrt</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=n>N</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>l</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>l</span> <span class=o>&lt;</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>m</span> <span class=o>=</span> <span class=n>l</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>-</span> <span class=n>l</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>t</span> <span class=o>=</span> <span class=n>N</span> <span class=o>/</span> <span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>m</span> <span class=o>==</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=n>m</span> <span class=o>&gt;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>r</span> <span class=o>=</span> <span class=n>m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>l</span> <span class=o>=</span> <span class=n>m</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>l</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>sqrt</span><span class=o>&lt;</span><span class=mi>10000</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=循环展开loop-unrolling class=headerLink><a href=#%e5%be%aa%e7%8e%af%e5%b1%95%e5%bc%80loop-unrolling class=header-mark></a>54 循环展开（Loop Unrolling）</h2><ul><li>在一些机器上，for 循环的汇编将产生分支指令</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>dot_product</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>res</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>+=</span> <span class=n>lhs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>dot_product</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>循环展开是一种牺牲体积加快程序执行速度的方法，现代编译器会优化循环为目标平台最高效形式。使用元编程可以展开循环，虽然已经没有必要，但还是给出实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;array&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>dot_product_impl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>T</span> <span class=nf>value</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>*</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>*</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=n>lhs</span> <span class=o>*</span> <span class=o>*</span><span class=n>rhs</span> <span class=o>+</span> <span class=n>dot_product_impl</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span> <span class=o>-</span> <span class=mi>1</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>(</span><span class=n>lhs</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>rhs</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>dot_product_impl</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>T</span> <span class=nf>value</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>*</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>*</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>T</span><span class=p>{};</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>dot_product</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>dot_product_impl</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>(</span><span class=o>&amp;*</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>lhs</span><span class=p>),</span> <span class=o>&amp;*</span><span class=n>std</span><span class=o>::</span><span class=n>begin</span><span class=p>(</span><span class=n>rhs</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>array</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>dot_product</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=unit-typehttpsenwikipediaorgwikiunit_type class=headerLink><a href=#unit-typehttpsenwikipediaorgwikiunit_type class=header-mark></a>55 <a href=https://en.wikipedia.org/wiki/Unit_type target=_blank rel="noopener noreferrer">Unit Type</a></h2><ul><li><a href=https://en.cppreference.com/w/cpp/numeric/ratio/ratio target=_blank rel="noopener noreferrer">std::ratio</a></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cmath&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>int</span> <span class=n>N</span><span class=p>,</span> <span class=kt>int</span> <span class=n>D</span> <span class=o>=</span> <span class=mi>1</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ratio</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>num</span> <span class=o>=</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>den</span> <span class=o>=</span> <span class=n>D</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=n>num</span><span class=p>,</span> <span class=n>den</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ratio_add_impl</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>den</span> <span class=o>=</span> <span class=n>R1</span><span class=o>::</span><span class=n>den</span> <span class=o>*</span> <span class=n>R2</span><span class=o>::</span><span class=n>den</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>int</span> <span class=n>num</span> <span class=o>=</span> <span class=n>R1</span><span class=o>::</span><span class=n>num</span> <span class=o>*</span> <span class=n>R2</span><span class=o>::</span><span class=n>den</span> <span class=o>+</span> <span class=n>R2</span><span class=o>::</span><span class=n>num</span> <span class=o>*</span> <span class=n>R1</span><span class=o>::</span><span class=n>den</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=n>num</span><span class=p>,</span> <span class=n>den</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>ratio_add</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>ratio_add_impl</span><span class=o>&lt;</span><span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span> <span class=o>=</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>duration</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>rep</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>period</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>U</span><span class=o>::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>duration</span><span class=p>(</span><span class=n>rep</span> <span class=n>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>:</span> <span class=n>r_</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>rep</span> <span class=nf>count</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>r_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>rep</span> <span class=n>r_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=k>operator</span><span class=o>+</span><span class=p>(</span><span class=k>const</span> <span class=n>duration</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>U1</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=k>const</span> <span class=n>duration</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=n>U2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>CommonType</span> <span class=o>=</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=n>ratio_add</span><span class=o>&lt;</span><span class=n>U1</span><span class=p>,</span> <span class=n>U2</span><span class=o>&gt;::</span><span class=n>den</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>res</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>*</span> <span class=n>U1</span><span class=o>::</span><span class=n>num</span> <span class=o>/</span> <span class=n>U1</span><span class=o>::</span><span class=n>den</span> <span class=o>+</span> <span class=n>rhs</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>*</span> <span class=n>U2</span><span class=o>::</span><span class=n>num</span> <span class=o>/</span> <span class=n>U2</span><span class=o>::</span><span class=n>den</span><span class=p>)</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>      <span class=n>CommonType</span><span class=o>::</span><span class=n>den</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>duration</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>res</span><span class=p>),</span> <span class=n>CommonType</span><span class=o>&gt;</span><span class=p>{</span><span class=n>res</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>a</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>  <span class=c1>// 10 ms
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>b</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=mf>7.5</span><span class=p>);</span>    <span class=c1>// 2.5 s
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>constexpr</span> <span class=k>auto</span> <span class=n>c</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>  <span class=c1>// 10 * 3 + 7.5 * 1000 = 7530 * 1/3000 s
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>abs</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>7530</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mf>1e-6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>jc</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3000</span><span class=o>&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=k>decltype</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=o>::</span><span class=n>period</span><span class=o>::</span><span class=n>num</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=k>decltype</span><span class=p>(</span><span class=n>c</span><span class=p>)</span><span class=o>::</span><span class=n>period</span><span class=o>::</span><span class=n>den</span> <span class=o>==</span> <span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=typelist class=headerLink><a href=#typelist class=header-mark></a>56 Typelist</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span><span class=lnt>412
</span><span class=lnt>413
</span><span class=lnt>414
</span><span class=lnt>415
</span><span class=lnt>416
</span><span class=lnt>417
</span><span class=lnt>418
</span><span class=lnt>419
</span><span class=lnt>420
</span><span class=lnt>421
</span><span class=lnt>422
</span><span class=lnt>423
</span><span class=lnt>424
</span><span class=lnt>425
</span><span class=lnt>426
</span><span class=lnt>427
</span><span class=lnt>428
</span><span class=lnt>429
</span><span class=lnt>430
</span><span class=lnt>431
</span><span class=lnt>432
</span><span class=lnt>433
</span><span class=lnt>434
</span><span class=lnt>435
</span><span class=lnt>436
</span><span class=lnt>437
</span><span class=lnt>438
</span><span class=lnt>439
</span><span class=lnt>440
</span><span class=lnt>441
</span><span class=lnt>442
</span><span class=lnt>443
</span><span class=lnt>444
</span><span class=lnt>445
</span><span class=lnt>446
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// typelist.hpp
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#pragma once
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>typelist</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>front</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>front</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>Head</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>front_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>front</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pop_front_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>pop_front</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>pop_front</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>pop_front_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>pop_front</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// push_front_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_front</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Elements</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_front</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Elements</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=n>NewElement</span><span class=p>,</span> <span class=n>Elements</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>push_front_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>push_front</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// nth_element_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>nth_element</span> <span class=o>:</span> <span class=n>nth_element</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>N</span> <span class=o>-</span> <span class=mi>1</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>nth_element</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>front</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>nth_element_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>nth_element</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// is_empty
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_empty</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_empty</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_empty_v</span> <span class=o>=</span> <span class=n>is_empty</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// find_index_of_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=n>Empty</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>find_index_of</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>find_index_of</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>conditional_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>find_index_of</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>find_index_of</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>find_index_of_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>find_index_of</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// push_back_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=p>,</span> <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_back_impl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_back_impl</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>head</span> <span class=o>=</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>tail</span> <span class=o>=</span> <span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>new_tail</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>push_back_impl</span><span class=o>&lt;</span><span class=n>tail</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>new_tail</span><span class=p>,</span> <span class=n>head</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_back_impl</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_back</span> <span class=o>:</span> <span class=n>push_back_impl</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * template &lt;typename List, typename NewElement&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * struct push_back;
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * template &lt;typename... Elements, typename NewElement&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * struct push_back&lt;typelist&lt;Elements...&gt;, NewElement&gt; {
</span></span></span><span class=line><span class=cl><span class=cm> * using type = typelist&lt;Elements..., NewElement&gt;;
</span></span></span><span class=line><span class=cl><span class=cm> * };
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>NewElement</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>push_back_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>push_back</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>NewElement</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// reverse_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>Empty</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>reverse</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>reverse_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>reverse</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>reverse</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>push_back</span><span class=o>&lt;</span><span class=n>reverse_t</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>reverse</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>List</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// pop_back_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>pop_back</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>reverse_t</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>reverse_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>pop_back_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>pop_back</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// largest_type_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>largest_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>largest_type</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>contender</span> <span class=o>=</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>best</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>largest_type</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>conditional_t</span><span class=o>&lt;</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>contender</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>best</span><span class=p>)),</span> <span class=n>contender</span><span class=p>,</span> <span class=n>best</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>largest_type</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=kt>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>largest_type_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>largest_type</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// transform_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>transform</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * template &lt;typename List, template &lt;typename T&gt; class MetaFun&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * struct transform&lt;List, MetaFun, false&gt;
</span></span></span><span class=line><span class=cl><span class=cm> *     : push_front&lt;typename transform&lt;pop_front_t&lt;List&gt;, MetaFun&gt;::type,
</span></span></span><span class=line><span class=cl><span class=cm> *                  typename MetaFun&lt;front_t&lt;List&gt;&gt;::type&gt; {};
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Elements</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>transform</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Elements</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>MetaFun</span><span class=o>&lt;</span><span class=n>Elements</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>transform</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>List</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>transform_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>transform</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>MetaFun</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// accumulate_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>F</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span> <span class=n>Init</span><span class=p>,</span> <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>accumulate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span> <span class=n>Init</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>accumulate</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span> <span class=n>Init</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>accumulate</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=k>typename</span> <span class=n>MetaFun</span><span class=o>&lt;</span><span class=n>Init</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;::</span><span class=n>type</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span> <span class=n>Init</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>accumulate</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span> <span class=n>Init</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>Init</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>MetaFun</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span> <span class=n>Init</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>accumulate_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>accumulate</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>MetaFun</span><span class=p>,</span> <span class=n>Init</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// insert_sorted_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>type_identity</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insert_sorted</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insert_sorted</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Element</span><span class=p>,</span> <span class=n>Compare</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=c1>// compute the tail of the resulting list:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>new_tail</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>std</span><span class=o>::</span><span class=n>conditional_t</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=n>Compare</span><span class=o>&lt;</span><span class=n>Element</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;::</span><span class=n>value</span><span class=p>,</span> <span class=n>type_identity</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>insert_sorted</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Element</span><span class=p>,</span> <span class=n>Compare</span><span class=o>&gt;&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// compute the head of the resulting list:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>new_head</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>conditional_t</span><span class=o>&lt;</span><span class=n>Compare</span><span class=o>&lt;</span><span class=n>Element</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;::</span><span class=n>value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>Element</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>new_tail</span><span class=p>,</span> <span class=n>new_head</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insert_sorted</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Element</span><span class=p>,</span> <span class=n>Compare</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>push_front</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Element</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>insert_sorted_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>insert_sorted</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Element</span><span class=p>,</span> <span class=n>Compare</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// insertion_sort_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=o>=</span> <span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insertion_sort</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>insertion_sort_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>insertion_sort</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Compare</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insertion_sort</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Compare</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>insert_sorted</span><span class=o>&lt;</span><span class=n>insertion_sort_t</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Compare</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>Compare</span><span class=o>&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>insertion_sort</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>Compare</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>List</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// multiply_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>multiply</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Value1</span><span class=p>,</span> <span class=n>T</span> <span class=n>Value2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>multiply</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Value1</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Value2</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Value1</span> <span class=o>*</span> <span class=n>Value2</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>multiply_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>multiply</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>U</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// for std::index_sequence
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Values</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_empty</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Values</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Values</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>Head</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>front</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>Head</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>value</span> <span class=o>=</span> <span class=n>Head</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>Head</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>pop_front</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Values</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>New</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_front</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Values</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>New</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>New</span><span class=p>,</span> <span class=n>Values</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Values</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>New</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_back</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Values</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>New</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Values</span><span class=p>...,</span> <span class=n>New</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// select_t
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Types</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>select</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Types</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>select</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Indices</span><span class=o>&gt;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Types</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>select_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>select</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Indices</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Cons
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Nil</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Tail</span> <span class=o>=</span> <span class=n>Nil</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Cons</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>head</span> <span class=o>=</span> <span class=n>Head</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>tail</span> <span class=o>=</span> <span class=n>Tail</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>front</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>List</span><span class=o>::</span><span class=n>head</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>push_front</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=n>Element</span><span class=p>,</span> <span class=n>List</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>pop_front</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>List</span><span class=o>::</span><span class=n>tail</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_empty</span><span class=o>&lt;</span><span class=n>Nil</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>smaller</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=o>&lt;</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>U</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>less</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>M</span><span class=p>,</span> <span class=n>T</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>less</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>M</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=n>M</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=p>...</span> <span class=n>Values</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>integral_constant_typelist</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=n>typelist</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Values</span><span class=o>&gt;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>integral_constant_typelist</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>typelist</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>T1</span> <span class=o>=</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;&gt;</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>front_t</span><span class=o>&lt;</span><span class=n>T1</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>T2</span> <span class=o>=</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>front_t</span><span class=o>&lt;</span><span class=n>T2</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>T2</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>T3</span> <span class=o>=</span> <span class=n>push_back_t</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>find_index_of_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>find_index_of_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>find_index_of_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=kt>int</span><span class=o>*&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>2</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>reverse_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>char</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>pop_back_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>largest_type_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>transform_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>add_const</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>typelist</span><span class=o>&lt;</span><span class=k>const</span> <span class=kt>double</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=o>*</span> <span class=k>const</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>accumulate_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=n>push_front</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>char</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>insertion_sort_t</span><span class=o>&lt;</span><span class=n>T3</span><span class=p>,</span> <span class=n>smaller</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=o>*</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>accumulate_t</span><span class=o>&lt;</span><span class=n>integral_constant_typelist</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>multiply</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>insertion_sort_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>less</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>front</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;&gt;::</span><span class=n>value</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>front_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>0</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>push_back_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>make_index_sequence</span><span class=o>&lt;</span><span class=mi>4</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>select_t</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=kt>char</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>typelist</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=kt>bool</span><span class=p>,</span> <span class=kt>char</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>ConsList</span> <span class=o>=</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>short</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>is_empty_v</span><span class=o>&lt;</span><span class=n>Nil</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>              <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>ConsList</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>short</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>ConsList</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>short</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>front_t</span><span class=o>&lt;</span><span class=n>ConsList</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>insertion_sort_t</span><span class=o>&lt;</span><span class=n>ConsList</span><span class=p>,</span> <span class=n>smaller</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>char</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>short</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>Cons</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc::test
</span></span></span></code></pre></td></tr></table></div></div><h2 id=stdtuplehttpsencppreferencecomwcpputilitytuple class=headerLink><a href=#stdtuplehttpsencppreferencecomwcpputilitytuple class=header-mark></a>57 <a href=https://en.cppreference.com/w/cpp/utility/tuple target=_blank rel="noopener noreferrer">std::tuple</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span><span class=lnt>377
</span><span class=lnt>378
</span><span class=lnt>379
</span><span class=lnt>380
</span><span class=lnt>381
</span><span class=lnt>382
</span><span class=lnt>383
</span><span class=lnt>384
</span><span class=lnt>385
</span><span class=lnt>386
</span><span class=lnt>387
</span><span class=lnt>388
</span><span class=lnt>389
</span><span class=lnt>390
</span><span class=lnt>391
</span><span class=lnt>392
</span><span class=lnt>393
</span><span class=lnt>394
</span><span class=lnt>395
</span><span class=lnt>396
</span><span class=lnt>397
</span><span class=lnt>398
</span><span class=lnt>399
</span><span class=lnt>400
</span><span class=lnt>401
</span><span class=lnt>402
</span><span class=lnt>403
</span><span class=lnt>404
</span><span class=lnt>405
</span><span class=lnt>406
</span><span class=lnt>407
</span><span class=lnt>408
</span><span class=lnt>409
</span><span class=lnt>410
</span><span class=lnt>411
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;complex&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstring&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;typelist.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>head</span><span class=p>),</span> <span class=n>tail_</span><span class=p>(</span><span class=n>tail</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=n>VHead</span><span class=o>&amp;&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=n>VTail</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VHead</span><span class=o>&gt;</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span> <span class=n>tail_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VTail</span><span class=o>&gt;</span><span class=p>(</span><span class=n>tail</span><span class=p>)...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()),</span> <span class=n>tail_</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>())</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// for push_back_tuple
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>tail_</span><span class=p>(</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>head_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>head_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>tail_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>tail_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Index</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Head</span> <span class=n>head_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=n>tail_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>tuple_get</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>apply</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tuple_get</span><span class=o>&lt;</span><span class=n>N</span> <span class=o>-</span> <span class=mi>1</span><span class=o>&gt;::</span><span class=n>apply</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>get_tail</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>tuple_get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>apply</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>t</span><span class=p>.</span><span class=n>get_head</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>tuple_get</span><span class=o>&lt;</span><span class=n>N</span><span class=o>&gt;::</span><span class=n>apply</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;::</span><span class=k>operator</span><span class=p>[](</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Index</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>get</span><span class=o>&lt;</span><span class=n>Index</span><span class=o>&gt;</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>make_tuple</span><span class=p>(</span><span class=n>Types</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>decay_t</span><span class=o>&lt;</span><span class=n>Types</span><span class=o>&gt;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Types</span><span class=o>&gt;</span><span class=p>(</span><span class=n>args</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;&gt;&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;&gt;&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>Head1</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Head2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail1</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail2</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head1</span><span class=p>,</span> <span class=n>Tail1</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head2</span><span class=p>,</span> <span class=n>Tail2</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=n>lhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_tuple</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;&gt;&amp;</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>is_first</span> <span class=o>=</span> <span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>is_first</span> <span class=o>?</span> <span class=sc>&#39;(&#39;</span> <span class=o>:</span> <span class=sc>&#39;)&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print_tuple</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=kt>bool</span> <span class=n>is_first</span> <span class=o>=</span> <span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>is_first</span> <span class=o>?</span> <span class=s>&#34;(&#34;</span> <span class=o>:</span> <span class=s>&#34;, &#34;</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>t</span><span class=p>.</span><span class=n>get_head</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>print_tuple</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>t</span><span class=p>.</span><span class=n>get_tail</span><span class=p>(),</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print_tuple</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>  <span class=c1>// typelist
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>is_empty</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>front</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>Head</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>pop_front</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>push_front</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Element</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Element</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Element</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>push_back</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Element</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...,</span> <span class=n>Element</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=n>pop_front_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>t</span><span class=p>.</span><span class=n>get_tail</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>push_front_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>push_front_t</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span><span class=p>{</span><span class=n>v</span><span class=p>,</span> <span class=n>t</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>tuple</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>push_back_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;&gt;&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>{</span><span class=n>v</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>push_back_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                        <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...,</span> <span class=n>V</span><span class=o>&gt;</span><span class=p>{</span><span class=n>t</span><span class=p>.</span><span class=n>get_head</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                                 <span class=n>push_back_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>.</span><span class=n>get_tail</span><span class=p>(),</span> <span class=n>v</span><span class=p>)};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>select_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// find std::make_tuple using ADL so explicitly specify the namespace
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=n>jc</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=n>get</span><span class=o>&lt;</span><span class=n>Indices</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>reverse_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>select_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>reverse_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>index_sequence_for</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The following implementation copies elements repeatedly.
</span></span></span><span class=line><span class=cl><span class=c1>// tuple&lt;&gt; reverse_tuple(const tuple&lt;&gt;&amp; t) { return t; }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// template &lt;typename Head, typename... Tail&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// reverse_t&lt;tuple&lt;Head, Tail...&gt;&gt; reverse_tuple(const tuple&lt;Head, Tail...&gt;&amp; t)
</span></span></span><span class=line><span class=cl><span class=c1>// {
</span></span></span><span class=line><span class=cl><span class=c1>//   return push_back_tuple(reverse_tuple(t.get_tail()), t.get_head());
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>pop_back_t</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=n>pop_back_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>reverse_tuple</span><span class=p>(</span><span class=n>pop_front_tuple</span><span class=p>(</span><span class=n>reverse_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>)));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>I</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span> <span class=n>IndexList</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>replicated_index_list</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>I</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>replicated_index_list</span><span class=o>&lt;</span><span class=n>I</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>I</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>replicated_index_list</span><span class=o>&lt;</span><span class=n>I</span><span class=p>,</span> <span class=n>N</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>replicated_index_list</span><span class=o>&lt;</span><span class=n>I</span><span class=p>,</span> <span class=n>N</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...,</span> <span class=n>I</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>I</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>replicated_index_list_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>replicated_index_list</span><span class=o>&lt;</span><span class=n>I</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>I</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>splat_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>select_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>replicated_index_list_t</span><span class=o>&lt;</span><span class=n>I</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>List</span><span class=p>,</span> <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>F</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>metafun_of_nth_element</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>Apply</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>M</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>Apply</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>M</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>F</span><span class=o>&lt;</span><span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>M</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>nth_element_t</span><span class=o>&lt;</span><span class=n>List</span><span class=p>,</span> <span class=n>N</span><span class=o>&gt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>Compare</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>sort_tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>select_tuple</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>insertion_sort_t</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>          <span class=n>std</span><span class=o>::</span><span class=n>index_sequence_for</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>metafun_of_nth_element</span><span class=o>&lt;</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Compare</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>Apply</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>...</span> <span class=n>Indices</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>apply_impl</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>std</span><span class=o>::</span><span class=n>index_sequence</span><span class=o>&lt;</span><span class=n>Indices</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>invoke</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>get</span><span class=o>&lt;</span><span class=n>Indices</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)...);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>F</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>apply</span><span class=p>(</span><span class=n>F</span><span class=o>&amp;&amp;</span> <span class=n>f</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>apply_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span><span class=p>),</span> <span class=n>t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>index_sequence_for</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>  <span class=c1>// integral_constant literal
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=nf>to_int</span><span class=p>(</span><span class=kt>char</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// hexadecimal letters:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;A&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;F&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;A&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;a&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;f&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>c</span> <span class=o>&gt;=</span> <span class=sc>&#39;0&#39;</span> <span class=o>&amp;&amp;</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=sc>&#39;9&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>parse_int</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>arr</span><span class=p>)[</span><span class=n>N</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>base</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>   <span class=c1>// to handle base (default: decimal)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>offset</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// to skip prefixes like 0x
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=n>N</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=n>arr</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sc>&#39;0&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;x&#39;</span><span class=o>:</span>  <span class=c1>// prefix 0x or 0X, so hexadecimal
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>case</span> <span class=sc>&#39;X&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=sc>&#39;b&#39;</span><span class=o>:</span>  <span class=c1>// prefix 0b or 0B (since C++14), so binary
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>case</span> <span class=sc>&#39;B&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>base</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>  <span class=c1>// prefix 0, so octal
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>base</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>multiplier</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span> <span class=o>-</span> <span class=n>offset</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>N</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;\&#39;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>res</span> <span class=o>+=</span> <span class=n>to_int</span><span class=p>(</span><span class=n>arr</span><span class=p>[</span><span class=n>N</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>i</span><span class=p>])</span> <span class=o>*</span> <span class=n>multiplier</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>multiplier</span> <span class=o>*=</span> <span class=n>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=kt>char</span><span class=p>...</span> <span class=n>cs</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>auto</span> <span class=k>operator</span><span class=s>&#34;&#34;</span> <span class=n>_c</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>parse_int</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>cs</span><span class=p>)</span><span class=o>&gt;</span><span class=p>({</span><span class=n>cs</span><span class=p>...})</span><span class=o>&gt;</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_make_tuple</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mi>42</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)),</span> <span class=k>const</span> <span class=kt>int</span><span class=o>&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)),</span> <span class=k>const</span> <span class=kt>double</span><span class=o>&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)),</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=k>const</span><span class=o>&amp;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>),</span> <span class=s>&#34;downdemo&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>jc</span><span class=o>::</span><span class=k>operator</span><span class=s>&#34;&#34;</span> <span class=n>_c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>t</span><span class=p>[</span><span class=mi>0</span><span class=n>_c</span><span class=p>]</span> <span class=o>==</span> <span class=mi>42</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=n>_c</span><span class=p>]</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>((</span><span class=n>std</span><span class=o>::</span><span class=n>strcmp</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>2</span><span class=n>_c</span><span class=p>],</span> <span class=s>&#34;downdemo&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;(42, 3.14, downdemo)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_typelist</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>t</span><span class=p>{</span><span class=mi>42</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=s>&#34;downdemo&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>front_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>pop_front_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>push_front_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>),</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>push_back_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>),</span> <span class=kt>bool</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>reverse_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t2</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>pop_front_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t2</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t2</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t2</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t3</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>push_front_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t3</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t3</span><span class=p>)</span> <span class=o>==</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t3</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t3</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t3</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t4</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>push_back_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t4</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t4</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t4</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t4</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t4</span><span class=p>)</span> <span class=o>==</span> <span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t5</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>reverse_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t5</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t5</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t5</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t5</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t6</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>pop_back_tuple</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t6</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t6</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t6</span><span class=p>)</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t7</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>splat_tuple</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t7</span><span class=p>),</span> <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>0</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t7</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t7</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>get</span><span class=o>&lt;</span><span class=mi>2</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t7</span><span class=p>)</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_sort_tuple</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mi>17LL</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>complex</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=mi>42</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t2</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>sort_tuple</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>smaller</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                     <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>long</span> <span class=kt>long</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>complex</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=n>t2</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                     <span class=n>jc</span><span class=o>::</span><span class=n>tuple</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=kt>long</span> <span class=kt>long</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>complex</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;(17, (1,2), 42, 3.14)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>t2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;(42, 3.14, 17, (1,2))&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_apply</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>f</span> <span class=o>=</span> <span class=p>[</span><span class=o>&amp;</span><span class=n>os</span><span class=p>](</span><span class=k>auto</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span> <span class=p>((</span><span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>args</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span><span class=p>),</span> <span class=p>...);</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span> <span class=n>t</span> <span class=o>=</span> <span class=n>jc</span><span class=o>::</span><span class=n>make_tuple</span><span class=p>(</span><span class=mi>42</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>,</span> <span class=s>&#34;downdemo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>apply</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;42 3.14 downdemo &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>test_make_tuple</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_typelist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_sort_tuple</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_apply</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>上述 tuple 的存储实现比实际需要使用了更多的空间，一个问题在于 tail 成员最终将是一个空 tuple，为此可使用 EBCO，派生自尾 tuple，而不是让它作为一个成员，这样可以消除一个字节的大小，<a href=https://en.cppreference.com/w/cpp/utility/tuple target=_blank rel="noopener noreferrer">std::tuple</a> 采用了这种做法</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=k>private</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>head</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>tail</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=n>VHead</span><span class=o>&amp;&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=n>VTail</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VHead</span><span class=o>&gt;</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>TailElt</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VTail</span><span class=o>&gt;</span><span class=p>(</span><span class=n>tail</span><span class=p>)...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>())</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// for push_back_tuple
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>head_</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>head_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>head_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Index</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Head</span> <span class=n>head_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>TailElt</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span></code></pre></td></tr></table></div></div><ul><li>由于 tail 在基类中，会先于 head 成员初始化，为此引入一个包裹 head 成员的类模板 tuple_elt，将其作为基类并置于 tail 之前。由于不能继承相同的类型，为此需要给 tuple_elt 一个额外的模板参数用于区分类型，以允许 tuple 有相同类型的元素</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple_elt</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>(</span><span class=n>U</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>value_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=k>private</span> <span class=n>tuple_elt</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=n>Head</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=k>private</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>head</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>tail</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=n>VHead</span><span class=o>&amp;&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=n>VTail</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VHead</span><span class=o>&gt;</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>TailElt</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VTail</span><span class=o>&gt;</span><span class=p>(</span><span class=n>tail</span><span class=p>)...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>())</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// for push_back_tuple
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>HeadElt</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>get</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>HeadElt</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Index</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>HeadElt</span> <span class=o>=</span> <span class=n>tuple_elt</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=n>Head</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>TailElt</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span></code></pre></td></tr></table></div></div><ul><li>让 tuple_elt 继承元素类型以进一步使用 EBCO</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=kt>bool</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>is_class_v</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>std</span><span class=o>::</span><span class=n>is_final_v</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple_elt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple_elt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=nb>false</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>(</span><span class=n>U</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>value_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>N</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple_elt</span><span class=o>&lt;</span><span class=n>N</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=nb>true</span><span class=o>&gt;</span> <span class=o>:</span> <span class=k>private</span> <span class=n>T</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple_elt</span><span class=p>(</span><span class=n>U</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>T</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span><span class=p>(</span><span class=n>rhs</span><span class=p>))</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=k>private</span> <span class=n>tuple_elt</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=n>Head</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=k>private</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>head</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>tail</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=n>VHead</span><span class=o>&amp;&amp;</span> <span class=n>head</span><span class=p>,</span> <span class=n>VTail</span><span class=o>&amp;&amp;</span><span class=p>...</span> <span class=n>tail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VHead</span><span class=o>&gt;</span><span class=p>(</span><span class=n>head</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>TailElt</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>VTail</span><span class=o>&gt;</span><span class=p>(</span><span class=n>tail</span><span class=p>)...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>      <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>enable_if_t</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>VTail</span><span class=p>)</span> <span class=o>==</span> <span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=kt>void</span><span class=o>*&gt;</span> <span class=o>=</span> <span class=k>nullptr</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_head</span><span class=p>()),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>get_tail</span><span class=p>())</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// for push_back_tuple
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>VHead</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>VTail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=p>(</span><span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>,</span> <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>VHead</span><span class=p>,</span> <span class=n>VTail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>HeadElt</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>TailElt</span><span class=p>(</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>HeadElt</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>get</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Head</span><span class=o>&amp;</span> <span class=n>get_head</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>HeadElt</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>get_tail</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>Index</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>auto</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Index</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>HeadElt</span> <span class=o>=</span> <span class=n>tuple_elt</span><span class=o>&lt;</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>),</span> <span class=n>Head</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>TailElt</span> <span class=o>=</span> <span class=n>tuple</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>tuple</span><span class=o>&lt;&gt;</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span></code></pre></td></tr></table></div></div><h2 id=stdvarianthttpsencppreferencecomwcpputilityvariant class=headerLink><a href=#stdvarianthttpsencppreferencecomwcpputilityvariant class=header-mark></a>58 <a href=https://en.cppreference.com/w/cpp/utility/variant target=_blank rel="noopener noreferrer">std::variant</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span><span class=lnt>370
</span><span class=lnt>371
</span><span class=lnt>372
</span><span class=lnt>373
</span><span class=lnt>374
</span><span class=lnt>375
</span><span class=lnt>376
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;exception&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;new&gt;</span><span class=cp>  </span><span class=c1>// for std::launder()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;utility&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;typelist.hpp&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>computed_result_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>visit_element_result</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=k>decltype</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>()(</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>visit_result</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>R</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>visit_result</span><span class=o>&lt;</span><span class=n>computed_result_type</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>common_type_t</span><span class=o>&lt;</span><span class=n>visit_element_result</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=o>&gt;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>visit_result_t</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>visit_result</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>empty_variant</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>exception</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span><span class=p>,</span> <span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Head</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>R</span> <span class=n>variant_visit_impl</span><span class=p>(</span><span class=n>V</span><span class=o>&amp;&amp;</span> <span class=n>variant</span><span class=p>,</span> <span class=n>Visitor</span><span class=o>&amp;&amp;</span> <span class=n>vis</span><span class=p>,</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Head</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>variant</span><span class=p>.</span><span class=k>template</span> <span class=n>is</span><span class=o>&lt;</span><span class=n>Head</span><span class=o>&gt;</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>R</span><span class=o>&gt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vis</span><span class=p>)(</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>(</span><span class=n>variant</span><span class=p>).</span><span class=k>template</span> <span class=n>get</span><span class=o>&lt;</span><span class=n>Head</span><span class=o>&gt;</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>variant_visit_impl</span><span class=o>&lt;</span><span class=n>R</span><span class=o>&gt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>(</span><span class=n>variant</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                 <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vis</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                 <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nf>empty_variant</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>variant_storage</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>get_discriminator</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>discriminator_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>set_discriminator</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>d</span><span class=p>)</span> <span class=p>{</span> <span class=n>discriminator_</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span><span class=o>*</span> <span class=nf>get_raw_buffer</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>buffer_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=kt>void</span><span class=o>*</span> <span class=nf>get_raw_buffer</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>buffer_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>*</span> <span class=n>get_buffer_as</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>launder</span><span class=p>(</span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>T</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>buffer_</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>*</span> <span class=n>get_buffer_as</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>launder</span><span class=p>(</span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>T</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>buffer_</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>largest_t</span> <span class=o>=</span> <span class=n>largest_type_t</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>alignas</span><span class=p>(</span><span class=n>Types</span><span class=p>...)</span> <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>buffer_</span><span class=p>[</span><span class=k>sizeof</span><span class=p>(</span><span class=n>largest_t</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>discriminator_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>variant</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>variant_choice</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Derived</span> <span class=o>=</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>get_derived</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>Derived</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Derived</span><span class=o>&amp;</span> <span class=n>get_derived</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>Derived</span><span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>unsigned</span> <span class=n>Discriminator</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>find_index_of_t</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>variant_choice</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant_choice</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_raw_buffer</span><span class=p>())</span> <span class=n>T</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>  <span class=c1>// CRTP
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>get_derived</span><span class=p>().</span><span class=n>set_discriminator</span><span class=p>(</span><span class=n>Discriminator</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant_choice</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_raw_buffer</span><span class=p>())</span> <span class=n>T</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>get_derived</span><span class=p>().</span><span class=n>set_discriminator</span><span class=p>(</span><span class=n>Discriminator</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>destroy</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_discriminator</span><span class=p>()</span> <span class=o>==</span> <span class=n>Discriminator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>get_derived</span><span class=p>().</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()</span><span class=o>-&gt;~</span><span class=n>T</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_discriminator</span><span class=p>()</span> <span class=o>==</span> <span class=n>Discriminator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=o>*</span><span class=n>get_derived</span><span class=p>().</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>get_derived</span><span class=p>().</span><span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_raw_buffer</span><span class=p>())</span> <span class=n>T</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>get_derived</span><span class=p>().</span><span class=n>set_discriminator</span><span class=p>(</span><span class=n>Discriminator</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>get_derived</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Derived</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_discriminator</span><span class=p>()</span> <span class=o>==</span> <span class=n>Discriminator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=o>*</span><span class=n>get_derived</span><span class=p>().</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>get_derived</span><span class=p>().</span><span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=p>(</span><span class=n>get_derived</span><span class=p>().</span><span class=n>get_raw_buffer</span><span class=p>())</span> <span class=n>T</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=n>get_derived</span><span class=p>().</span><span class=n>set_discriminator</span><span class=p>(</span><span class=n>Discriminator</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>get_derived</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * class variant&lt;int, double, std::string&gt;
</span></span></span><span class=line><span class=cl><span class=cm> *     : private variant_storage&lt;int, double, std::string&gt;,
</span></span></span><span class=line><span class=cl><span class=cm> *       private variant_choice&lt;int, int, double, std::string&gt;,
</span></span></span><span class=line><span class=cl><span class=cm> *       private variant_choice&lt;double, int, double, std::string&gt;,
</span></span></span><span class=line><span class=cl><span class=cm> *       private variant_choice&lt;std::string, int, double, std::string&gt; {};
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * variant_choice&lt;int, int, double, std::string&gt;::discriminator_ == 1;
</span></span></span><span class=line><span class=cl><span class=cm> * variant_choice&lt;double, int, double, std::string&gt;::discriminator_ == 2;
</span></span></span><span class=line><span class=cl><span class=cm> * variant_choice&lt;std::string, int, double, std::string&gt;::discriminator_ == 3;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>variant</span> <span class=o>:</span> <span class=k>private</span> <span class=n>variant_storage</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>private</span> <span class=n>variant_choice</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>...</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>OtherTypes</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=k>class</span> <span class=nc>variant_choice</span><span class=p>;</span>  <span class=c1>// enable CRTP
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>   * ctor of variant&lt;int, double, string&gt;:
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(const int&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(int&amp;&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(const double&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(double&amp;&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(const string&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   * variant(string&amp;&amp;);
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>variant_choice</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>variant_choice</span><span class=p>...;</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>variant_choice</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;::</span><span class=k>operator</span><span class=o>=</span><span class=p>...;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=p>()</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>front_t</span><span class=o>&lt;</span><span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&gt;</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=p>(</span><span class=k>const</span> <span class=n>variant</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rhs</span><span class=p>.</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=p>(</span><span class=n>variant</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>).</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>SourceTypes</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=p>(</span><span class=k>const</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>SourceTypes</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rhs</span><span class=p>.</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>SourceTypes</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=p>(</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>SourceTypes</span><span class=p>...</span><span class=o>&gt;&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>).</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>variant</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rhs</span><span class=p>.</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>variant</span><span class=o>&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>).</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>SourceTypes</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>SourceTypes</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rhs</span><span class=p>.</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>SourceTypes</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>variant</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>SourceTypes</span><span class=p>...</span><span class=o>&gt;&amp;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rhs</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>rhs</span><span class=p>).</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=p>](</span><span class=k>auto</span><span class=o>&amp;&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=k>this</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=nf>empty</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>get_discriminator</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>variant</span><span class=p>()</span> <span class=p>{</span> <span class=n>destroy</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>destroy</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>variant_choice</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>destroy</span><span class=p>(),</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>-&gt;</span><span class=n>set_discriminator</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=n>is</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=o>-&gt;</span><span class=n>get_discriminator</span><span class=p>()</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>           <span class=n>variant_choice</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>Discriminator</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=o>&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nf>empty_variant</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>is</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=o>-&gt;</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=k>const</span><span class=o>&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nf>empty_variant</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>is</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=o>-&gt;</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;&amp;</span> <span class=n>get</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>empty</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nf>empty_variant</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>is</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=o>-&gt;</span><span class=k>template</span> <span class=n>get_buffer_as</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span> <span class=o>=</span> <span class=n>computed_result_type</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=o>&amp;</span><span class=p>...</span><span class=o>&gt;</span> <span class=n>visit</span><span class=p>(</span><span class=n>Visitor</span><span class=o>&amp;&amp;</span> <span class=n>vis</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Result</span> <span class=o>=</span> <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=o>&amp;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>variant_visit_impl</span><span class=o>&lt;</span><span class=n>Result</span><span class=o>&gt;</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vis</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                      <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span> <span class=o>=</span> <span class=n>computed_result_type</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>const</span> <span class=n>Types</span><span class=o>&amp;</span><span class=p>...</span><span class=o>&gt;</span> <span class=n>visit</span><span class=p>(</span><span class=n>Visitor</span><span class=o>&amp;&amp;</span> <span class=n>vis</span><span class=p>)</span> <span class=k>const</span><span class=o>&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Result</span> <span class=o>=</span> <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=k>const</span> <span class=n>Types</span><span class=o>&amp;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>variant_visit_impl</span><span class=o>&lt;</span><span class=n>Result</span><span class=o>&gt;</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vis</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                      <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>R</span> <span class=o>=</span> <span class=n>computed_result_type</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Visitor</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=o>&amp;&amp;</span><span class=p>...</span><span class=o>&gt;</span> <span class=n>visit</span><span class=p>(</span><span class=n>Visitor</span><span class=o>&amp;&amp;</span> <span class=n>vis</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>Result</span> <span class=o>=</span> <span class=n>visit_result_t</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span> <span class=n>Visitor</span><span class=p>,</span> <span class=n>Types</span><span class=o>&amp;&amp;</span><span class=p>...</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>variant_visit_impl</span><span class=o>&lt;</span><span class=n>Result</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>),</span> <span class=n>std</span><span class=o>::</span><span class=n>forward</span><span class=o>&lt;</span><span class=n>Visitor</span><span class=o>&gt;</span><span class=p>(</span><span class=n>vis</span><span class=p>),</span> <span class=n>typelist</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>{});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>copied_noncopyable</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>exception</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>noncopyable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>noncopyable</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>noncopyable</span><span class=p>(</span><span class=k>const</span> <span class=n>noncopyable</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>throw</span> <span class=nf>copied_noncopyable</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>noncopyable</span><span class=p>(</span><span class=n>noncopyable</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>noncopyable</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>noncopyable</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span> <span class=k>throw</span> <span class=nf>copied_noncopyable</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>noncopyable</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>noncopyable</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>V</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Head</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Tail</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print_impl</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>V</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=k>template</span> <span class=n>is</span><span class=o>&lt;</span><span class=n>Head</span><span class=o>&gt;</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>v</span><span class=p>.</span><span class=k>template</span> <span class=n>get</span><span class=o>&lt;</span><span class=n>Head</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>...(</span><span class=n>Tail</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>print_impl</span><span class=o>&lt;</span><span class=n>V</span><span class=p>,</span> <span class=n>Tail</span><span class=p>...</span><span class=o>&gt;</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Types</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>print</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>os</span><span class=p>,</span> <span class=k>const</span> <span class=n>variant</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print_impl</span><span class=o>&lt;</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Types</span><span class=p>...</span><span class=o>&gt;</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc::test
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_variant</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>{</span><span class=mi>42</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>v</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span> <span class=o>=</span> <span class=mf>3.14</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=mf>3.14</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span> <span class=o>=</span> <span class=s>&#34;hello&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>stringstream</span> <span class=n>os</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v</span><span class=p>.</span><span class=n>visit</span><span class=p>([</span><span class=o>&amp;</span><span class=n>os</span><span class=p>](</span><span class=k>const</span> <span class=k>auto</span><span class=o>&amp;</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=n>os</span> <span class=o>&lt;&lt;</span> <span class=n>value</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>print</span><span class=p>(</span><span class=n>os</span><span class=p>,</span> <span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>os</span><span class=p>.</span><span class=n>str</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>v2</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v2</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>().</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v2</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v2</span><span class=p>.</span><span class=n>get</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>==</span> <span class=s>&#34;hello&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span><span class=p>.</span><span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>v2</span><span class=p>.</span><span class=n>empty</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>test_noncopyable</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>noncopyable</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>noncopyable</span> <span class=n>nc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=n>nc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>copied_noncopyable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=o>!</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>v</span><span class=p>.</span><span class=n>is</span><span class=o>&lt;</span><span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>noncopyable</span><span class=o>&gt;</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>test_variant</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>test_noncopyable</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=表达式模板expression-template class=headerLink><a href=#%e8%a1%a8%e8%be%be%e5%bc%8f%e6%a8%a1%e6%9d%bfexpression-template class=header-mark></a>59 表达式模板（Expression Template）</h2><ul><li>表达式模板支持对数组像内置类型一样进行数值运算，并且不会产生临时对象</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cassert&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstddef&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SArray</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>SArray</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>sz</span><span class=p>)</span> <span class=o>:</span> <span class=n>data_</span><span class=p>(</span><span class=k>new</span> <span class=n>T</span><span class=p>[</span><span class=n>sz</span><span class=p>]),</span> <span class=n>sz_</span><span class=p>(</span><span class=n>sz</span><span class=p>)</span> <span class=p>{</span> <span class=n>init</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>data_</span><span class=p>(</span><span class=k>new</span> <span class=n>T</span><span class=p>[</span><span class=n>rhs</span><span class=p>.</span><span class=n>sz_</span><span class=p>]),</span> <span class=n>sz_</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>sz_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>copy</span><span class=p>(</span><span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>rhs</span> <span class=o>!=</span> <span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>copy</span><span class=p>(</span><span class=n>rhs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>SArray</span><span class=p>()</span> <span class=p>{</span> <span class=k>delete</span><span class=p>[]</span> <span class=n>data_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>sz_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>data_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>data_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=k>operator</span><span class=o>+=</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>sz_</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>sz_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz_</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>)[</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=k>operator</span><span class=o>*=</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>sz_</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>sz_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz_</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>)[</span><span class=n>i</span><span class=p>]</span> <span class=o>*=</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=k>operator</span><span class=o>*=</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz_</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=o>*</span><span class=k>this</span><span class=p>)[</span><span class=n>i</span><span class=p>]</span> <span class=o>*=</span> <span class=n>rhs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=n>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz_</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>data_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>T</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>copy</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>sz_</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>sz_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz_</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>data_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>.</span><span class=n>data_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>*</span> <span class=n>data_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>sz_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=o>+</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>res</span><span class=p>{</span><span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>()};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>lhs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>res</span><span class=p>{</span><span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>()};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>lhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>lhs</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>res</span><span class=p>{</span><span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>()};</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>lhs</span> <span class=o>*</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A_Scalar</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>A_Scalar</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=o>:</span> <span class=n>value_</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A_Traits</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A_Traits</span><span class=o>&lt;</span><span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>type</span> <span class=o>=</span> <span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>OP1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>OP2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A_Add</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A_Add</span><span class=p>(</span><span class=k>const</span> <span class=n>OP1</span><span class=o>&amp;</span> <span class=n>op1</span><span class=p>,</span> <span class=k>const</span> <span class=n>OP2</span><span class=o>&amp;</span> <span class=n>op2</span><span class=p>)</span> <span class=o>:</span> <span class=n>op1_</span><span class=p>(</span><span class=n>op1</span><span class=p>),</span> <span class=n>op2_</span><span class=p>(</span><span class=n>op2</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>op1_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>op2_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>:</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>A_Traits</span><span class=o>&lt;</span><span class=n>OP1</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>op1_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>A_Traits</span><span class=o>&lt;</span><span class=n>OP2</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>op2_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>OP1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>OP2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A_Mult</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A_Mult</span><span class=p>(</span><span class=k>const</span> <span class=n>OP1</span><span class=o>&amp;</span> <span class=n>op1</span><span class=p>,</span> <span class=k>const</span> <span class=n>OP2</span><span class=o>&amp;</span> <span class=n>op2</span><span class=p>)</span> <span class=o>:</span> <span class=n>op1_</span><span class=p>(</span><span class=n>op1</span><span class=p>),</span> <span class=n>op2_</span><span class=p>(</span><span class=n>op2</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>op1_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>op2_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>op1_</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>:</span> <span class=n>op2_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>A_Traits</span><span class=o>&lt;</span><span class=n>OP1</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>op1_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>A_Traits</span><span class=o>&lt;</span><span class=n>OP2</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>op2_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>A1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>A2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A_Subscript</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>A_Subscript</span><span class=p>(</span><span class=k>const</span> <span class=n>A1</span><span class=o>&amp;</span> <span class=n>a1</span><span class=p>,</span> <span class=k>const</span> <span class=n>A2</span><span class=o>&amp;</span> <span class=n>a2</span><span class=p>)</span> <span class=o>:</span> <span class=n>a1_</span><span class=p>(</span><span class=n>a1</span><span class=p>),</span> <span class=n>a2_</span><span class=p>(</span><span class=n>a2</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>const_cast</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&amp;&gt;</span><span class=p>(</span><span class=n>a1_</span><span class=p>[</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a2_</span><span class=p>[</span><span class=n>i</span><span class=p>])]);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>decltype</span><span class=p>(</span><span class=k>auto</span><span class=p>)</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a1_</span><span class=p>[</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a2_</span><span class=p>[</span><span class=n>i</span><span class=p>])];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>a2_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>A1</span><span class=o>&amp;</span> <span class=n>a1_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>A2</span><span class=o>&amp;</span> <span class=n>a2_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>jc</span><span class=o>::</span><span class=n>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Rep</span> <span class=o>=</span> <span class=n>SArray</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>explicit</span> <span class=n>Array</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=o>:</span> <span class=n>r_</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Array</span><span class=p>(</span><span class=k>const</span> <span class=n>Rep</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=o>:</span> <span class=n>r_</span><span class=p>(</span><span class=n>rhs</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Array</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Array</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>r_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Rep2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>Array</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>r_</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>size</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>r_</span><span class=p>.</span><span class=n>size</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>T</span><span class=o>&amp;</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>decltype</span><span class=p>(</span><span class=k>auto</span><span class=p>)</span> <span class=k>operator</span><span class=p>[](</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>size</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r_</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Rep2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Subscript</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Rep</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&gt;</span> <span class=k>operator</span><span class=p>[](</span><span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Subscript</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Rep</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&gt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>A_Subscript</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Rep</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;</span><span class=p>{</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>rep</span><span class=p>(),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>rep</span><span class=p>()}};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Rep2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>decltype</span><span class=p>(</span><span class=k>auto</span><span class=p>)</span> <span class=k>operator</span><span class=p>[](</span><span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T2</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Subscript</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Rep</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;&gt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>A_Subscript</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>Rep</span><span class=p>,</span> <span class=n>Rep2</span><span class=o>&gt;</span><span class=p>{</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>rep</span><span class=p>(),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>rep</span><span class=p>()}};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>Rep</span><span class=o>&amp;</span> <span class=n>rep</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>r_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>Rep</span><span class=o>&amp;</span> <span class=n>rep</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>r_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>Rep</span> <span class=n>r_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Add</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span> <span class=k>operator</span><span class=o>+</span><span class=p>(</span><span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Add</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span><span class=p>{</span><span class=n>A_Add</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;</span><span class=p>{</span><span class=n>lhs</span><span class=p>.</span><span class=n>rep</span><span class=p>(),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>rep</span><span class=p>()}};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=o>&gt;&amp;</span> <span class=n>lhs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span><span class=p>{</span><span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R1</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;</span><span class=p>{</span><span class=n>lhs</span><span class=p>.</span><span class=n>rep</span><span class=p>(),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>rep</span><span class=p>()}};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>R2</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span> <span class=k>operator</span><span class=o>*</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=k>const</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>Array</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;&gt;</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>A_Mult</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>R2</span><span class=o>&gt;</span><span class=p>{</span><span class=n>A_Scalar</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>lhs</span><span class=p>),</span> <span class=n>rhs</span><span class=p>.</span><span class=n>rep</span><span class=p>()}};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>  <span class=c1>// namespace jc::test
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>sz</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>double</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=kt>double</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>Array</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>x</span><span class=p>{</span><span class=n>sz</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>Array</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>y</span><span class=p>{</span><span class=n>sz</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>sz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>assert</span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>==</span> <span class=n>sz</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>x</span> <span class=o>=</span> <span class=mf>1.2</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=n>x</span> <span class=o>*</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>                <span class=k>decltype</span><span class=p>(</span><span class=mf>1.2</span> <span class=o>*</span> <span class=n>x</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>Array</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_Mult</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_Scalar</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                   <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>                <span class=k>decltype</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>y</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>Array</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_Mult</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                   <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>          <span class=k>decltype</span><span class=p>(</span><span class=mf>1.2</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=n>x</span> <span class=o>*</span> <span class=n>y</span><span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=n>jc</span><span class=o>::</span><span class=n>test</span><span class=o>::</span><span class=n>Array</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>jc</span><span class=o>::</span><span class=n>A_Add</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=n>jc</span><span class=o>::</span><span class=n>A_Mult</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>A_Scalar</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=n>jc</span><span class=o>::</span><span class=n>A_Mult</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=n>jc</span><span class=o>::</span><span class=n>SArray</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;&gt;&gt;&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mf>1.2</span> <span class=o>*</span> <span class=n>a</span> <span class=o>+</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>   * x[y] = 2.0 * x[y] equals to:
</span></span></span><span class=line><span class=cl><span class=cm>   * for (std::size_t i = 0; i &lt; y.size(); ++i) {
</span></span></span><span class=line><span class=cl><span class=cm>   *   x[y[i]] = 2 * x[y[i]];
</span></span></span><span class=line><span class=cl><span class=cm>   * }
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=n>x</span><span class=p>[</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=mf>2.0</span> <span class=o>*</span> <span class=n>x</span><span class=p>[</span><span class=n>y</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sz</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>assert</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=mf>2.0</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.2</span> <span class=o>*</span> <span class=n>a</span> <span class=o>+</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=性能与约束 class=headerLink><a href=#%e6%80%a7%e8%83%bd%e4%b8%8e%e7%ba%a6%e6%9d%9f class=header-mark></a>60 性能与约束</h2><ul><li>表达式模板可以提高数组操作性能，跟踪其行为可以发现很多小的内联函数互相调用，调用堆栈分配了很多小的表达式模板对象，因此编译器必须执行完整的内联和去除小对象操作，以产生性能上和手写循环媲美的代码</li><li>表达式模板没有解决所有数组数值运算的问题，如对 <code>x = A * x</code> 的运算，A 是 <code>n * n</code> 矩阵，x 是 n 个元素的 vector，临时变量的使用不可避免，因为最终结果的每个元素都依赖于 x 每个元素的初始值，而表达式模板会在一次计算后更新 x 的元素，计算下一个元素时用到已更新的元素就改变了原数组，但针对 <code>x = A * y</code>，如果 x 和 y 不互为别名，就不需要临时对象，因此必须在运行期知道操作数是否为别名关系，即必须生成运行期结构来表示表达式树，而不是在表达式模板的类型中编码这棵树</li></ul><h2 id=浅实例化shallow-instantiation class=headerLink><a href=#%e6%b5%85%e5%ae%9e%e4%be%8b%e5%8c%96shallow-instantiation class=header-mark></a>61 浅实例化（Shallow Instantiation）</h2><ul><li>模板的报错会跟踪导致问题的所有层次，冗长的报错信息使调试变得更为繁琐，真正的问题一般出现在一长串实例化之后</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f1</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// 假设 T 为指针类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f2</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f1</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f3</span><span class=p>(</span><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>Type</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f2</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f4</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>Type</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f3</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Type</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f4</span><span class=p>(</span><span class=n>A</span><span class=p>{});</span>  <span class=c1>// 错误，只能在实例化时被检测到
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// 实例化 f4&lt;A&gt;(const A&amp;)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// 实例化 f3&lt;A&gt;(int)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// 实例化 f2&lt;int&gt;(int&amp;)
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// 实例化 f1&lt;int&gt;(int&amp;)，解引用 int 出错
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * error C2100: 非法的间接寻址
</span></span></span><span class=line><span class=cl><span class=cm> * message : 查看对正在编译的函数 模板 实例化“void f1&lt;T&gt;(T &amp;)”的引用
</span></span></span><span class=line><span class=cl><span class=cm> *         with
</span></span></span><span class=line><span class=cl><span class=cm> *         [
</span></span></span><span class=line><span class=cl><span class=cm> *             T=A::Type
</span></span></span><span class=line><span class=cl><span class=cm> *         ]
</span></span></span><span class=line><span class=cl><span class=cm> * message : 查看对正在编译的函数 模板 实例化“void f2&lt;A::Type&gt;(T &amp;)”的引用
</span></span></span><span class=line><span class=cl><span class=cm> *         with
</span></span></span><span class=line><span class=cl><span class=cm> *         [
</span></span></span><span class=line><span class=cl><span class=cm> *             T=A::Type
</span></span></span><span class=line><span class=cl><span class=cm> *         ]
</span></span></span><span class=line><span class=cl><span class=cm> * message : 查看对正在编译的函数 模板 实例化“void f3&lt;T&gt;(A::Type)”的引用
</span></span></span><span class=line><span class=cl><span class=cm> *         with
</span></span></span><span class=line><span class=cl><span class=cm> *         [
</span></span></span><span class=line><span class=cl><span class=cm> *             T=A
</span></span></span><span class=line><span class=cl><span class=cm> *         ]
</span></span></span><span class=line><span class=cl><span class=cm> * message : 查看对正在编译的函数 模板 实例化“void f4&lt;A&gt;(const T &amp;)”的引用
</span></span></span><span class=line><span class=cl><span class=cm> *         with
</span></span></span><span class=line><span class=cl><span class=cm> *         [
</span></span></span><span class=line><span class=cl><span class=cm> *             T=A
</span></span></span><span class=line><span class=cl><span class=cm> *         ]
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>一种简单的减少报错信息长度的方式是提前使用参数</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f1</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// 假设 T 为指针类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f2</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f1</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f3</span><span class=p>(</span><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>Type</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f2</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f4</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>ShallowChecks</span> <span class=p>{</span>  <span class=c1>// 未调用，不影响运行期
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=kt>void</span> <span class=nf>deref</span><span class=p>(</span><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>Type</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>Type</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f3</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Type</span> <span class=o>=</span> <span class=kt>int</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>f4</span><span class=p>(</span><span class=n>A</span><span class=p>{});</span>  <span class=c1>// 实例化 f4&lt;A&gt;(const A&amp;) 时检测到错误
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * error C2100: 非法的间接寻址
</span></span></span><span class=line><span class=cl><span class=cm> * message : 查看对正在编译的函数 模板 实例化“void f4&lt;A&gt;(const T &amp;)”的引用
</span></span></span><span class=line><span class=cl><span class=cm> *         with
</span></span></span><span class=line><span class=cl><span class=cm> *         [
</span></span></span><span class=line><span class=cl><span class=cm> *             T=A
</span></span></span><span class=line><span class=cl><span class=cm> *         ]
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=静态断言static-assertion class=headerLink><a href=#%e9%9d%99%e6%80%81%e6%96%ad%e8%a8%80static-assertion class=header-mark></a>62 静态断言（Static Assertion）</h2><ul><li>C++11 引入了<a href=https://en.cppreference.com/w/cpp/language/static_assert target=_blank rel="noopener noreferrer">static_assert</a>，在编译期进行断言，比如下列静态断言确保编译平台带 64 位指针</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>static_assert</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span> <span class=o>*</span> <span class=n>CHAR_BIT</span> <span class=o>==</span> <span class=mi>64</span><span class=p>,</span> <span class=s>&#34;Not a 64-bit platform&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>创建一个检查解引用的 traits，用 <a href=https://en.cppreference.com/w/cpp/language/static_assert target=_blank rel="noopener noreferrer">static_assert</a> 提供更明确的诊断信息</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>has_dereference</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>struct</span> <span class=nc>Identity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=n>test</span><span class=p>(</span><span class=n>Identity</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>*</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span><span class=p>())</span><span class=o>&gt;*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=n>test</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>value</span> <span class=o>=</span> <span class=k>decltype</span><span class=p>(</span><span class=n>test</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=k>nullptr</span><span class=p>))</span><span class=o>::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>has_dereference_v</span> <span class=o>=</span> <span class=n>has_dereference</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>static_assert</span><span class=p>(</span><span class=n>has_dereference_v</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=s>&#34;T is not dereferenceable&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>  <span class=c1>// static_assert 报错：T is not dereferenceable
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>C++17 可以用 <a href=https://en.cppreference.com/w/cpp/types/void_t target=_blank rel="noopener noreferrer">std::void_t</a> 简化 traits 的实现</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;type_traits&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span><span class=p>,</span> <span class=k>typename</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>has_dereference</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>has_dereference</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>void_t</span><span class=o>&lt;</span><span class=k>decltype</span><span class=p>(</span><span class=o>*</span><span class=n>std</span><span class=o>::</span><span class=n>declval</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>())</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>inline</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>has_dereference_v</span> <span class=o>=</span> <span class=n>has_dereference</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=conceptshttpsencppreferencecomwcppconcepts class=headerLink><a href=#conceptshttpsencppreferencecomwcppconcepts class=header-mark></a>63 <a href=https://en.cppreference.com/w/cpp/concepts target=_blank rel="noopener noreferrer">Concepts</a></h2><ul><li>C++20 可以用 concepts 约束类型，代码更简洁</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>concept</span> <span class=n>Dereferenceable</span> <span class=o>=</span> <span class=k>requires</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>requires</span> <span class=n>Dereferenceable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>f</span><span class=p>(</span><span class=n>T</span><span class=o>&amp;</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* 等价写法
</span></span></span><span class=line><span class=cl><span class=cm> * template &lt;typename T&gt;
</span></span></span><span class=line><span class=cl><span class=cm> *   requires requires(T x) { *x; }
</span></span></span><span class=line><span class=cl><span class=cm> * void f(T&amp; i) {
</span></span></span><span class=line><span class=cl><span class=cm> *   *i = 0;
</span></span></span><span class=line><span class=cl><span class=cm> * }
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>f</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>  <span class=c1>// 未满足关联约束
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=原型archetype class=headerLink><a href=#%e5%8e%9f%e5%9e%8barchetype class=header-mark></a>64 原型（Archetype）</h2><ul><li>模板的一个挑战是确保满足特定约束的实参都能通过编译，为了测试满足要求的模板参数，引入原型的概念。原型是用户定义的类，以尽可能小的方式来满足模板大多数要求，而不提供任何外来的操作</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// 要求 T 是可比较类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>find</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>i</span> <span class=o>!=</span> <span class=n>n</span> <span class=o>&amp;&amp;</span> <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>EqualityComparable</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ConvertibleToBool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=nf>bool</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span> <span class=p>}</span>  <span class=c1>// 提供本类型到 bool 的隐式转换
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ConvertibleToBool</span>  <span class=c1>// 返回类型要求能转换为 bool
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>EqualityComparable</span><span class=o>&amp;</span><span class=p>,</span> <span class=k>const</span> <span class=n>EqualityComparable</span><span class=o>&amp;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>ConvertibleToBool</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 实例化 find&lt;EqualityComparable&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=kt>int</span> <span class=nf>find</span><span class=p>(</span><span class=k>const</span> <span class=n>EqualityComparable</span><span class=o>*</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=k>const</span> <span class=n>EqualityComparable</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>实例化将失败，改用 <code>operator==</code> 比较即可解决此问题</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>find</span><span class=p>(</span><span class=k>const</span> <span class=n>T</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=k>const</span> <span class=n>T</span><span class=o>&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>i</span> <span class=o>!=</span> <span class=n>n</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>v</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>但这又在无意中对结果使用了 <code>operator!</code>，如果要发现这点，在 ConvertibleToBool 中禁用 <code>operator!</code> 即可，当其被使用时将报错</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ConvertibleToBool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=nf>bool</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>bool</span> <span class=k>operator</span><span class=o>!</span><span class=p>()</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>可以再对原型做其他扩展，比如禁用 <code>operator&&</code> 和 <code>operator||</code> 来找出其他的一些模板定义中的问题</li></ul><h2 id=跟踪程序tracer class=headerLink><a href=#%e8%b7%9f%e8%b8%aa%e7%a8%8b%e5%ba%8ftracer class=header-mark></a>65 跟踪程序（Tracer）</h2><ul><li>以上都是编译或链接时的 bug，更大的挑战是确保程序在运行期表现正确</li><li>Tracer 是一个用户定义的类，它能用作要测试的模板的实参。通常 tracer 也是一个原型，但包含一些额外的信息。下面是一个用于测试 <a href=https://en.cppreference.com/w/cpp/algorithm/sort target=_blank rel="noopener noreferrer">std::sort</a> 的 tracer，它提供 <a href=https://en.cppreference.com/w/cpp/algorithm/sort target=_blank rel="noopener noreferrer">std::sort</a> 需要的功能（比如 <code>operator==</code> 和 <code>operator></code>），并给出算法开销的直观结果，但不揭示排序模板的正确性</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;algorithm&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SortTracer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>long</span> <span class=n>creations</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n_created</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>long</span> <span class=nf>destructions</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n_destroyed</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>long</span> <span class=nf>assignments</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n_assigned</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>long</span> <span class=nf>comparisons</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n_compared</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=kt>long</span> <span class=nf>max_live</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n_max_live</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=n>SortTracer</span><span class=p>(</span><span class=kt>int</span> <span class=n>v</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>:</span> <span class=n>value</span><span class=p>(</span><span class=n>v</span><span class=p>),</span> <span class=n>generation</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>n_created</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_max_live</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;SortTracer #&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_created</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;, created generation &#34;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;&lt;</span> <span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; (total: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_created</span> <span class=o>-</span> <span class=n>n_destroyed</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SortTracer</span><span class=p>(</span><span class=k>const</span> <span class=n>SortTracer</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>value</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>value</span><span class=p>),</span> <span class=n>generation</span><span class=p>(</span><span class=n>rhs</span><span class=p>.</span><span class=n>generation</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>n_created</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_max_live</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;SortTracer #&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_created</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;, copied as generation &#34;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;&lt;</span> <span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; (total: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_created</span> <span class=o>-</span> <span class=n>n_destroyed</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>~</span><span class=n>SortTracer</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>n_destroyed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>update_max_live</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;SortTracer generation &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>generation</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;&lt;</span> <span class=s>&#34; destroyed (total: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_created</span> <span class=o>-</span> <span class=n>n_destroyed</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>SortTracer</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>SortTracer</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>n_assigned</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;SortTracer assignment #&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_assigned</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; (generation &#34;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;&lt;</span> <span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; = &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>value</span> <span class=o>=</span> <span class=n>rhs</span><span class=p>.</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>*</span><span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>friend</span> <span class=kt>bool</span> <span class=k>operator</span><span class=o>&lt;</span><span class=p>(</span><span class=k>const</span> <span class=n>SortTracer</span><span class=o>&amp;</span> <span class=n>lhs</span><span class=p>,</span> <span class=k>const</span> <span class=n>SortTracer</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>++</span><span class=n>n_compared</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;SortTracer comparison #&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>n_compared</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; (generation &#34;</span>
</span></span><span class=line><span class=cl>              <span class=o>&lt;&lt;</span> <span class=n>lhs</span><span class=p>.</span><span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &lt; &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>generation</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lhs</span><span class=p>.</span><span class=n>value</span> <span class=o>&lt;</span> <span class=n>rhs</span><span class=p>.</span><span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=nf>val</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>value</span><span class=p>;</span>                           <span class=c1>// integer value to be sorted
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>generation</span><span class=p>;</span>                      <span class=c1>// generation of this tracer
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>long</span> <span class=n>n_created</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>    <span class=c1>// number of constructor calls
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>long</span> <span class=n>n_destroyed</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// number of destructor calls
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>long</span> <span class=n>n_assigned</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>   <span class=c1>// number of assignments
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>long</span> <span class=n>n_compared</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>   <span class=c1>// number of comparisons
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>inline</span> <span class=k>static</span> <span class=kt>long</span> <span class=n>n_max_live</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>   <span class=c1>// maximum of existing objects
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// recompute maximum of existing objects
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static</span> <span class=kt>void</span> <span class=nf>update_max_live</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>n_created</span> <span class=o>-</span> <span class=n>n_destroyed</span> <span class=o>&gt;</span> <span class=n>n_max_live</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>n_max_live</span> <span class=o>=</span> <span class=n>n_created</span> <span class=o>-</span> <span class=n>n_destroyed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>SortTracer</span> <span class=n>input</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>8</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 打印初始值
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39; &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39;\n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 记录初始条件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>long</span> <span class=n>created_at_start</span> <span class=o>=</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>creations</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>max_live_at_start</span> <span class=o>=</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>max_live</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>assigned_at_start</span> <span class=o>=</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>assignments</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>compared_at_start</span> <span class=o>=</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>comparisons</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 执行
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;---[ Start std::sort() ]--------------------</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>sort</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=o>&amp;</span><span class=n>input</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;---[ End std::sort() ]----------------------</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 检查结果
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>val</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=sc>&#39; &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// final report
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;std::sort() of 10 SortTracer&#39;s was performed by:</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>creations</span><span class=p>()</span> <span class=o>-</span> <span class=n>created_at_start</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=s>&#34; temporary tracers</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=s>&#34;up to &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>max_live</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=s>&#34; tracers at the same time (&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>max_live_at_start</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=s>&#34; before)</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>assignments</span><span class=p>()</span> <span class=o>-</span> <span class=n>assigned_at_start</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; assignments</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=n>SortTracer</span><span class=o>::</span><span class=n>comparisons</span><span class=p>()</span> <span class=o>-</span> <span class=n>compared_at_start</span>
</span></span><span class=line><span class=cl>            <span class=o>&lt;&lt;</span> <span class=s>&#34; comparisons</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #1, created generation 1 (total: 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #2, created generation 1 (total: 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #3, created generation 1 (total: 3)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #4, created generation 1 (total: 4)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #5, created generation 1 (total: 5)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #6, created generation 1 (total: 6)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #7, created generation 1 (total: 7)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #8, created generation 1 (total: 8)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #9, created generation 1 (total: 9)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #10, created generation 1 (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * 7 3 5 6 4 2 0 1 9 8
</span></span></span><span class=line><span class=cl><span class=cm> * ---[ Start std::sort() ]--------------------
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #11, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #1 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #2 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #1 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #2 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #12, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #3 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #4 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #5 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #3 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #6 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #4 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #13, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #7 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #8 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #9 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #5 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #10 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #6 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #14, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #11 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #12 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #13 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #7 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #14 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #15 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #8 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #16 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #17 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #9 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #18 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #10 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #15, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #19 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #20 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #11 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #12 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #13 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #14 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #15 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #16 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #16, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #21 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #22 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #17 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #18 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #19 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #20 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #21 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #22 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #23 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #17, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #23 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #24 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #25 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #24 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #26 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #27 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #25 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #28 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #29 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #26 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #30 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #31 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #27 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #32 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #33 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #28 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #34 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #35 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #29 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #36 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #30 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #18, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #37 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #38 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #31 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer #19, copied as generation 2 (total: 11)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #39 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #40 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #41 (generation 1 &lt; 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #32 (generation 1 = 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer comparison #42 (generation 2 &lt; 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer assignment #33 (generation 1 = 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 2 destroyed (total: 10)
</span></span></span><span class=line><span class=cl><span class=cm> * ---[ End std::sort() ]----------------------
</span></span></span><span class=line><span class=cl><span class=cm> * 0 1 2 3 4 5 6 7 8 9
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * std::sort() of 10 SortTracer&#39;s was performed by:
</span></span></span><span class=line><span class=cl><span class=cm> * 9 temporary tracers
</span></span></span><span class=line><span class=cl><span class=cm> * up to 11 tracers at the same time (10 before)
</span></span></span><span class=line><span class=cl><span class=cm> * 33 assignments
</span></span></span><span class=line><span class=cl><span class=cm> * 42 comparisons
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 9)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 8)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 7)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 6)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 5)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 4)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 3)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 2)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 1)
</span></span></span><span class=line><span class=cl><span class=cm> * SortTracer generation 1 destroyed (total: 0)
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span></code></pre></td></tr></table></div></div></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><div class=related-image><a href=/cxx_basic/><img loading=lazy src=/featuredImage/13.webp srcset="/featuredImage/13.webp, /featuredImage/13.webp 1.5x, /featuredImage/13.webp 2x" sizes=auto alt=C++高级编程 title=C++高级编程 height=200 width=400></a></div><h2 class=related-title><a href=/cxx_basic/>C++基础笔记</a></h2></div><div class=related-item-container><div class=related-image><a href=/cxx_enhance/><img loading=lazy src=/featuredImage/13.webp srcset="/featuredImage/13.webp, /featuredImage/13.webp 1.5x, /featuredImage/13.webp 2x" sizes=auto alt=C++高级编程 title=C++高级编程 height=200 width=400></a></div><h2 class=related-title><a href=/cxx_enhance/>C++提高笔记</a></h2></div><div class=related-item-container><div class=related-image><a href=/cxx_advance/><img loading=lazy src=/featuredImage/13.webp srcset="/featuredImage/13.webp, /featuredImage/13.webp 1.5x, /featuredImage/13.webp 2x" sizes=auto alt=C++高级编程 title=C++高级编程 height=200 width=400></a></div><h2 class=related-title><a href=/cxx_advance/>C++增强笔记</a></h2></div><div class=related-item-container><div class=related-image><a href=/stl/><img loading=lazy src=/featuredImage/11.webp srcset="/featuredImage/11.webp, /featuredImage/11.webp 1.5x, /featuredImage/11.webp 2x" sizes=auto alt=C++高级编程 title=C++高级编程 height=200 width=400></a></div><h2 class=related-title><a href=/stl/>STL基础笔记</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-12-23&nbsp;<a class=git-hash href=https://github.com/mengdemao/github.io.git/commit/1754a59682478981911be0d61138b31fb0f92745 target=_blank title="commit by Meng Demao(mengdemao19951021@163.com) 1754a59682478981911be0d61138b31fb0f92745: 转换文件格式" rel="noopener noreferrer">
<i class="fas fa-hashtag fa-fw"></i>1754a59</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/cxx_template/index.md target=_blank rel="noopener noreferrer">阅读原始文档</a>
</span><span>|&nbsp;<a class=link-to-source href=https://github.com/mengdemao/github.io/blob/master/content/posts/cxx_template/index.md target=_blank rel="noopener noreferrer">查看源代码</a>
</span><span>|&nbsp;<a class=link-to-edit href=https://github.com/mengdemao/github.io/edit/master/content/posts/cxx_template/index.md target=_blank rel="noopener noreferrer">编辑此页</a>
</span><span>|&nbsp;<a class=link-to-report href="https://github.com/mengdemao/github.io/issues/new?title=[bug]%20C%2B%2B%E6%A8%A1%E6%9D%BF&body=|Field|Value|%0A|-|-|%0A|Title|C%2B%2B%E6%A8%A1%E6%9D%BF|%0A|Url|https://mengdemao.github.io/cxx_template/|%0A|Filename|https://github.com/mengdemao/github.io/blob/main/exampleSite/content/posts/cxx_template/index.md|" target=_blank rel="noopener noreferrer">报告问题</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/c++/>C++</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/buildroot/ class=prev rel=prev title=Buildroot><i class="fas fa-angle-left fa-fw"></i>Buildroot</a>
<a href=/compile/ class=next rel=next title=编译原理>编译原理<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.121.1">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/mengdemao target=_blank rel="noopener noreferrer">mengdemao</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div><script>"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.min.js",{scope:"/"}).then(function(){}),navigator.serviceWorker.ready.then(function(){}))</script></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div id=cookieconsent-container></div><div class=assets><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q="><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:300},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"",lightTheme:"github-light",repo:"Hugo-DoIt/utterances-comments"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"desktop-header-typeit":"编程日志","mobile-header-typeit":"编程日志"},search:{algoliaAppID:"PQZTCYTP3M",algoliaIndex:"zh_cn_meng",algoliaSearchKey:"67a3d5929b94f3dc005abb63778b8928",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},table:{sort:!0},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:-1,speed:100}}</script><script type=text/javascript src=/lib/tablesort/tablesort.min.92de6dec051677787aed63503575b2f9be73f21f2745574e59647bc139a92d40.js integrity="sha256-kt5t7AUWd3h67WNQNXWy+b5z8h8nRVdOWWR7wTmpLUA="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.11be927cda59c8b6019ebbea838285c5beaf21183ea4b83dbd4e4fbf9413ce4a.js integrity="sha256-Eb6SfNpZyLYBnrvqg4KFxb6vIRg+pLg9vU5Pv5QTzko="></script><script type=text/javascript src=/lib/typeit/typeit.min.491c13689db70b6adb3176a9a792644be7578a2f931521f5cb199d313a21c359.js integrity="sha256-SRwTaJ23C2rbMXapp5JkS+dXii+TFSH1yxmdMTohw1k="></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" defer></script><script type=text/javascript src=/js/cookieconsent.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js></script><script type=text/javascript src=/custom/javascript/custom.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6QCK4BFMHW",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-6QCK4BFMHW" async></script></div></body></html>